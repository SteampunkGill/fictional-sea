# 接口文档

## 接口：忘记密码

### 基本信息
- **接口地址**：`/api/v1/auth/forgot-password`
- **请求方法**：`POST`
- **认证方式**：无需认证

### 请求头
| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| `Content-Type` | `string` | 是 | 固定值：`application/json` |

### 请求体
```json
{
  "email": "user@example.com"
}
```

| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| `email` | `string` | 是 | 用户注册邮箱 |

### 响应体
#### 成功响应 (200)
```json
{
  "success": true,
  "message": "重置链接已发送到您的邮箱"
}
```

| 字段名 | 类型 | 描述 |
|--------|------|------|
| `success` | `boolean` | 请求是否成功 |
| `message` | `string` | 操作结果消息 |

#### 错误响应
**400 Bad Request**
```json
{
  "success": false,
  "message": "邮箱不能为空"
}
```
或
```json
{
  "success": false,
  "message": "邮箱格式不正确"
}
```

**500 Internal Server Error**
```json
{
  "success": false,
  "message": "服务器内部错误"
}
```

### 状态码说明
| 状态码 | 说明 |
|--------|------|
| 200 | 操作成功 |
| 400 | 请求参数错误 |
| 500 | 服务器内部错误 |

### 业务说明
1. 安全设计：无论邮箱是否存在，都返回成功响应，防止邮箱枚举攻击
2. 邮箱验证：检查邮箱格式和是否为空
3. 令牌生成：为存在的用户生成24小时有效的重置令牌
4. 邮件发送：实际应发送包含重置链接的邮件（示例中仅打印日志）

# 接口文档

## 接口：获取当前用户信息

### 基本信息
- **接口地址**：`/api/v1/auth/me`
- **请求方法**：`GET`
- **认证方式**：Bearer Token

### 请求头
| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| `Authorization` | `string` | 是 | Bearer Token，格式：`Bearer {token}` |

### 请求参数
无

### 响应体
#### 成功响应 (200)
```json
{
  "success": true,
  "message": "获取用户信息成功",
  "data": {
    "currentUser": {
      "id": 1,
      "username": "testuser",
      "email": "test@example.com",
      "nickname": "测试用户",
      "avatarUrl": "https://example.com/avatar.jpg",
      "role": "user",
      "isVerified": true,
      "createdAt": "2023-01-01T00:00:00",
      "lastLoginAt": "2023-01-02T12:00:00",
      "preferences": {
        "theme": "dark",
        "language": "zh-CN",
        "notificationEnabled": true,
        "autoSave": true,
        "readingMode": "day",
        "fontSize": 14,
        "lineHeight": 1.5
      }
    }
  }
}
```

| 字段名 | 类型 | 描述 |
|--------|------|------|
| `success` | `boolean` | 请求是否成功 |
| `message` | `string` | 操作结果消息 |
| `data` | `object` | 用户数据 |

**data.currentUser 对象字段：**
| 字段名 | 类型 | 描述 |
|--------|------|------|
| `id` | `integer` | 用户ID |
| `username` | `string` | 用户名 |
| `email` | `string` | 邮箱 |
| `nickname` | `string` | 昵称 |
| `avatarUrl` | `string` | 头像URL |
| `role` | `string` | 用户角色 |
| `isVerified` | `boolean` | 是否已验证 |
| `createdAt` | `string` | 创建时间（ISO格式） |
| `lastLoginAt` | `string` | 最后登录时间（ISO格式） |
| `preferences` | `object` | 用户偏好设置 |

**preferences 对象字段：**
| 字段名 | 类型 | 描述 |
|--------|------|------|
| `theme` | `string` | 主题（dark/light） |
| `language` | `string` | 语言设置 |
| `notificationEnabled` | `boolean` | 是否启用通知 |
| `autoSave` | `boolean` | 是否自动保存 |
| `readingMode` | `string` | 阅读模式 |
| `fontSize` | `integer` | 字体大小 |
| `lineHeight` | `number` | 行高 |

#### 错误响应
**401 Unauthorized**
```json
{
  "success": false,
  "message": "未提供有效的认证令牌",
  "data": null
}
```
或
```json
{
  "success": false,
  "message": "令牌无效或已过期",
  "data": null
}
```

**404 Not Found**
```json
{
  "success": false,
  "message": "用户不存在",
  "data": null
}
```

**500 Internal Server Error**
```json
{
  "success": false,
  "message": "服务器内部错误",
  "data": null
}
```

### 状态码说明
| 状态码 | 说明 |
|--------|------|
| 200 | 获取成功 |
| 401 | 未授权或Token无效/过期 |
| 404 | 用户不存在 |
| 500 | 服务器内部错误 |

### 业务说明
1. 认证验证：通过Bearer Token验证用户身份
2. 会话检查：验证会话是否有效（未过期）
3. 用户信息：返回完整的用户信息和偏好设置
4. 时间格式：createdAt和lastLoginAt为ISO 8601格式的字符串
5. 偏好设置：从user_settings表获取用户个性化设置
# 接口文档

## 接口：用户登录

### 基本信息
- **接口地址**：`/api/v1/auth/login`
- **请求方法**：`POST`
- **认证方式**：无需认证

### 请求头
| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| `Content-Type` | `string` | 是 | 固定值：`application/json` |

### 请求体
```json
{
  "email": "user@example.com",
  "password": "password123"
}
```

| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| `email` | `string` | 是 | 用户邮箱 |
| `password` | `string` | 是 | 用户密码 |

### 响应体
#### 成功响应 (200)
```json
{
  "success": true,
  "message": "登录成功",
  "data": {
    "accessToken": "access_xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",
    "refreshToken": "refresh_xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",
    "expiresIn": 3600
  }
}
```

| 字段名 | 类型 | 描述 |
|--------|------|------|
| `success` | `boolean` | 请求是否成功 |
| `message` | `string` | 操作结果消息 |
| `data` | `object` | 登录数据 |

**data 对象字段：**
| 字段名 | 类型 | 描述 |
|--------|------|------|
| `accessToken` | `string` | 访问令牌，格式：`access_` + UUID |
| `refreshToken` | `string` | 刷新令牌，格式：`refresh_` + UUID |
| `expiresIn` | `integer` | 访问令牌过期时间（秒），默认3600秒（1小时） |

#### 错误响应
**400 Bad Request**
```json
{
  "success": false,
  "message": "邮箱不能为空",
  "data": null
}
```
或
```json
{
  "success": false,
  "message": "密码不能为空",
  "data": null
}
```

**401 Unauthorized**
```json
{
  "success": false,
  "message": "邮箱或密码错误",
  "data": null
}
```

**500 Internal Server Error**
```json
{
  "success": false,
  "message": "服务器内部错误",
  "data": null
}
```

### 状态码说明
| 状态码 | 说明 |
|--------|------|
| 200 | 登录成功 |
| 400 | 请求参数错误 |
| 401 | 邮箱或密码错误 |
| 500 | 服务器内部错误 |

### 业务说明
1. 密码验证：支持BCrypt哈希和明文两种密码验证方式
2. 会话管理：登录时删除用户旧的会话，创建新的会话
3. 令牌生成：生成accessToken和refreshToken，格式为前缀+UUID
4. 登录时间：更新用户的最后登录时间
5. 会话过期：accessToken默认1小时后过期
# 接口文档

## 接口：用户登出

### 基本信息
- **接口地址**：`/api/v1/auth/logout`
- **请求方法**：`POST`
- **认证方式**：Bearer Token

### 请求头
| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| `Authorization` | `string` | 是 | Bearer Token，格式：`Bearer {token}` |

### 请求体
无

### 响应体
#### 成功响应 (200)
```json
{
  "success": true,
  "message": "登出成功"
}
```

| 字段名 | 类型 | 描述 |
|--------|------|------|
| `success` | `boolean` | 请求是否成功 |
| `message` | `string` | 操作结果消息 |

#### 错误响应
**400 Bad Request**
```json
{
  "success": false,
  "message": "未提供有效的认证令牌"
}
```

**500 Internal Server Error**
```json
{
  "success": false,
  "message": "服务器内部错误"
}
```

### 状态码说明
| 状态码 | 说明 |
|--------|------|
| 200 | 登出成功 |
| 400 | 请求参数错误 |
| 500 | 服务器内部错误 |

### 业务说明
1. 会话删除：删除用户的当前会话
2. 安全设计：即使会话不存在也返回成功，防止信息泄露

---

## 接口：刷新令牌

### 基本信息
- **接口地址**：`/api/v1/auth/refresh-token`
- **请求方法**：`POST`
- **认证方式**：无需认证

### 请求头
| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| `Content-Type` | `string` | 是 | 固定值：`application/json` |

### 请求体
```json
{
  "refresh_token": "refresh_xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
}
```

| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| `refresh_token` | `string` | 是 | 刷新令牌 |

### 响应体
#### 成功响应 (200)
```json
{
  "success": true,
  "message": "令牌刷新成功",
  "data": {
    "access_token": "access_xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",
    "refresh_token": "refresh_xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",
    "expires_in": 3600
  }
}
```

| 字段名 | 类型 | 描述 |
|--------|------|------|
| `success` | `boolean` | 请求是否成功 |
| `message` | `string` | 操作结果消息 |
| `data` | `object` | 令牌数据 |

**data 对象字段：**
| 字段名 | 类型 | 描述 |
|--------|------|------|
| `access_token` | `string` | 新的访问令牌 |
| `refresh_token` | `string` | 新的刷新令牌 |
| `expires_in` | `integer` | 访问令牌过期时间（秒） |

#### 错误响应
**400 Bad Request**
```json
{
  "success": false,
  "message": "刷新令牌不能为空",
  "data": null
}
```

**401 Unauthorized**
```json
{
  "success": false,
  "message": "刷新令牌无效",
  "data": null
}
```
或
```json
{
  "success": false,
  "message": "刷新令牌已过期",
  "data": null
}
```

**500 Internal Server Error**
```json
{
  "success": false,
  "message": "服务器内部错误",
  "data": null
}
```

### 状态码说明
| 状态码 | 说明 |
|--------|------|
| 200 | 令牌刷新成功 |
| 400 | 请求参数错误 |
| 401 | 刷新令牌无效或过期 |
| 500 | 服务器内部错误 |

### 业务说明
1. 令牌轮换：同时生成新的access_token和refresh_token
2. 过期检查：验证refresh_token是否过期
3. 会话更新：更新现有会话的令牌信息

---

## 接口：用户注册

### 基本信息
- **接口地址**：`/api/v1/auth/register`
- **请求方法**：`POST`
- **认证方式**：无需认证

### 请求头
| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| `Content-Type` | `string` | 是 | 固定值：`application/json` |

### 请求体
```json
{
  "email": "user@example.com",
  "password": "password123",
  "username": "testuser",
  "nickname": "测试用户"
}
```

| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| `email` | `string` | 是 | 用户邮箱 |
| `password` | `string` | 是 | 用户密码，长度≥6 |
| `username` | `string` | 是 | 用户名 |
| `nickname` | `string` | 否 | 昵称，不传则使用用户名 |

### 响应体
#### 成功响应 (201)
```json
{
  "success": true,
  "message": "注册成功",
  "data": {
    "user": {
      "id": 1,
      "username": "testuser",
      "email": "test@example.com",
      "nickname": "测试用户",
      "avatarUrl": "",
      "role": "user",
      "isVerified": false,
      "createdAt": "2023-01-01T00:00:00",
      "lastLoginAt": "2023-01-01T00:00:00"
    }
  }
}
```

| 字段名 | 类型 | 描述 |
|--------|------|------|
| `success` | `boolean` | 请求是否成功 |
| `message` | `string` | 操作结果消息 |
| `data` | `object` | 用户数据 |

**data.user 对象字段：**
| 字段名 | 类型 | 描述 |
|--------|------|------|
| `id` | `integer` | 用户ID |
| `username` | `string` | 用户名 |
| `email` | `string` | 邮箱 |
| `nickname` | `string` | 昵称 |
| `avatarUrl` | `string` | 头像URL |
| `role` | `string` | 用户角色 |
| `isVerified` | `boolean` | 是否已验证 |
| `createdAt` | `string` | 创建时间 |
| `lastLoginAt` | `string` | 最后登录时间 |

#### 错误响应
**400 Bad Request**
```json
{
  "success": false,
  "message": "邮箱不能为空",
  "data": null
}
```
或
```json
{
  "success": false,
  "message": "密码不能为空",
  "data": null
}
```
或
```json
{
  "success": false,
  "message": "用户名不能为空",
  "data": null
}
```
或
```json
{
  "success": false,
  "message": "邮箱格式不正确",
  "data": null
}
```
或
```json
{
  "success": false,
  "message": "密码长度不能少于6位",
  "data": null
}
```
或
```json
{
  "success": false,
  "message": "该邮箱已被注册",
  "data": null
}
```
或
```json
{
  "success": false,
  "message": "该用户名已被使用",
  "data": null
}
```

**500 Internal Server Error**
```json
{
  "success": false,
  "message": "服务器内部错误",
  "data": null
}
```

### 状态码说明
| 状态码 | 说明 |
|--------|------|
| 201 | 注册成功 |
| 400 | 请求参数错误 |
| 500 | 服务器内部错误 |

### 业务说明
1. 自动登录：注册成功后自动创建会话并返回令牌
2. 唯一性验证：检查邮箱和用户名是否已存在
3. 默认值设置：未提供昵称时使用用户名，角色默认为"user"

---

## 接口：重置密码

### 基本信息
- **接口地址**：`/api/v1/auth/reset-password`
- **请求方法**：`POST`
- **认证方式**：无需认证

### 请求头
| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| `Content-Type` | `string` | 是 | 固定值：`application/json` |

### 请求体
```json
{
  "token": "reset_xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",
  "email": "user@example.com",
  "password": "newpassword123",
  "password_confirmation": "newpassword123"
}
```

| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| `token` | `string` | 是 | 重置令牌 |
| `email` | `string` | 是 | 用户邮箱 |
| `password` | `string` | 是 | 新密码，长度≥6 |
| `password_confirmation` | `string` | 是 | 确认密码 |

### 响应体
#### 成功响应 (200)
```json
{
  "success": true,
  "message": "密码重置成功，请使用新密码登录"
}
```

| 字段名 | 类型 | 描述 |
|--------|------|------|
| `success` | `boolean` | 请求是否成功 |
| `message` | `string` | 操作结果消息 |

#### 错误响应
**400 Bad Request**
```json
{
  "success": false,
  "message": "重置令牌不能为空"
}
```
或
```json
{
  "success": false,
  "message": "邮箱不能为空"
}
```
或
```json
{
  "success": false,
  "message": "新密码不能为空"
}
```
或
```json
{
  "success": false,
  "message": "确认密码不能为空"
}
```
或
```json
{
  "success": false,
  "message": "两次输入的密码不一致"
}
```
或
```json
{
  "success": false,
  "message": "密码长度不能少于6位"
}
```
或
```json
{
  "success": false,
  "message": "邮箱不存在"
}
```
或
```json
{
  "success": false,
  "message": "重置令牌无效"
}
```
或
```json
{
  "success": false,
  "message": "重置令牌已过期"
}
```

**500 Internal Server Error**
```json
{
  "success": false,
  "message": "服务器内部错误"
}
```

### 状态码说明
| 状态码 | 说明 |
|--------|------|
| 200 | 密码重置成功 |
| 400 | 请求参数错误 |
| 500 | 服务器内部错误 |

### 业务说明
1. 令牌验证：验证重置令牌是否有效且未过期
2. 密码一致性：验证新密码和确认密码是否一致
3. 安全措施：重置密码后删除所有用户会话，强制重新登录

---

## 接口：更新密码

### 基本信息
- **接口地址**：`/api/v1/auth/password`
- **请求方法**：`PUT`
- **认证方式**：Bearer Token

### 请求头
| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| `Authorization` | `string` | 是 | Bearer Token，格式：`Bearer {token}` |
| `Content-Type` | `string` | 是 | 固定值：`application/json` |

### 请求体
```json
{
  "current_password": "oldpassword123",
  "new_password": "newpassword123",
  "new_password_confirmation": "newpassword123"
}
```

| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| `current_password` | `string` | 是 | 当前密码 |
| `new_password` | `string` | 是 | 新密码，长度≥6 |
| `new_password_confirmation` | `string` | 是 | 确认新密码 |

### 响应体
#### 成功响应 (200)
```json
{
  "success": true,
  "message": "密码更新成功，请重新登录"
}
```

| 字段名 | 类型 | 描述 |
|--------|------|------|
| `success` | `boolean` | 请求是否成功 |
| `message` | `string` | 操作结果消息 |

#### 错误响应
**400 Bad Request**
```json
{
  "success": false,
  "message": "当前密码不能为空"
}
```
或
```json
{
  "success": false,
  "message": "新密码不能为空"
}
```
或
```json
{
  "success": false,
  "message": "确认密码不能为空"
}
```
或
```json
{
  "success": false,
  "message": "两次输入的新密码不一致"
}
```
或
```json
{
  "success": false,
  "message": "新密码长度不能少于6位"
}
```
或
```json
{
  "success": false,
  "message": "新密码不能与当前密码相同"
}
```
或
```json
{
  "success": false,
  "message": "当前密码错误"
}
```

**401 Unauthorized**
```json
{
  "success": false,
  "message": "未提供有效的认证令牌"
}
```
或
```json
{
  "success": false,
  "message": "令牌无效或已过期"
}
```

**500 Internal Server Error**
```json
{
  "success": false,
  "message": "服务器内部错误"
}
```

### 状态码说明
| 状态码 | 说明 |
|--------|------|
| 200 | 密码更新成功 |
| 400 | 请求参数错误 |
| 401 | 未授权或Token无效 |
| 500 | 服务器内部错误 |

### 业务说明
1. 密码验证：验证当前密码是否正确
2. 密码规则：新密码不能与当前密码相同，长度≥6
3. 安全措施：更新密码后删除所有用户会话，强制重新登录

---

## 接口：验证邮箱

### 基本信息
- **接口地址**：`/api/v1/auth/verify-email`
- **请求方法**：`POST`
- **认证方式**：无需认证

### 请求头
| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| `Content-Type` | `string` | 是 | 固定值：`application/json` |

### 请求体
```json
{
  "token": "verify_xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",
  "email": "user@example.com"
}
```

| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| `token` | `string` | 是 | 验证令牌 |
| `email` | `string` | 是 | 用户邮箱 |

### 响应体
#### 成功响应 (200)
```json
{
  "success": true,
  "message": "邮箱验证成功"
}
```

| 字段名 | 类型 | 描述 |
|--------|------|------|
| `success` | `boolean` | 请求是否成功 |
| `message` | `string` | 操作结果消息 |

#### 错误响应
**400 Bad Request**
```json
{
  "success": false,
  "message": "验证令牌不能为空"
}
```
或
```json
{
  "success": false,
  "message": "邮箱不能为空"
}
```
或
```json
{
  "success": false,
  "message": "邮箱格式不正确"
}
```
或
```json
{
  "success": false,
  "message": "邮箱不存在"
}
```
或
```json
{
  "success": false,
  "message": "邮箱已经验证过了"
}
```

**500 Internal Server Error**
```json
{
  "success": false,
  "message": "服务器内部错误"
}
```

### 状态码说明
| 状态码 | 说明 |
|--------|------|
| 200 | 邮箱验证成功 |
| 400 | 请求参数错误 |
| 500 | 服务器内部错误 |

### 业务说明
1. 状态检查：验证邮箱是否已存在且未验证
2. 令牌验证：验证邮箱验证令牌（课设中简化处理）
3. 状态更新：将用户is_verified字段更新为true

---

## 接口：发送邮箱验证邮件

### 基本信息
- **接口地址**：`/api/v1/auth/send-verification-email`
- **请求方法**：`POST`
- **认证方式**：Bearer Token

### 请求头
| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| `Authorization` | `string` | 是 | Bearer Token，格式：`Bearer {token}` |

### 请求体
无

### 响应体
#### 成功响应 (200)
```json
{
  "success": true,
  "message": "验证邮件已发送，请查收您的邮箱"
}
```

| 字段名 | 类型 | 描述 |
|--------|------|------|
| `success` | `boolean` | 请求是否成功 |
| `message` | `string` | 操作结果消息 |

#### 错误响应
**400 Bad Request**
```json
{
  "success": false,
  "message": "邮箱已经验证过了"
}
```

**401 Unauthorized**
```json
{
  "success": false,
  "message": "未提供有效的认证令牌"
}
```
或
```json
{
  "success": false,
  "message": "令牌无效或已过期"
}
```

**500 Internal Server Error**
```json
{
  "success": false,
  "message": "服务器内部错误"
}
```

### 状态码说明
| 状态码 | 说明 |
|--------|------|
| 200 | 验证邮件发送成功 |
| 400 | 邮箱已验证 |
| 401 | 未授权或Token无效 |
| 500 | 服务器内部错误 |

### 业务说明
1. 状态检查：验证用户邮箱是否已验证
2. 令牌生成：生成24小时有效的邮箱验证令牌
3. 邮件发送：实际应发送包含验证链接的邮件（课设中仅打印日志）

---

## 接口：验证令牌

### 基本信息
- **接口地址**：`/api/v1/auth/verify-token`
- **请求方法**：`POST`
- **认证方式**：无需认证

### 请求头
| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| `Content-Type` | `string` | 是 | 固定值：`application/json` |

### 请求体
```json
{
  "token": "access_xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
}
```

| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| `token` | `string` | 是 | 访问令牌 |

### 响应体
#### 成功响应 (200)
```json
{
  "success": true,
  "message": "令牌有效",
  "data": {
    "userId": 1,
    "username": "testuser",
    "email": "test@example.com",
    "role": "user",
    "isValid": true
  }
}
```

| 字段名 | 类型 | 描述 |
|--------|------|------|
| `success` | `boolean` | 请求是否成功 |
| `message` | `string` | 操作结果消息 |
| `data` | `object` | 用户信息 |

**data 对象字段：**
| 字段名 | 类型 | 描述 |
|--------|------|------|
| `userId` | `integer` | 用户ID |
| `username` | `string` | 用户名 |
| `email` | `string` | 邮箱 |
| `role` | `string` | 用户角色 |
| `isValid` | `boolean` | 令牌是否有效 |

#### 错误响应
**400 Bad Request**
```json
{
  "success": false,
  "message": "令牌不能为空",
  "data": null
}
```

**200（令牌无效）**
```json
{
  "success": false,
  "message": "令牌无效",
  "data": {
    "userId": null,
    "username": null,
    "email": null,
    "role": null,
    "isValid": false
  }
}
```
或
```json
{
  "success": false,
  "message": "令牌已过期",
  "data": {
    "userId": null,
    "username": null,
    "email": null,
    "role": null,
    "isValid": false
  }
}
```

**500 Internal Server Error**
```json
{
  "success": false,
  "message": "服务器内部错误",
  "data": null
}
```

### 状态码说明
| 状态码 | 说明 |
|--------|------|
| 200 | 验证完成（无论令牌是否有效） |
| 400 | 请求参数错误 |
| 500 | 服务器内部错误 |

### 业务说明
1. 令牌验证：验证访问令牌是否存在且未过期
2. 用户信息：返回令牌对应的用户基本信息
3. 过期处理：删除过期的会话记录

---

## 接口：通过请求头验证令牌

### 基本信息
- **接口地址**：`/api/v1/auth/verify-token-header`
- **请求方法**：`GET`
- **认证方式**：Bearer Token（通过Authorization头）

### 请求头
| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| `Authorization` | `string` | 是 | Bearer Token，格式：`Bearer {token}` |

### 请求体
无

### 响应体
与"验证令牌"接口相同

### 状态码说明
与"验证令牌"接口相同

### 业务说明
1. 便捷验证：通过请求头直接验证令牌，无需传递请求体
2. 功能相同：与POST方式的验证令牌接口功能一致

好的，我已经详细分析了您提供的所有Java后端接口文件。根据代码中的定义和逻辑，我为您整理了一份完整的、供前端开发团队使用的API接口文档。

文档结构清晰，包含每个接口的详细信息，并遵循了规范的格式。

---

# **文档管理API接口文档 (v1)**

## **概述**

本文档定义了用于“阅读APP”文档管理模块的后端API接口。前端开发人员可以根据此文档进行接口的调用和开发。

*   **基础 URL**: `/api/v1/documents`
*   **认证方式**: 所有需要用户认证的接口，都需要在请求头（Request Header）中携带 `Authorization` 字段，格式为 `Bearer <your_access_token>`。

---

## **1. 文档列表与详情**

### 1.1 获取文档列表

-   **请求地址**: `/api/v1/documents`
-   **请求方法**: `GET`
-   **接口描述**: 获取当前登录用户的文档列表，支持分页、排序、搜索和过滤。

#### **请求头 (Request Headers)**

| 参数名        | 类型   | 是否必填 | 描述                                     |
| :------------ | :----- | :------- | :--------------------------------------- |
| `Authorization` | String | 是       | 用户认证令牌，格式: `Bearer <token>` |

#### **请求参数 (Query Parameters)**

| 参数名    | 类型           | 是否必填 | 描述                                                                                                      |
| :-------- | :------------- | :------- | :-------------------------------------------------------------------------------------------------------- |
| `page`      | Integer        | 否       | 页码，默认为 `1`。                                                                                          |
| `pageSize`  | Integer        | 否       | 每页数量，默认为 `20`。                                                                                     |
| `sortBy`    | String         | 否       | 排序字段，可选值为 `created_at` (默认), `updated_at`, `title`, `file_size`, `page_count`。                  |
| `sortOrder` | String         | 否       | 排序顺序，可选值为 `desc` (默认) 或 `asc`。                                                               |
| `search`    | String         | 否       | 搜索关键词，将匹配文档的标题和描述。                                                                      |
| `tags`      | String         | 否       | 按标签过滤，多个标签用逗号分隔，例如 `work,study`。                                                       |
| `language`  | String         | 否       | 按语言过滤，例如 `en`。                                                                                   |
| `status`    | String         | 否       | 按文档状态过滤，例如 `completed`, `processing`。                                                          |

#### **响应格式**

```json
{
  "success": true,
  "message": "获取文档列表成功",
  "data": {
    "documents": [
      {
        "id": 101,
        "title": "项目需求文档",
        "description": "2024年Q3项目需求详细说明。",
        "fileName": "project_requirements.pdf",
        "fileSize": "2.35 MB",
        "fileType": "application/pdf",
        "language": "zh-CN",
        "pageCount": 45,
        "readProgress": 20,
        "tags": ["work", "project-x"],
        "isPublic": false,
        "isFavorite": true,
        "uploader": "frontend_dev",
        "createdAt": "2024-05-20T10:30:00",
        "updatedAt": "2024-05-21T11:00:00",
        "thumbnail": null
      }
    ],
    "pagination": {
      "page": 1,
      "pageSize": 20,
      "total": 1,
      "totalPages": 1
    }
  }
}
```

-   **`data.documents` 字段说明**:
    | 字段名         | 类型            | 描述                       |
    | :------------- | :-------------- | :------------------------- |
    | `id`         | Integer         | 文档唯一ID                 |
    | `title`        | String          | 文档标题                   |
    | `description`  | String          | 文档描述                   |
    | `fileName`     | String          | 原始文件名                 |
    | `fileSize`     | String          | 格式化后的文件大小（例如 "2.35 MB"）|
    | `fileType`     | String          | 文件MIME类型               |
    | `language`     | String          | 文档语言                   |
    | `pageCount`    | Integer         | 文档总页数                 |
    | `readProgress` | Integer         | 阅读进度（百分比，0-100）    |
    | `tags`         | Array\<String>   | 标签列表                   |
    | `isPublic`     | Boolean         | 是否公开                   |
    | `isFavorite`   | Boolean         | 是否收藏                   |
    | `uploader`     | String          | 上传者用户名               |
    | `createdAt`    | String (ISO 8601) | 创建时间 |
    | `updatedAt`    | String (ISO 8601) | 最后更新时间 |
    | `thumbnail`    | String          | 缩略图URL（当前为 `null`） |
-   **`data.pagination` 字段说明**:
    | 字段名       | 类型    | 描述       |
    | :----------- | :------ | :--------- |
    | `page`       | Integer | 当前页码   |
    | `pageSize`   | Integer | 每页数量   |
    | `total`      | Integer | 总记录数   |
    | `totalPages` | Integer | 总页数     |

#### **状态码说明**

| 状态码 | 描述                                   |
| :----- | :------------------------------------- |
| `200`  | `OK` - 成功获取列表。                    |
| `401`  | `Unauthorized` - 未登录或登录过期。      |
| `500`  | `Internal Server Error` - 服务器内部错误。 |

---

### 1.2 获取单个文档详情

-   **请求地址**: `/api/v1/documents/{documentId}`
-   **请求方法**: `GET`
-   **接口描述**: 获取指定ID的文档的详细信息。

#### **请求头 (Request Headers)**

| 参数名        | 类型   | 是否必填 | 描述                                     |
| :------------ | :----- | :------- | :--------------------------------------- |
| `Authorization` | String | 是       | 用户认证令牌，格式: `Bearer <token>` |

#### **请求参数 (Path Parameters)**

| 参数名       | 类型    | 描述     |
| :----------- | :------ | :------- |
| `documentId` | Integer | 文档的ID |

#### **响应格式**

```json
{
  "success": true,
  "message": "获取文档详情成功",
  "data": {
    "document": {
      "id": 101,
      "title": "项目需求文档",
      "description": "2024年Q3项目需求详细说明。",
      "fileName": "project_requirements.pdf",
      "filePath": "uploads/documents/1621512600000_uuid.pdf",
      "fileSize": "2.35 MB",
      "fileType": "application/pdf",
      "language": "zh-CN",
      "pageCount": 45,
      "readProgress": 20,
      "currentPage": 9,
      "tags": ["work", "project-x"],
      "isPublic": false,
      "isFavorite": true,
      "isProcessed": true,
      "processingStatus": "completed",
      "uploader": "frontend_dev",
      "createdAt": "2024-05-20T10:30:00",
      "updatedAt": "2024-05-21T11:00:00",
      "lastReadAt": "2024-05-21T10:55:00",
      "thumbnail": null,
      "metadata": {}
    }
  }
}
```

-   **`data.document` 字段说明**:
    -   包含1.1中 `DocumentDTO` 的所有字段。
    -   **额外字段**:
        | 字段名             | 类型                 | 描述                         |
        | :----------------- | :------------------- | :--------------------------- |
        | `filePath`         | String               | 文件在服务器上的存储路径     |
        | `currentPage`      | Integer              | 当前阅读到的页码             |
        | `isProcessed`      | Boolean              | 文档是否已处理完成           |
        | `processingStatus` | String               | 处理状态（如 `pending`, `completed`） |
        | `lastReadAt`       | String (ISO 8601)    | 最后阅读时间                 |
        | `metadata`         | Object               | 其他元数据（当前为空对象）   |

#### **状态码说明**

| 状态码 | 描述                                               |
| :----- | :------------------------------------------------- |
| `200`  | `OK` - 成功获取详情。                                |
| `401`  | `Unauthorized` - 未登录或登录过期。                  |
| `404`  | `Not Found` - 文档不存在，或不属于当前用户。     |
| `500`  | `Internal Server Error` - 服务器内部错误。         |

---

## **2. 文档操作 (增删改)**

### 2.1 上传新文档

-   **请求地址**: `/api/v1/documents/upload`
-   **请求方法**: `POST`
-   **接口描述**: 上传一个新文档文件及其元数据。**注意：这是一个 `multipart/form-data` 请求**。

#### **请求头 (Request Headers)**

| 参数名        | 类型   | 是否必填 | 描述                                     |
| :------------ | :----- | :------- | :--------------------------------------- |
| `Authorization` | String | 是       | 用户认证令牌，格式: `Bearer <token>` |
| `Content-Type`  | String | 是       | 必须为 `multipart/form-data`             |

#### **请求参数 (Form Data)**

| 参数名        | 类型          | 是否必填 | 描述                                                                                                                        |
| :------------ | :------------ | :------- | :-------------------------------------------------------------------------------------------------------------------------- |
| `file`        | File          | 是       | 要上传的文档文件。支持的类型包括 `pdf`, `epub`, `doc`, `docx`, `txt`, `html`。最大100MB。                                      |
| `title`       | String        | 是       | 文档标题。                                                                                                                  |
| `description` | String        | 否       | 文档描述。                                                                                                                  |
| `tags`        | String        | 否       | 标签，可以是逗号分隔的字符串（`"tag1,tag2"`），也可以是JSON字符串数组（`'["tag1","tag2"]'`）。                         |
| `language`    | String        | 否       | 文档语言，例如 `en`、`zh-CN`。                                                                                                |

#### **响应格式**

```json
{
  "success": true,
  "message": "文档上传成功",
  "data": {
    "document": {
      "id": 102,
      "title": "新上传的测试文档",
      "fileName": "test.pdf",
      "fileSize": "1.05 MB",
      "fileType": "application/pdf",
      "status": "uploading",
      "processingProgress": 0,
      "createdAt": "2024-05-22T14:00:00"
    }
  }
}
```

#### **状态码说明**

| 状态码 | 描述                                                                |
| :----- | :------------------------------------------------------------------ |
| `200`  | `OK` - 上传成功。                                                     |
| `400`  | `Bad Request` - 文件为空、文件类型不支持、文件太大或缺少`title`。 |
| `401`  | `Unauthorized` - 未登录或登录过期。                                   |
| `500`  | `Internal Server Error` - 文件保存失败或服务器内部错误。              |


---

### 2.2 更新文档信息

-   **请求地址**: `/api/v1/documents/{documentId}`
-   **请求方法**: `PUT`
-   **接口描述**: 更新指定文档的元数据。

#### **请求头 (Request Headers)**

| 参数名        | 类型   | 是否必填 | 描述                                     |
| :------------ | :----- | :------- | :--------------------------------------- |
| `Authorization` | String | 是       | 用户认证令牌，格式: `Bearer <token>` |

#### **请求参数 (Path Parameters)**

| 参数名       | 类型    | 描述     |
| :----------- | :------ | :------- |
| `documentId` | Integer | 文档的ID |

#### **请求体 (Request Body - JSON)**

所有字段均为可选，但至少需要提供一个。

```json
{
  "title": "更新后的文档标题",
  "description": "这是更新后的描述。",
  "tags": ["updated-tag", "review"],
  "language": "en",
  "isPublic": false,
  "isFavorite": true
}
```

#### **响应格式**

```json
{
  "success": true,
  "message": "文档更新成功",
  "data": {
    "document": {
      "id": 101,
      "title": "更新后的文档标题",
      "description": "这是更新后的描述。",
      "language": "en",
      "tags": ["updated-tag", "review"],
      "isPublic": false,
      "isFavorite": true,
      "updatedAt": "2024-05-22T15:00:00"
    }
  }
}
```

#### **状态码说明**

| 状态码 | 描述                                                                |
| :----- | :------------------------------------------------------------------ |
| `200`  | `OK` - 更新成功。                                                     |
| `400`  | `Bad Request` - 请求体为空或未提供任何可更新的字段。                  |
| `401`  | `Unauthorized` - 未登录或登录过期。                                   |
| `404`  | `Not Found` - 文档不存在，或不属于当前用户。                        |
| `500`  | `Internal Server Error` - 服务器内部错误。                          |

---

### 2.3 删除单个文档

-   **请求地址**: `/api/v1/documents/{documentId}`
-   **请求方法**: `DELETE`
-   **接口描述**: 软删除一个指定的文档（将其标记为已删除，而不是物理删除）。

#### **请求头 (Request Headers)**

| 参数名        | 类型   | 是否必填 | 描述                                     |
| :------------ | :-----| :------- |:---------------------------------------|
| `Authorization` | String | 是       | 用户认证令牌，格式: `Bearer <token>` |

#### **请求参数 (Path Parameters)**

| 参数名       | 类型    | 描述     |
| :----------- | :------ | :------- |
| `documentId` | Integer | 文档的ID |

#### **响应格式**

```json
{
  "success": true,
  "message": "文档 '项目需求文档' 删除成功",
  "data": {
    "deletedId": 101
  }
}
```

#### **状态码说明**

| 状态码 | 描述                                               |
| :----- | :------------------------------------------------- |
| `200`  | `OK` - 删除成功。                                  |
| `401`  | `Unauthorized` - 未登录或登录过期。                  |
| `404`  | `Not Found` - 文档不存在，或不属于当前用户。     |
| `500`  | `Internal Server Error` - 服务器内部错误。         |

---

## **3. 批量操作**

### 3.1 批量删除文档

-   **请求地址**: `/api/v1/documents/batch`
-   **请求方法**: `DELETE`
-   **接口描述**: 批量软删除多个文档。

#### **请求头 (Request Headers)**

| 参数名        | 类型   | 是否必填 | 描述                                     |
| :------------| :-----| :------- |:---------------------------------------|
| `Authorization` | String | 是       | 用户认证令牌，格式: `Bearer <token>` |

#### **请求体 (Request Body - JSON)**

```json
{
  "documentIds": [101, 102, 103]
}
```

#### **响应格式**

```json
{
  "success": true,
  "message": "成功删除 2 个文档，1 个文档删除失败",
  "data": {
    "processedCount": 3,
    "successCount": 2,
    "failedCount": 1,
    "failedIds": [103]
  }
}
```

#### **状态码说明**

| 状态码 | 描述                                           |
| :----- | :--------------------------------------------- |
| `200`  | `OK` - 批量删除操作完成。                        |
| `400`  | `Bad Request` - `documentIds` 列表不能为空。       |
| `401`  | `Unauthorized` - 未登录或登录过期。              |
| `500`  | `Internal Server Error` - 服务器内部错误。     |

---

### 3.2 批量更新文档属性

-   **请求地址**: `/api/v1/documents/batch`
-   **请求方法**: `PUT`
-   **接口描述**: 将相同的属性更新应用到多个文档上。

#### **请求头 (Request Headers)**

| 参数名        | 类型   | 是否必填 | 描述                                     |
| :------------ | :-----| :------- |:---------------------------------------|
| `Authorization` | String | 是       | 用户认证令牌，格式: `Bearer <token>` |

#### **请求体 (Request Body - JSON)**

-   `documentIds` 是必须的。
-   其他字段（`title`, `description`, `tags`等）至少提供一个，所有指定的文档将被更新为相同的值。

```json
{
  "documentIds": [101, 102],
  "language": "en",
  "isFavorite": true,
  "tags": ["archive", "english"]
}
```

#### **响应格式**

```json
{
  "success": true,
  "message": "成功更新 2 个文档",
  "data": {
    "processedCount": 2,
    "successCount": 2,
    "failedCount": 0,
    "failedIds": []
  }
}
```

#### **状态码说明**

| 状态码 | 描述                                                 |
| :----- | :--------------------------------------------------- |
| `200`  | `OK` - 批量更新操作完成。                              |
| `400`  | `Bad Request` - `documentIds` 列表为空或未提供更新字段。 |
| `401`  | `Unauthorized` - 未登录或登录过期。                    |
| `500`  | `Internal Server Error` - 服务器内部错误。           |

---

### 3.3 批量执行通用操作

-   **请求地址**: `/api/v1/documents/batch-action`
-   **请求方法**: `POST`
-   **接口描述**: 对多个文档执行指定的通用操作，如收藏、取消收藏、设为公开/私有、删除或更新。

#### **请求头 (Request Headers)**

| 参数名        | 类型   | 是否必填 | 描述                                     |
| :------------ | :-----| :------- |:---------------------------------------|
| `Authorization` | String | 是       | 用户认证令牌，格式: `Bearer <token>` |

#### **请求参数 (Query Parameters)**

| 参数名   | 类型   | 是否必填 | 描述                                                                                                      |
| :------- | :----- | :------- | :-------------------------------------------------------------------------------------------------------- |
| `action` | String | 是       | 操作类型。可选值为：`update`, `delete`, `favorite`, `unfavorite`, `public`, `private`。                      |

#### **请求体 (Request Body - JSON)**

-   **通用结构**:
    ```json
    {
      "ids": [101, 102, 103],
      "data": { ... }
    }
    ```
-   `ids`: (必需) 要操作的文档ID列表。
-   `data`: (可选) 仅当 `action` 为 `update` 时使用，包含要更新的键值对。

#### **示例请求**

1.  **示例1：批量收藏**
    -   `action=favorite`
    -   Body:
        ```json
        {
          "ids": [101, 102]
        }
        ```

2.  **示例2：批量更新**
    -   `action=update`
    -   Body:
        ```json
        {
          "ids": [103, 104],
          "data": {
            "isPublic": true,
            "language": "fr"
          }
        }
        ```

3.  **示例3：批量删除**
    -   `action=delete`
    -   Body:
        ```json
        {
          "ids": [105]
        }
        ```

#### **响应格式**

```json
{
  "success": true,
  "message": "成功对 2 个文档执行 favorite 操作，1 个文档操作失败",
  "data": {
    "processedCount": 3,
    "successCount": 2,
    "failedCount": 1,
    "failedIds": [103],
    "failedItems": [
      {
        "id": 103,
        "reason": "文档不存在或没有权限"
      }
    ]
  }
}
```

#### **状态码说明**

| 状态码 | 描述                                                               |
| :----- | :----------------------------------------------------------------- |
| `200`  | `OK` - 批量操作完成。                                                |
| `400`  | `Bad Request` - `action` 或 `ids` 为空，或 `action` 类型不支持。 |
| `401`  | `Unauthorized` - 未登录或登录过期。                                  |
| `500`  | `Internal Server Error` - 服务器内部错误。                         |

---

## **4. 其他功能**

### 4.1 复制文档

-   **请求地址**: `/api/v1/documents/{documentId}/duplicate`
-   **请求方法**: `POST`
-   **接口描述**: 创建一个指定文档的副本。新文档的标题会加上“副本 - ”前缀，阅读进度等状态会重置。

#### **请求头 (Request Headers)**

| 参数名        | 类型   | 是否必填 | 描述                                     |
| :------------ | :-----| :------- |:---------------------------------------|
| `Authorization` | String | 是       | 用户认证令牌，格式: `Bearer <token>` |

#### **请求参数 (Path Parameters)**

| 参数名       | 类型    | 描述     |
| :----------- | :------ | :------- |
| `documentId` | Integer | 要复制的源文档ID |

#### **响应格式**

```json
{
  "success": true,
  "message": "文档复制成功",
  "data": {
    "document": {
      "id": 103,
      "title": "副本 - 项目需求文档",
      "fileName": "copy_of_project_requirements.pdf",
      "fileSize": "2.35 MB",
      "fileType": "application/pdf",
      "status": "uploading",
      "createdAt": "2024-05-22T16:00:00"
    }
  }
}
```

#### **状态码说明**

| 状态码 | 描述                                                              |
| :----- | :---------------------------------------------------------------- |
| `200`  | `OK` - 复制成功。                                                   |
| `401`  | `Unauthorized` - 未登录或登录过期。                                 |
| `404`  | `Not Found` - 源文档不存在或原始文件丢失。                      |
| `500`  | `Internal Server Error` - 文件复制失败或服务器内部错误。        |

---

### 4.2 导出/下载文档

-   **请求地址**: `/api/v1/documents/{documentId}/export`
-   **请求方法**: `GET`
-   **接口描述**: 下载指定格式的文档文件。**注意：此接口的响应是文件流，而非JSON**。浏览器会触发文件下载。

#### **请求头 (Request Headers)**

| 参数名        | 类型   | 是否必填 | 描述                                     |
| :------------ | :-----| :------- |:---------------------------------------|
| `Authorization` | String | 是       | 用户认证令牌，格式: `Bearer <token>` |

#### **请求参数**

-   **Path Parameters**:
    | 参数名       | 类型    | 描述     |
    | :----------- | :------ | :------- |
    | `documentId` | Integer | 文档的ID |

-   **Query Parameters**:
    | 参数名   | 类型   | 是否必填 | 描述                                                                          |
    | :------- | :----- | :------- | :---------------------------------------------------------------------------- |
    | `format` | String | 否       | 导出的文件格式。可选值：`pdf` (默认), `txt`, `epub`。 如果不提供，则返回原文件。 |

#### **响应格式**

-   成功时，响应体为文件二进制流。
-   响应头 `Content-Disposition` 会包含建议的文件名，例如 `attachment; filename="document-title.pdf"`。

#### **状态码说明**

| 状态码 | 描述                                                              _ |
| :----- | :------------------------------------------------------------------ |
| `200`  | `OK` - 成功返回文件流。                                               |
| `401`  | `Unauthorized` - 未登录或登录过期。                                   |
| `404`  | `Not Found` - 文档或其物理文件不存在。                              |
| `500`  | `Internal Server Error` - 文件读取错误或服务器内部错误。            |

---
### 4.3 获取文档统计信息
-   **请求地址**: `/api/v1/documents/stats`
-   **请求方法**: `GET`
-   **接口描述**: 获取当前用户的所有文档的统计信息。

#### **请求头 (Request Headers)**

| 参数名        | 类型   | 是否必填 | 描述                                     |
| :------------ | :-----| :------- |:---------------------------------------|
| `Authorization` | String | 是       | 用户认证令牌，格式: `Bearer <token>` |

#### **响应格式**
```json
{
  "success": true,
  "message": "获取文档统计信息成功",
  "data": {
    "stats": {
      "totalDocuments": 150,
      "totalSize": "1.20 GB",
      "byLanguage": {
        "en": 100,
        "zh-CN": 40,
        "unknown": 10
      },
      "byType": {
        "application/pdf": 120,
        "application/epub+zip": 30
      },
      "recentUploads": [
        {
          "id": 250,
          "title": "最新上传的书",
          "fileName": "latest_book.epub",
          "fileSize": "5.50 MB",
          "createdAt": "2024-05-22T10:00:00"
        }
      ],
      "readingStats": {
        "totalReadingTime": 72000,
        "averageReadingTime": 480,
        "completedDocuments": 25
      }
    }
  }
}
```
- **`data.stats` 字段说明**:
    | 字段名         | 类型               | 描述                                       |
    | :------------- |:-------------------|:-------------------------------------------|
    | `totalDocuments`| Integer            | 文档总数                                   |
    | `totalSize`     | String             | 总文件大小（格式化后）                       |
    | `byLanguage`    | Object             | 按语言统计的文档数量，键为语言代码，值为数量   |
    | `byType`        | Object             | 按文件类型统计的文档数量                     |
    | `recentUploads` | Array&lt;Object&gt; | 最近上传的文档列表（最多10个）             |
    | `readingStats`  | Object             | 阅读统计信息                               |
- **`readingStats` 字段说明**:
    | 字段名               | 类型    | 描述                                       |
    |:---------------------|:--------|:-------------------------------------------|
    | `totalReadingTime`   | Integer | 总阅读时间（秒，估算值）                      |
    | `averageReadingTime` | Integer | 平均每篇文档的阅读时间（秒，估算值）              |
    | `completedDocuments` | Integer | 已完成阅读的文档数（进度>90%）                  |

#### **状态码说明**
| 状态码 | 描述                                   |
|:-------|:---------------------------------------|
| `200`  | `OK` - 成功获取统计信息。                  |
| `401`  | `Unauthorized` - 未登录或登录过期。      |
| `500`  | `Internal Server Error` - 服务器内部错误。 |

---
### 4.4 分享文档
-   **请求地址**: `/api/v1/documents/{documentId}/share`
-   **请求方法**: `POST`
-   **接口描述**: 创建或更新文档的分享设置。

#### **请求头 (Request Headers)**

| 参数名        | 类型   | 是否必填 | 描述                                     |
|:------------|:-------|:---------|:---------------------------------------|
| `Authorization` | String | 是       | 用户认证令牌，格式: `Bearer <token>` |

#### **请求参数 (Path Parameters)**
| 参数名       | 类型    | 描述     |
|:-------------|:--------|:---------|
| `documentId` | Integer | 文档的ID |

#### **请求体 (Request Body - JSON)**
所有字段均为可选。
```json
{
  "isPublic": true,
  "password": "my-secret-password-123",
  "expiryDate": "2024-12-31T23:59:59Z",
  "allowedUsers": ["user1@example.com", "user2@example.com"]
}
```

#### **响应格式**
```json
{
  "success": true,
  "message": "文档 '我的分享' 分享成功",
  "data": {
    "document": {
      "id": 101,
      "title": "我的分享",
      "isPublic": true,
      "shareLink": "https://readmemo.app/share/unique-uuid-string",
      "hasPassword": true,
      "expiryDate": "2024-12-31T23:59:59Z",
      "updatedAt": "2024-05-22T18:00:00"
    }
  }
}
```

#### **状态码说明**
| 状态码 | 描述                                       |
|:-------|:-------------------------------------------|
| `200`  | `OK` - 分享设置成功。                        |
| `400`  | `Bad Request` - 请求体为空。               |
| `401`  | `Unauthorized` - 未登录或登录过期。          |
| `404`  | `Not Found` - 文档不存在。                 |
| `500`  | `Internal Server Error` - 服务器内部错误。 |
---
### 4.5 取消分享文档
-   **请求地址**: `/api/v1/documents/{documentId}/share`
-   **请求方法**: `DELETE`
-   **接口描述**: 取消文档的分享，清除所有分享设置。

#### **请求头 (Request Headers)**

| 参数名        | 类型   | 是否必填 | 描述                                     |
|:------------|:-------|:---------|:---------------------------------------|
| `Authorization` | String | 是       | 用户认证令牌，格式: `Bearer <token>` |

#### **请求参数 (Path Parameters)**
| 参数名       | 类型    | 描述     |
|:-------------|:--------|:---------|
| `documentId` | Integer | 文档的ID |
#### **响应格式**
```json
{
  "success": true,
  "message": "文档 '我的分享' 取消分享成功",
  "data": {
    "document": {
      "id": 101,
      "title": "我的分享",
      "isPublic": false,
      "updatedAt": "2024-05-22T19:00:00"
    }
  }
}
```
#### **状态码说明**
| 状态码 | 描述                                       |
|:-------|:-------------------------------------------|
| `200`  | `OK` - 成功取消分享。                        |
| `401`  | `Unauthorized` - 未登录或登录过期。          |
| `404`  | `Not Found` - 文档不存在。                 |
| `500`  | `Internal Server Error` - 服务器内部错误。 |

---
### 4.6 全文搜索
-   **请求地址**: `/api/v1/documents/search`
-   **请求方法**: `GET`
-   **接口描述**: 在当前用户的所有文档中进行全文搜索。

#### **请求头 (Request Headers)**

| 参数名        | 类型   | 是否必填 | 描述                                     |
|:------------|:-------|:---------|:---------------------------------------|
| `Authorization` | String | 是       | 用户认证令牌，格式: `Bearer <token>` |

#### **请求参数 (Query Parameters)**

| 参数名     | 类型    | 是否必填 | 描述                                                 |
|:---------|:--------|:---------|:-----------------------------------------------------|
| `query`    | String  | 是       | 搜索关键词。                                         |
| `page`     | Integer | 否       | 页码，默认为 `1`。                                     |
| `pageSize` | Integer | 否       | 每页数量，默认为 `20`。                                |
| `sortBy`   | String  | 否       | 排序方式，可选值: `relevance` (相关度, 默认), `created_at`。 |

#### **响应格式**
```json
{
  "success": true,
  "message": "搜索文档成功",
  "data": {
    "documents": [
      {
        "id": 101,
        "title": "关于全文搜索的文档",
        "description": "本文档详细介绍了如何实现一个高效的全文搜索功能。",
        "fileName": "fulltext-search.pdf",
        "fileSize": "0.50 MB",
        "fileType": "application/pdf",
        "language": "zh-CN",
        "pageCount": 10,
        "readProgress": 0,
        "tags": ["tech", "search"],
        "relevance": 1.5,
        "highlights": {
          "title": ["关于全文<strong>搜索</strong>的文档"],
          "description": ["...高效的全文<strong>搜索</strong>功能。"]
        },
        "createdAt": "2024-05-20T11:00:00",
        "thumbnail": null
      }
    ],
    "pagination": {
      "page": 1,
      "pageSize": 20,
      "total": 1,
      "totalPages": 1
    }
  }
}
```
- **`data.documents` 字段说明**: 
  - 包含 `id`, `title`, `fileName` 等基础信息。
  - **特殊字段**:
    | 字段名      | 类型                     | 描述                                                         |
    |:----------|:-------------------------|:-------------------------------------------------------------|
    | `relevance` | Double                   | 相关度分数，越高表示与搜索词越相关。                              |
    | `highlights`| Object                   | 搜索结果高亮片段。键是字段名（如 `title`），值是包含高亮标签的文本片段数组。 |

#### **状态码说明**
| 状态码 | 描述                                     |
|:-------|:-----------------------------------------|
| `200`  | `OK` - 搜索成功。                        |
| `400`  | `Bad Request` - `query` 参数为空。       |
| `401`  | `Unauthorized` - 未登录或登录过期。        |
| `500`  | `Internal Server Error` - 服务器内部错误。 |
好的，已经为您分析了所有提供的 Java 文件，并整理出了一份完整、详细的API接口文档。这份文档专为前端开发团队设计，包含了所有必要的接口信息。

---

# API 接口文档: 数据导出模块 (`/api/v1/export`)

## 通用说明

### 1. 基础URL
所有接口的基础路径为 `/api/v1/export`。

### 2. 认证方式
所有接口均需要通过 `Authorization` 请求头进行认证。

| 参数名 | 位置 | 类型 | 是否必须 | 描述 |
| :--- | :--- | :--- | :--- | :--- |
| `Authorization` | Header | String | 是 | 认证令牌，格式为 `Bearer <your_token>`。 |

### 3. 通用错误响应格式
当请求发生错误时（如参数验证失败、未授权、资源未找到等），服务端会返回统一的JSON错误响应。

**状态码:** `4xx` 或 `5xx`

**响应体 (`ErrorResponse`):**
```json
{
  "success": false,
  "error": {
    "code": "ERROR_CODE",
    "message": "错误的中文描述",
    "details": {
      "field_name": "详细的错误信息"
    }
  }
}
```

| 字段 | 类型 | 描述 |
| :--- | :--- | :--- |
| `success` | Boolean | 操作是否成功，固定为 `false`。 |
| `error` | Object | 错误详情对象。 |
| `error.code` | String | 唯一的错误代码，用于程序识别。 |
| `error.message` | String | 错误的中文描述，可直接展示给用户。 |
| `error.details` | Object | 包含具体错误字段和信息的对象。 |

---

## 接口详情

### 1. 批量导出数据 (BatchExport)

- **接口描述:** 根据指定的类型列表，将用户数据打包成一个 ZIP 文件进行导出。
- **请求:**
  - `请求方法:` **POST**
  - `请求地址:` `/api/v1/export/batch`
  - `请求头 (Headers):`

| 参数名 | 类型 | 是否必须 | 描述 |
| :--- | :--- | :--- | :--- |
| `Authorization` | String | 是 | `Bearer <your_token>` |
| `Content-Type` | String | 是 | `application/json` |
  - `请求体 (Body):`

| 参数名 | 类型 | 是否必须 | 描述 |
| :--- | :--- | :--- | :--- |
| `types` | List<String\> | 是 | 需要导出的数据类型列表。支持的值: `documents`, `vocabulary`, `reviews`, `statistics`, `notes`, `highlights`, `reading_history`。 |
| `format` | String | 否 (默认: "zip") | 导出格式，目前仅支持 `zip`。 |
| `template` | Map<String, Object\>| 否 | 导出模板配置（当前版本未使用，可留空）。 |
- **响应 (成功):**
  - `状态码:` **200 OK**
  - `响应体:` **文件流**。浏览器会自动触发文件下载。
  - `响应头 (Headers):`
    - `Content-Type: application/zip`
    - `Content-Disposition: attachment; filename="batch_export_YYYY-MM-DD_HH-mm-ss.zip"`
- **响应 (失败):**
  - `400 Bad Request`: 参数验证失败（如`types`为空或包含不支持的类型）。
  - `401 Unauthorized`: 认证失败。
  - `404 Not Found`: 未找到任何可导出的数据。
  - `500 Internal Server Error`: 服务器内部错误。
- **CURL 示例:**
  ```bash
  curl -X POST 'http://localhost:8080/api/v1/export/batch' \
  -H 'Authorization: Bearer <your_token>' \
  -H 'Content-Type: application/json' \
  -d '{
    "types": ["documents", "notes", "vocabulary"],
    "format": "zip"
  }' \
  --output my_export.zip
  ```

---

### 2. 导出用户所有数据 (ExportAllData)

- **接口描述:** 将当前用户的所有数据（文档、词汇、笔记等）打包成一个 JSON 文件进行导出。
- **请求:**
  - `请求方法:` **GET**
  - `请求地址:` `/api/v1/export/all`
  - `请求头 (Headers):`

| 参数名 | 类型 | 是否必须 | 描述 |
| :--- | :--- | :--- | :--- |
| `Authorization` | String | 是 | `Bearer <your_token>` |
  - `查询参数 (Query Parameters):`

| 参数名 | 类型 | 是否必须 | 描述 |
| :--- | :--- | :--- | :--- |
| `format` | String | 否 (默认: "json") | 导出格式，目前仅支持 `json`。 |
| `encrypt` | Boolean| 否 (默认: false) | 是否加密导出文件（当前版本暂不支持）。 |
- **响应 (成功):**
  - `状态码:` **200 OK**
  - `响应体:` **文件流**，一个包含所有用户数据的 JSON 文件。
  - `响应头 (Headers):`
    - `Content-Type: application/json`
    - `Content-Disposition: attachment; filename="all_data_YYYY-MM-DD_HH-mm-ss.json"`
  - `JSON 结构:`
    ```json
    {
      "metadata": {
        "exported_at": "2023-10-27T10:00:00Z",
        "user_id": 123,
        "format": "json",
        "version": "1.0",
        "data_sections": ["user_info", "documents", "vocabulary", "..."]
      },
      "data": {
        "user_info": { ... },
        "documents": [ { ... } ],
        "vocabulary": [ { ... } ],
        "reviews": [ { ... } ],
        "learning_stats": [ { ... } ],
        "notes": [ { ... } ],
        "highlights": [ { ... } ],
        "reading_history": [ { ... } ],
        "settings": [ { ... } ],
        "achievements": [ { ... } ]
      }
    }
    ```
- **响应 (失败):**
  - `400 Bad Request`: 参数验证失败（如`format`不支持）。
  - `401 Unauthorized`: 认证失败。
  - `500 Internal Server Error`: 服务器内部错误。
- **CURL 示例:**
  ```bash
  curl -X GET 'http://localhost:8080/api/v1/export/all' \
  -H 'Authorization: Bearer <your_token>' \
  --output all_my_data.json
  ```

---

### 3. 批量导出文档 (ExportDocuments)

- **接口描述:** 根据指定的文档ID列表，批量导出文档信息。
- **请求:**
  - `请求方法:` **POST**
  - `请求地址:` `/api/v1/export/documents/batch`
  - `请求头 (Headers):`

| 参数名 | 类型 | 是否必须 | 描述 |
| :--- | :--- | :--- | :--- |
| `Authorization` | String | 是 | `Bearer <your_token>` |
| `Content-Type` | String | 是 | `application/json` |
  - `请求体 (Body):`

| 参数名 | 类型 | 是否必须 | 描述 |
| :--- | :--- | :--- | :--- |
| `document_ids` | List<Integer\> | 是 | 需要导出的文档ID列表，最多100个。 |
| `format` | String | 否 (默认: "pdf") | 导出格式。支持: `pdf`, `docx`, `xlsx`, `csv`, `json`, `html`, `txt`。 |
| `include_notes` | Boolean | 否 (默认: true) | 是否在导出内容中包含相关笔记。 |
| `include_highlights` | Boolean | 否 (默认: true) | 是否在导出内容中包含相关高亮。 |
- **响应 (成功):**
  - `状态码:` **200 OK**
  - `响应体:` **文件流**，根据`format`参数生成相应格式的文件。
  - `响应头 (Headers):`
    - `Content-Type`: 动态变化，如 `application/pdf`, `text/csv` 等。
    - `Content-Disposition: attachment; filename="documents_YYYY-MM-DD_HH-mm-ss.ext"`
- **响应 (失败):**
  - `400 Bad Request`: 参数验证失败（如`document_ids`为空或超过限制）。
  - `401 Unauthorized`: 认证失败。
  - `404 Not Found`: 部分或全部文档ID不存在或无权访问。
  - `500 Internal Server Error`: 服务器内部错误。
- **CURL 示例:**
  ```bash
  curl -X POST 'http://localhost:8080/api/v1/export/documents/batch' \
  -H 'Authorization: Bearer <your_token>' \
  -H 'Content-Type: application/json' \
  -d '{
    "document_ids": [1, 2, 5],
    "format": "json"
  }' \
  --output documents_export.json
  ```

---

### 4. 导出单个文档的高亮 (ExportHighlights)

- **接口描述:** 导出指定文档的所有高亮信息。
- **请求:**
  - `请求方法:` **GET**
  - `请求地址:` `/api/v1/export/documents/{documentId}/highlights`
  - `请求头 (Headers):`

| 参数名 | 类型 | 是否必须 | 描述 |
| :--- | :--- | :--- | :--- |
| `Authorization` | String | 是 | `Bearer <your_token>` |
  - `路径参数 (Path Parameters):`

| 参数名 | 类型 | 是否必须 | 描述 |
| :--- | :--- | :--- | :--- |
| `documentId` | Integer | 是 | 要导出高亮的文档ID。 |
  - `查询参数 (Query Parameters):`

| 参数名 | 类型 | 是否必须 | 描述 |
| :--- | :--- | :--- | :--- |
| `format` | String | 否 (默认: "json") | 导出格式。支持: `json`, `csv`, `pdf`, `txt`。 |
- **响应 (成功):**
  - `状态码:` **200 OK**
  - `响应体:` **文件流**，根据`format`参数生成相应格式的文件。
  - `响应头 (Headers):`
    - `Content-Type`: 动态变化，如 `application/json`, `text/csv` 等。
    - `Content-Disposition: attachment; filename="highlights_{documentId}_YYYY-MM-DD_HH-mm-ss.ext"`
- **响应 (失败):**
  - `400 Bad Request`: `format`不支持。
  - `401 Unauthorized`: 认证失败。
  - `404 Not Found`: 文档不存在或无权访问。
  - `500 Internal Server Error`: 服务器内部错误。
- **CURL 示例:**
  ```bash
  curl -X GET 'http://localhost:8080/api/v1/export/documents/101/highlights?format=json' \
  -H 'Authorization: Bearer <your_token>' \
  --output highlights_101.json
  ```

---

### 5. 批量导出笔记 (ExportNotes)

- **接口描述:** 根据指定的笔记ID列表，批量导出笔记信息。
- **请求:**
  - `请求方法:` **POST**
  - `请求地址:` `/api/v1/export/notes/batch`
  - `请求头 (Headers):`

| 参数名 | 类型 | 是否必须 | 描述 |
| :--- | :--- | :--- | :--- |
| `Authorization` | String | 是 | `Bearer <your_token>` |
| `Content-Type` | String | 是 | `application/json` |
  - `请求体 (Body):`

| 参数名 | 类型 | 是否必须 | 描述 |
| :--- | :--- | :--- | :--- |
| `note_ids` | List<Integer\> | 是 | 需要导出的笔记ID列表，最多200个。 |
| `format` | String | 否 (默认: "pdf") | 导出格式。支持: `pdf`, `html`, `txt`, `docx`, `json`。 |
- **响应 (成功):**
  - `状态码:` **200 OK**
  - `响应体:` **文件流**，根据`format`参数生成相应格式的文件。
  - `响应头 (Headers):`
    - `Content-Type`: 动态变化，如 `application/pdf`, `text/html` 等。
    - `Content-Disposition: attachment; filename="notes_YYYY-MM-DD_HH-mm-ss.ext"`
- **响应 (失败):**
  - `400 Bad Request`: 参数验证失败（如`note_ids`为空或超过限制）。
  - `401 Unauthorized`: 认证失败。
  - `404 Not Found`: 部分或全部笔记ID不存在或无权访问。
  - `500 Internal Server Error`: 服务器内部错误。
- **CURL 示例:**
  ```bash
  curl -X POST 'http://localhost:8080/api/v1/export/notes/batch' \
  -H 'Authorization: Bearer <your_token>' \
  -H 'Content-Type: application/json' \
  -d '{
    "note_ids": [55, 56, 58],
    "format": "html"
  }' \
  --output notes_export.html
  ```
---

### 6. 批量导出词汇 (ExportVocabulary)

- **接口描述:** 根据指定的词汇ID列表，批量导出词汇信息。
- **请求:**
  - `请求方法:` **POST**
  - `请求地址:` `/api/v1/export/vocabulary/batch`
  - `请求头 (Headers):`

| 参数名 | 类型 | 是否必须 | 描述 |
| :--- | :--- | :--- | :--- |
| `Authorization` | String | 是 | `Bearer <your_token>` |
| `Content-Type` | String | 是 | `application/json` |
  - `请求体 (Body):`

| 参数名 | 类型 | 是否必须 | 描述 |
| :--- | :--- | :--- | :--- |
| `vocabulary_ids`| List<Integer\> | 是 | 需要导出的用户词汇ID列表，最多500个。 |
| `format` | String | 否 (默认: "xlsx") | 导出格式。支持: `xlsx`, `csv`, `json`, `pdf`。 |
| `include_examples`| Boolean | 否 (默认: true) | 是否在导出内容中包含例句。 |
| `include_statistics`| Boolean | 否 (默认: true) | 是否在导出内容中包含学习统计信息。 |
- **响应 (成功):**
  - `状态码:` **200 OK**
  - `响应体:` **文件流**，根据`format`参数生成相应格式的文件。
  - `响应头 (Headers):`
    - `Content-Type`: 动态变化，如 `application/vnd.openxmlformats-officedocument.spreadsheetml.sheet`, `text/csv` 等。
    - `Content-Disposition: attachment; filename="vocabulary_YYYY-MM-DD_HH-mm-ss.ext"`
- **响应 (失败):**
  - `400 Bad Request`: 参数验证失败（如`vocabulary_ids`为空或超过限制）。
  - `401 Unauthorized`: 认证失败。
  - `404 Not Found`: 部分或全部词汇ID不存在或无权访问。
  - `500 Internal Server Error`: 服务器内部错误。
- **CURL 示例:**
  ```bash
  curl -X POST 'http://localhost:8080/api/v1/export/vocabulary/batch' \
  -H 'Authorization: Bearer <your_token>' \
  -H 'Content-Type: application/json' \
  -d '{
    "vocabulary_ids": [1001, 1002, 1005],
    "format": "csv",
    "include_examples": true,
    "include_statistics": false
  }' \
  --output vocabulary_export.csv
  ```

---

### 7. 导出词汇至Anki (ExportToAnki)

- **接口描述:** 将指定的词汇列表导出为 Anki 兼容的 CSV 文件。
- **请求:**
  - `请求方法:` **POST**
  - `请求地址:` `/api/v1/export/anki`
  - `请求头 (Headers):`

| 参数名 | 类型 | 是否必须 | 描述 |
| :--- | :--- | :--- | :--- |
| `Authorization` | String | 是 | `Bearer <your_token>` |
| `Content-Type` | String | 是 | `application/json` |
  - `请求体 (Body):`

| 参数名 | 类型 | 是否必须 | 描述 |
| :--- | :--- | :--- | :--- |
| `vocabulary_ids`| List<Integer\> | 是 | 需要导出的用户词汇ID列表，最多500个。 |
| `deck_name` | String | 否 (默认: "语言学习")| Anki 中使用的牌组名称。 |
| `include_audio`| Boolean| 否 (默认: true)| 是否包含音频（当前版本为模拟支持）。 |
| `include_images`| Boolean| 否 (默认: true)| 是否包含图片（当前版本为模拟支持）。 |
- **响应 (成功):**
  - `状态码:` **200 OK**
  - `响应体:` **文件流**，一个 Anki 兼容的 CSV 文件。
  - `响应头 (Headers):`
    - `Content-Type: text/csv`
    - `Content-Disposition: attachment; filename="anki_export_YYYY-MM-DD_HH-mm-ss.csv"`
  - `CSV 列:` `单词`, `音标`, `释义`, `词性`, `例句`, `例句翻译`
- **响应 (失败):**
  - `400 Bad Request`: 参数验证失败（如`vocabulary_ids`为空或超过限制）。
  - `401 Unauthorized`: 认证失败。
  - `404 Not Found`: 部分或全部词汇ID不存在或无权访问。
  - `500 Internal Server Error`: 服务器内部错误。
- **CURL 示例:**
  ```bash
  curl -X POST 'http://localhost:8080/api/v1/export/anki' \
  -H 'Authorization: Bearer <your_token>' \
  -H 'Content-Type: application/json' \
  -d '{
    "vocabulary_ids": [1001, 1002],
    "deck_name": "My English Deck"
  }' \
  --output for_anki.csv
  ```

---

### 8. 批量导出复习记录 (ExportReviews)

- **接口描述:** 批量导出复习会话记录。可以按ID列表或日期范围查询。
- **请求:**
  - `请求方法:` **POST**
  - `请求地址:` `/api/v1/export/reviews/batch`
  - `请求体 (Body):`

| 参数名 | 类型 | 是否必须 | 描述 |
| :--- | :--- | :--- | :--- |
| `review_ids` | List<Integer\> | 条件性 | 需要导出的复习记录ID列表。如果提供了此项，`date_range`将被忽略。 |
| `date_range` | String | 条件性 | 导出指定日期范围内的记录，格式为 "YYYY-MM-DD,YYYY-MM-DD"。`review_ids`和`date_range`必须提供一个。 |
| `format` | String | 否 (默认: "csv")| 导出格式。支持: `csv`, `json`, `pdf`, `xlsx`。 |
- **响应 (成功):**
  - `状态码:` **200 OK**
  - `响应体:` **文件流**，根据`format`参数生成相应格式的文件。
- **响应 (失败):**
  - `400 Bad Request`: 参数验证失败。
  - `401 Unauthorized`: 认证失败。
  - `404 Not Found`: 未找到任何可导出的复习记录。
  - `500 Internal Server Error`: 服务器内部错误。
- **CURL 示例 (按ID):**
  ```bash
  curl -X POST 'http://localhost:8080/api/v1/export/reviews/batch' \
  -H 'Authorization: Bearer <your_token>' \
  -H 'Content-Type: application/json' \
  -d '{
    "review_ids": [30, 31],
    "format": "json"
  }' \
  --output reviews_by_id.json
  ```

- **CURL 示例 (按日期):**
  ```bash
  curl -X POST 'http://localhost:8080/api/v1/export/reviews/batch' \
  -H 'Authorization: Bearer <your_token>' \
  -H 'Content-Type: application/json' \
  -d '{
    "date_range": "2023-01-01,2023-01-31",
    "format": "csv"
  }' \
  --output reviews_by_date.csv
  ```
---

### 9. 导出学习统计 (ExportStatistics)

- **接口描述:** 导出用户的学习统计报告。
- **请求:**
  - `请求方法:` **GET**
  - `请求地址:` `/api/v1/export/statistics`
  - `查询参数 (Query Parameters):`

| 参数名 | 类型 | 是否必须 | 描述 |
| :--- | :--- | :--- | :--- |
| `format` | String | 否 (默认: "pdf") | 导出格式。支持: `pdf`, `xlsx`, `csv`, `json`。 |
| `date_range` | String | 否 (默认: "all")| 统计的日期范围，格式 "YYYY-MM-DD,YYYY-MM-DD" 或 "all"。 |
| `include_charts` | Boolean | 否 (默认: true)| 是否在PDF等格式中包含图表。 |
- **响应 (成功):**
  - `状态码:` **200 OK**
  - `响应体:` **文件流**，根据`format`参数生成相应格式的文件。
- **响应 (失败):**
  - `400 Bad Request`: `format`不支持。
  - `401 Unauthorized`: 认证失败。
  - `500 Internal Server Error`: 服务器内部错误。
- **CURL 示例:**
  ```bash
  curl -X GET 'http://localhost:8080/api/v1/export/statistics?format=json&date_range=2023-10-01,2023-10-27' \
  -H 'Authorization: Bearer <your_token>' \
  --output statistics.json
  ```
---

### 10. 导出阅读历史 (ExportReadingHistory)

- **接口描述:** 导出用户的完整阅读历史记录。
- **请求:**
  - `请求方法:` **GET**
  - `请求地址:` `/api/v1/export/reading-history`
  - `查询参数 (Query Parameters):`

| 参数名 | 类型 | 是否必须 | 描述 |
| :--- | :--- | :--- | :--- |
| `format` | String | 否 (默认: "csv") | 导出格式。支持: `csv`, `json`, `txt`。 |
- **响应 (成功):**
  - `状态码:` **200 OK**
  - `响应体:` **文件流**，根据`format`参数生成相应格式的文件。
- **响应 (失败):**
  - `400 Bad Request`: `format`不支持。
  - `401 Unauthorized`: 认证失败。
  - `404 Not Found`: 未找到任何阅读历史记录。
  - `500 Internal Server Error`: 服务器内部错误。
- **CURL 示例:**
  ```bash
  curl -X GET 'http://localhost:8080/api/v1/export/reading-history?format=csv' \
  -H 'Authorization: Bearer <your_token>' \
  --output reading_history.csv
  ```
---

### 11. 导出学习计划 (ExportStudyPlan)

- **接口描述:** 根据指定的日期范围和每日目标，生成并导出一个文本格式的学习计划。
- **请求:**
  - `请求方法:` **POST**
  - `请求地址:` `/api/v1/export/study-plan`
  - `请求体 (Body):`

| 参数名 | 类型 | 是否必须 | 描述 |
| :--- | :--- | :--- | :--- |
| `start_date`| String | 是 | 计划开始日期，格式 "YYYY-MM-DD"。 |
| `end_date` | String | 是 | 计划结束日期，格式 "YYYY-MM-DD"。 |
| `daily_goal`| Integer| 否 (默认: 20)| 每日学习/复习的词汇目标，范围 1-100。 |
| `include_progress`| Boolean| 否 (默认: true)| 是否在计划中包含进度建议。 |
- **响应 (成功):**
  - `状态码:` **200 OK**
  - `响应体:` **文件流**，一个纯文本 (`.txt`) 文件。
  - `响应头 (Headers):`
    - `Content-Type: text/plain`
    - `Content-Disposition: attachment; filename="study_plan_YYYY-MM-DD_HH-mm-ss.txt"`
- **响应 (失败):**
  - `400 Bad Request`: 参数验证失败。
  - `401 Unauthorized`: 认证失败。
  - `500 Internal Server Error`: 服务器内部错误。
- **CURL 示例:**
  ```bash
  curl -X POST 'http://localhost:8080/api/v1/export/study-plan' \
  -H 'Authorization: Bearer <your_token>' \
  -H 'Content-Type: application/json' \
  -d '{
    "start_date": "2023-11-01",
    "end_date": "2023-11-07",
    "daily_goal": 15
  }' \
  --output my_study_plan.txt
  ```

---

### 12. 获取导出历史记录 (GetExportHistory)

- **接口描述:** 分页获取当前用户的导出历史记录。
- **请求:**
  - `请求方法:` **GET**
  - `请求地址:` `/api/v1/export/history`
  - `查询参数 (Query Parameters):`

| 参数名 | 类型 | 是否必须 | 描述 |
| :--- | :--- | :--- | :--- |
| `page` | Integer | 否 (默认: 1) | 页码。 |
| `page_size`| Integer | 否 (默认: 20)| 每页记录数，范围 1-100。 |
| `sort_by`| String | 否 (默认: "createdAt")| 排序字段。支持: `createdAt`, `type`, `format`, `status`, `itemCount`。 |
| `sort_order`| String | 否 (默认: "desc")| 排序顺序。`asc` 或 `desc`。 |
- **响应 (成功):**
  - `状态码:` **200 OK**
  - `响应体:`
    ```json
    {
      "success": true,
      "message": "查询成功",
      "data": {
        "items": [
          {
            "id": "export_batch_1698389656822_c9b8f2a1",
            "type": "BATCH",
            "format": "zip",
            "itemCount": 0, // 在BATCH导出时，此字段可能不准确，应查看metadata
            "filename": "batch_export_2023-10-27_14-54-16.zip",
            "fileSize": "3456",
            "isBackup": false,
            "userId": 123,
            "createdAt": "2023-10-27T14:54:16.822",
            "status": "COMPLETED",
            "metadata": {
              "export_id": "export_batch_1698389656822_c9b8f2a1",
              "format": "zip",
              "types": "documents,notes",
              "file_count": "3" // 包含 README
            }
          }
        ],
        "pagination": {
          "page": 1,
          "pageSize": 20,
          "totalItems": 1,
          "totalPages": 1,
          "hasNext": false,
          "hasPrevious": false
        }
      }
    }
    ```
- **响应 (失败):**
  - `401 Unauthorized`: 认证失败。
  - `500 Internal Server Error`: 服务器内部错误。
- **CURL 示例:**
  ```bash
  curl -X GET 'http://localhost:8080/api/v1/export/history?page=1&page_size=10' \
  -H 'Authorization: Bearer <your_token>'
  ```

---

### 13. 删除单条导出历史 (DeleteExportHistory)

- **接口描述:** 删除指定的单条导出历史记录。
- **请求:**
  - `请求方法:` **DELETE**
  - `请求地址:` `/api/v1/export/history/{historyId}`
  - `路径参数 (Path Parameters):`

| 参数名 | 类型 | 是否必须 | 描述 |
| :--- | :--- | :--- | :--- |
| `historyId` | String | 是 | 要删除的导出历史ID（`ExportHistoryItem`中的`id`字段）。 |
- **响应 (成功):**
  - `状态码:` **200 OK**
  - `响应体:`
    ```json
    {
      "success": true,
      "message": "删除成功",
      "data": {
        "deletedId": "export_batch_1698389656822_c9b8f2a1",
        "logId": 15,
        "deletedAt": "2023-10-27T15:00:00.123",
        "operationType": "EXPORT",
        "entityType": "BATCH"
      }
    }
    ```
- **响应 (失败):**
  - `400 Bad Request`: `historyId`为空。
  - `401 Unauthorized`: 认证失败。
  - `404 Not Found`: 未找到指定的导出历史记录。
  - `500 Internal Server Error`: 服务器内部错误。
- **CURL 示例:**
  ```bash
  curl -X DELETE 'http://localhost:8080/api/v1/export/history/export_batch_1698389656822_c9b8f2a1' \
  -H 'Authorization: Bearer <your_token>'
  ```

---

### 14. 清理过期导出文件记录 (CleanupExportFiles)

- **接口描述:** 清理指定天数之前的旧导出历史记录。这仅删除数据库记录，不删除实际文件。
- **请求:**
  - `请求方法:` **DELETE**
  - `请求地址:` `/api/v1/export/cleanup`
  - `查询参数 (Query Parameters):`

| 参数名 | 类型 | 是否必须 | 描述 |
| :--- | :--- | :--- | :--- |
| `daysOld` | Integer | 否 (默认: 30) | 清理多少天以前的记录，范围 1-365。 |
- **响应 (成功):**
  - `状态码:` **200 OK**
  - `响应体:`
    ```json
    {
      "success": true,
      "message": "清理成功",
      "data": {
        "deletedCount": 5,
        "freedSpace": 0, // 注意：此字段在当前实现中可能不准确
        "deletedByType": {
          "DOCUMENTS": 2,
          "VOCABULARY": 3
        },
        "cleanupTime": "2023-10-27T15:10:00.456"
      }
    }
    ```
- **响应 (失败):**
  - `400 Bad Request`: `daysOld`超出范围。
  - `401 Unauthorized`: 认证失败。
  - `404 Not Found`: 未找到需要清理的记录。
  - `500 Internal Server Error`: 服务器内部错误。
- **CURL 示例:**
  ```bash
  curl -X DELETE 'http://localhost:8080/api/v1/export/cleanup?daysOld=60' \
  -H 'Authorization: Bearer <your_token>'
  ```

---

### 15. 获取导出统计信息 (GetExportStats)

- **接口描述:** 获取关于用户导出行为的统计数据，如总次数、按类型/格式分布等。
- **请求:**
  - `请求方法:` **GET**
  - `请求地址:` `/api/v1/export/stats`
- **响应 (成功):**
  - `状态码:` **200 OK**
  - `响应体:`
    ```json
    {
        "success": true,
        "message": "查询成功",
        "data": {
            "overall": {
                "total_exports": 120,
                "recent_exports_30d": 15,
                "total_file_size": 15728640, // Bytes
                "avg_file_size": 131072
            },
            "byType": {
                "VOCABULARY": 50,
                "DOCUMENTS": 30,
                "BATCH": 20,
                "NOTES": 20
            },
            "byFormat": {
                "csv": 60,
                "pdf": 40,
                "zip": 20
            },
            "recentActivity": {
                "weekly_trend": [
                    {"date": "2023-10-21", "count": 2},
                    {"date": "2023-10-23", "count": 5}
                ],
                "top_types": [
                    {"entity_type": "VOCABULARY", "count": 50},
                    {"entity_type": "DOCUMENTS", "count": 30}
                ],
                "recent_exports": [
                    { /* 最近的导出记录对象 */ }
                ]
            }
        }
    }
    ```
- **响应 (失败):**
  - `401 Unauthorized`: 认证失败。
  - `500 Internal Server Error`: 服务器内部错误。
- **CURL 示例:**
  ```bash
  curl -X GET 'http://localhost:8080/api/v1/export/stats' \
  -H 'Authorization: Bearer <your_token>'
  ```

---

### 16. 创建导出模板 (CreateExportTemplate)

- **接口描述:** 为用户创建一个自定义的导出模板。
- **请求:**
  - `请求方法:` **POST**
  - `请求地址:` `/api/v1/export/templates`
  - `请求体 (Body):`

| 参数名 | 类型 | 是否必须 | 描述 |
| :--- | :--- | :--- | :--- |
| `name` | String | 是 | 模板名称，用户范围内唯一。 |
| `type` | String | 是 | 模板类型。支持的值同 `BatchExport` 的 `types`。 |
| `format` | String | 是 | 导出格式，必须是该类型支持的格式。 |
| `description` | String | 否 | 模板描述。 |
| `config` | Map<String, Object\>| 是 | 详细的导出配置，如PDF的页边距、字体等。 |
| `isDefault`| Boolean| 否 (默认: false)| 是否设为该类型的默认模板。 |
| `isPublic` | Boolean| 否 (默认: false)| 是否共享为公共模板（需管理员权限）。 |
- **响应 (成功):**
  - `状态码:` **201 Created**
  - `响应体:`
    ```json
    {
      "success": true,
      "message": "创建成功",
      "data": {
        "id": "template_123",
        "name": "我的词汇PDF模板",
        "type": "vocabulary",
        "format": "pdf",
        "description": "用于打印的词汇卡片",
        "config": {"columns": 3, "fontSize": "10pt"},
        "isDefault": true,
        "isPublic": false,
        "createdAt": "2023-10-27T16:00:00.000",
        "updatedAt": "2023-10-27T16:00:00.000"
      }
    }
    ```
- **响应 (失败):**
  - `400 Bad Request`: 参数验证失败。
  - `401 Unauthorized`: 认证失败。
  - `409 Conflict`: 已存在同名模板。
  - `500 Internal Server Error`: 服务器内部错误。
- **CURL 示例:**
  ```bash
  curl -X POST 'http://localhost:8080/api/v1/export/templates' \
  -H 'Authorization: Bearer <your_token>' \
  -H 'Content-Type: application/json' \
  -d '{
    "name": "我的词汇PDF模板",
    "type": "vocabulary",
    "format": "pdf",
    "description": "用于打印的词汇卡片",
    "config": {"columns": 3, "fontSize": "10pt"},
    "isDefault": true
  }'
  ```

---

### 17. 获取导出模板列表 (GetExportTemplates)

- **接口描述:** 获取所有可用的导出模板，包括系统默认模板、公共模板和用户自己的模板。
- **请求:**
  - `请求方法:` **GET**
  - `请求地址:` `/api/v1/export/templates`
- **响应 (成功):**
  - `状态码:` **200 OK**
  - `响应体:`
    ```json
    {
      "success": true,
      "message": "查询成功",
      "data": [
        {
          "id": "system_doc_pdf_default",
          "name": "PDF标准模板",
          "type": "documents",
          "format": "pdf",
          "description": "标准PDF文档导出模板，适合打印和阅读",
          "config": { /* ... */ },
          "isDefault": true,
          "isPublic": true,
          "createdAt": "...",
          "updatedAt": "..."
        },
        {
          "id": "template_123",
          "name": "我的词汇PDF模板",
          "type": "vocabulary",
          "format": "pdf",
          /* ... 其他字段 ... */
        }
      ]
    }
    ```
- **响应 (失败):**
  - `401 Unauthorized`: 认证失败。
  - `500 Internal Server Error`: 服务器内部错误。
- **CURL 示例:**
  ```bash
  curl -X GET 'http://localhost:8080/api/v1/export/templates' \
  -H 'Authorization: Bearer <your_token>'
  ```

---

### 18. 获取支持的导出格式 (GetSupportedFormats)

- **接口描述:** 查询指定导出类型或所有类型支持的导出格式。
- **请求:**
  - `请求方法:` **GET**
  - `请求地址:` `/api/v1/export/formats`
  - `查询参数 (Query Parameters):`

| 参数名 | 类型 | 是否必须 | 描述 |
| :--- | :--- | :--- | :--- |
| `type` | String | 否 | 指定要查询的导出类型。如果为空，则返回所有类型支持的格式。 |

- **响应 (成功，指定type):**
  - `状态码:` **200 OK**
  - `响应体:`
    ```json
    {
      "success": true,
      "message": "查询成功",
      "data": {
        "type": "documents",
        "formats": {
          "pdf": { "display_name": "PDF", "mime_type": "application/pdf", ... },
          "docx": { "display_name": "Word", "mime_type": "...", ... }
        },
        "count": 7
      }
    }
    ```
- **响应 (成功，未指定type):**
  - `状态码:` **200 OK**
  - `响应体:`
    ```json
    {
      "success": true,
      "message": "查询成功",
      "data": {
        "all_formats": {
          "documents": { /* documents支持的格式 */ },
          "vocabulary": { /* vocabulary支持的格式 */ },
          /* ... 其他类型 ... */
        },
        "total_types": 9
      }
    }
    ```
- **响应 (失败):**
  - `400 Bad Request`: `type`不支持。
  - `401 Unauthorized`: 认证失败。
  - `500 Internal Server Error`: 服务器内部错误。
- **CURL 示例:**
  ```bash
  // 查询 "documents" 类型支持的格式
  curl -X GET 'http://localhost:8080/api/v1/export/formats?type=documents' \
  -H 'Authorization: Bearer <your_token>'

  // 查询所有类型支持的格式
  curl -X GET 'http://localhost:8080/api/v1/export/formats' \
  -H 'Authorization: Bearer <your_token>'
  ```
  好的，我已经仔细分析了你提供的所有 Java Spring Boot 控制器文件。这些文件定义了一个功能完整的用户反馈（Feedback）系统的后端接口。

我将为你整理一份清晰、规范、完整的 API 文档，供前端开发团队使用。

---

# **用户反馈系统 API 文档**

## **1. 引言**

### **1.1. 概述**
本文档旨在为前端开发人员提供用户反馈（Feedback）模块的 API 接口说明，以便于前后端协作开发。

### **1.2. 基础 URL**
所有接口的基础路径 (Base URL) 为：
```
/api/v1/feedback
```

### **1.3. 鉴权 (Authentication)**
大部分需要用户登录才能操作的接口，通过在请求头 (Request Header) 中传递用户 ID 来进行身份验证。
- **Header Key**: `X-User-Id`
- **Header Value**: 用户的唯一标识符 (例如: `user_12345`)

部分接口可能需要管理员权限，这将在每个接口的“权限说明”中详细指出。

### **1.4. 通用响应格式**
所有接口的响应都遵循以下基本格式。`data` 字段的结构会因接口而异。

**成功响应 (Success):**
```json
{
  "success": true,
  "message": "操作成功的描述信息",
  "data": {
    // 具体业务数据
  }
}
```

**失败响应 (Error):**
```json
{
  "success": false,
  "message": "错误原因的描述信息",
  "data": null
}
```

### **1.5. 通用数据结构**

#### **附件对象 (Attachment)**
```json
{
  "id": "att_f1b2c3d4",
  "name": "screenshot.png",
  "url": "https://example.com/uploads/screenshot.png",
  "size": 102400,
  "type": "image"
}
```

| 字段名 | 类型 | 描述 |
| :--- | :--- | :--- |
| `id` | String | 附件的唯一ID |
| `name` | String | 文件名 |
| `url` | String | 文件访问URL |
| `size` | Number | 文件大小 (字节) |
| `type` | String | 文件类型 (如: `image`, `pdf`, `document`, `file`) |

#### **变更日志对象 (ChangeLog)**
```json
{
  "id": "log_a1b2c3d4",
  "field": "status",
  "oldValue": "pending",
  "newValue": "reviewing",
  "changedBy": "user_admin",
  "changedByName": "管理员",
  "changedAt": "2023-10-27T10:30:00",
  "reason": "开始处理此反馈"
}
```

| 字段名 | 类型 | 描述 |
| :--- | :--- | :--- |
| `id` | String | 日志的唯一ID |
| `field` | String | 被修改的字段名 |
| `oldValue` | String | 修改前的值 |
| `newValue` | String | 修改后的值 |
| `changedBy` | String | 操作者的用户ID |
| `changedByName` | String | 操作者的用户名 |
| `changedAt` | String | 变更时间 (ISO 8601 格式) |
| `reason` | String | 变更原因 |

## **2. 反馈 (Feedback)**

### **2.1. 提交新反馈**
- **功能**: 用户提交一个新的反馈。
- **请求地址**: `/submit`
- **请求方法**: `POST`
- **权限说明**: 需要用户登录 (`X-User-Id` 请求头)。
- **请求头**:
    | Header | 类型 | 是否必须 | 描述 |
    | :--- | :--- | :--- | :--- |
    | `X-User-Id` | String | 是 | 当前登录用户的ID |
    | `Authorization` | String | 否 | 如果提供，格式为 `Bearer <token>`，可用于解析用户信息 |
- **请求体 (Request Body)** (`application/json`):
    | 参数名 | 类型 | 是否必须 | 描述 |
    | :--- | :--- | :--- | :--- |
    | `title` | String | 是 | 反馈的标题 |
    | `content` | String | 是 | 反馈的详细内容 |
    | `type` | String | 否 | 反馈类型。可选值: `bug`, `feature`, `improvement`, `question`, `other`。默认为 `other` |
    | `priority` | String | 否 | 优先级。可选值: `low`, `medium`, `high`, `critical`。默认为 `medium` |
    | `attachments` | Array<Attachment> | 否 | 附件列表。`Attachment`对象只需包含 `name`, `url`, `size` |
    | `metadata` | Object | 否 | 其他元数据，如浏览器信息、操作系统等。`{"browser": "Chrome 108", "os": "Windows 11"}` |

- **成功响应 (200 OK)**:
    ```json
    {
        "success": true,
        "message": "反馈提交成功",
        "data": {
            "id": "fb_1a2b3c4d",
            "type": "bug",
            "title": "登录页面按钮错位",
            "content": "在1920x1080分辨率下，登录页面的'忘记密码'按钮会与'登录'按钮重叠。",
            "status": "pending",
            "priority": "high",
            "upvotes": 0,
            "downvotes": 0,
            "userId": "user_12345",
            "userName": "张三",
            "attachments": [
                {
                    "name": "screenshot.png",
                    "url": "https://example.com/uploads/screenshot.png",
                    "size": 102400
                }
            ],
            "metadata": {
                "browser": "Chrome 108",
                "os": "Windows 11"
            },
            "createdAt": "2023-10-27T10:00:00"
        }
    }
    ```
- **失败响应**:
    - `400 Bad Request`: 参数不合法，如标题或内容为空。
    - `401 Unauthorized`: 用户未登录。
    - `500 Internal Server Error`: 服务器内部错误。

---

### **2.2. 获取反馈列表**
- **功能**: 分页、筛选和排序获取反馈列表。
- **请求地址**: `/list`
- **请求方法**: `GET`
- **权限说明**: 公开访问。如果需要按“我的反馈”筛选，需要提供 `X-User-Id`。
- **请求头**:
    | Header | 类型 | 是否必须 | 描述 |
    | :--- | :--- | :--- | :--- |
    | `X-User-Id` | String | 否 | 当 `myFeedback=true` 时必须提供，用于识别“我”是谁 |
- **查询参数 (Query Parameters)**:
    | 参数名 | 类型 | 是否必须 | 默认值 | 描述 |
    | :--- | :--- | :--- | :--- | :--- |
    | `type` | String | 否 | `"all"` | 按类型筛选, 如 `bug`, `feature`。`"all"` 表示所有类型 |
    | `status` | String | 否 | `"all"` | 按状态筛选, 如 `pending`, `completed`。`"all"` 表示所有状态 |
    | `priority` | String | 否 | `"all"` | 按优先级筛选, 如 `high`, `low`。`"all"` 表示所有优先级 |
    | `page` | Integer | 否 | `1` | 当前页码 |
    | `pageSize` | Integer | 否 | `20` | 每页数量 (最大100) |
    | `sortBy` | String | 否 | `"created_at"` | 排序字段。可选值: `created_at` (创建时间), `upvotes` (点赞数), `priority` (优先级) |
    | `sortOrder` | String | 否 | `"desc"` | 排序顺序。可选值: `asc` (升序), `desc` (降序) |
    | `includeClosed` | Boolean | 否 | `false` | 是否包含已关闭的反馈 (状态为 `completed`, `rejected`, `duplicate`) |
    | `myFeedback` | Boolean | 否 | `false` | 是否只看我提交的反馈。需要 `X-User-Id` 请求头 |

- **成功响应 (200 OK)**:
    ```json
    {
        "success": true,
        "message": "获取反馈列表成功",
        "data": {
            "total": 150,
            "page": 1,
            "pageSize": 20,
            "totalPages": 8,
            "items": [
                {
                    "id": "fb_1a2b3c4d",
                    "type": "bug",
                    "title": "登录页面按钮错位",
                    "content": "在1920x1080分辨率下...",
                    "status": "pending",
                    "priority": "high",
                    "upvotes": 15,
                    "downvotes": 1,
                    "userId": "user_12345",
                    "userName": "张三",
                    "attachments": [],
                    "metadata": {},
                    "createdAt": "2023-10-27T10:00:00",
                    "updatedAt": "2023-10-27T11:00:00",
                    "assignedTo": "user_admin",
                    "assignedAt": "2023-10-27T11:00:00",
                    "completedAt": null
                }
                // ... 更多反馈项
            ],
            "filters": {
                "type": "all",
                "status": "all",
                "priority": "all",
                "sortBy": "created_at",
                "sortOrder": "desc"
            },
            "statistics": {
                "total": 520,
                "byType": { "bug": 200, "feature": 150, "other": 170 },
                "byStatus": { "pending": 100, "reviewing": 50, "completed": 370 },
                "byPriority": { "high": 80, "medium": 320, "low": 120 }
            }
        }
    }
    ```
- **失败响应**:
    - `500 Internal Server Error`: 服务器内部错误。

---

### **2.3. 搜索反馈**
- **功能**: 根据关键词搜索反馈。
- **请求地址**: `/search`
- **请求方法**: `GET`
- **权限说明**: 公开访问。
- **查询参数 (Query Parameters)**:
    | 参数名 | 类型 | 是否必须 | 默认值 | 描述 |
    | :--- | :--- | :--- | :--- | :--- |
    | `keyword` | String | 是 | | 搜索关键词，将匹配标题和内容 |
    | `page` | Integer | 否 | `1` | 当前页码 |
    | `pageSize` | Integer | 否 | `20` | 每页数量 (最大100) |
    | `sortBy` | String | 否 | `"relevance"` | 排序字段。可选值: `relevance` (相关性), `created_at` (创建时间) |
    | `sortOrder` | String | 否 | `"desc"` | 排序顺序。可选值: `asc`, `desc` |
    | `includeClosed` | Boolean | 否 | `false` | 是否包含已关闭的反馈 |

- **成功响应 (200 OK)**:
    响应结构与 `GET /list` 类似，`data` 对象中包含 `total`, `page`, `pageSize`, `totalPages`, `items`, `filters`, `statistics`。

---

### **2.4. 获取反馈详情**
- **功能**: 获取单个反馈的完整详细信息，包括评论、投票者、变更历史等。
- **请求地址**: `/{feedbackId}`
- **请求方法**: `GET`
- **权限说明**: 公开访问。
- **路径参数 (Path Parameters)**:
    | 参数名 | 类型 | 描述 |
    | :--- | :--- | :--- |
    | `feedbackId` | String | 反馈的唯一ID |
- **成功响应 (200 OK)**:
    ```json
    {
        "success": true,
        "message": "获取反馈详情成功",
        "data": {
            "id": "fb_1a2b3c4d",
            "type": "bug",
            "title": "登录页面按钮错位",
            "content": "详细内容...",
            "status": "reviewing",
            "priority": "high",
            "upvotes": 15,
            "downvotes": 1,
            "upvotedBy": ["user_abc", "user_def"],
            "downvotedBy": ["user_xyz"],
            "userId": "user_12345",
            "userName": "张三",
            "userEmail": "zhangsan@example.com",
            "attachments": [
              { "id": "att_f1b2c3d4", "name": "screenshot.png", "url": "...", "size": 10240, "type": "image" }
            ],
            "comments": [
              {
                "id": "cmt_x1y2z3a4",
                "content": "我这里也复现了这个问题！",
                "userId": "user_abc",
                "userName": "李四",
                "userAvatar": "https://example.com/avatars/lisi.png",
                "isInternal": false,
                "attachments": [],
                "createdAt": "2023-10-27T10:15:00",
                "updatedAt": "2023-10-27T10:15:00",
                "edited": false
              }
            ],
            "metadata": { "browser": "Chrome 108" },
            "viewCount": 123,
            "commentCount": 5,
            "relatedFeedback": ["fb_5e6f7g8h"],
            "changeLog": [
              { "id": "log_a1b2c3d4", "field": "status", "oldValue": "pending", "newValue": "reviewing", ... }
            ],
            "estimatedCompletion": "2023-11-15",
            "createdAt": "2023-10-27T10:00:00",
            "updatedAt": "2023-10-27T11:00:00",
            "assignedTo": "user_admin",
            "assignedAt": "2023-10-27T11:00:00",
            "completedAt": null
        }
    }
    ```
- **失败响应**:
    - `400 Bad Request`: `feedbackId` 为空。
    - `404 Not Found`: 未找到指定的反馈。
    - `500 Internal Server Error`: 服务器内部错误。

---

### **2.5. 更新反馈**
- **功能**: 更新一个已存在的反馈信息。
- **请求地址**: `/{feedbackId}`
- **请求方法**: `PUT`
- **权限说明**: 需要用户登录 (`X-User-Id`)，且用户必须是反馈的创建者或管理员/版主。
- **路径参数**:
    | 参数名 | 类型 | 描述 |
    | :--- | :--- | :--- |
    | `feedbackId` | String | 要更新的反馈ID |
- **请求体 (Request Body)** (`application/json`):
    *包含所有或部分要更新的字段。*
    | 参数名 | 类型 | 是否必须 | 描述 |
    | :--- | :--- | :--- | :--- |
    | `title` | String | 否 | 新标题 |
    | `content` | String | 否 | 新内容 |
    | `type` | String | 否 | 新类型 |
    | `priority` | String | 否 | 新优先级 |
    | `attachments` | Array<Attachment> | 否 | 新的附件列表，会覆盖旧的 |
    | `metadata` | Object | 否 | 新的元数据，会覆盖旧的 |
- **成功响应 (200 OK)**:
    响应 `data` 字段包含更新后的完整反馈信息，结构同 `GET /{feedbackId}`。
- **失败响应**:
    - `400 Bad Request`: `feedbackId` 为空。
    - `401 Unauthorized`: 用户未登录。
    - `403 Forbidden`: 当前用户无权限更新此反馈。
    - `404 Not Found`: 未找到指定的反馈。
    - `500 Internal Server Error`: 服务器内部错误。

---

### **2.6. 删除反馈**
- **功能**: 删除一个反馈及其所有相关数据（评论、投票等）。
- **请求地址**: `/{feedbackId}`
- **请求方法**: `DELETE`
- **权限说明**: 需要用户登录 (`X-User-Id`)，且用户必须是反馈的创建者或管理员/版主。
- **路径参数**:
    | 参数名 | 类型 | 描述 |
    | :--- | :--- | :--- |
    | `feedbackId` | String | 要删除的反馈ID |
- **成功响应 (200 OK)**:
    ```json
    {
        "success": true,
        "message": "反馈删除成功",
        "data": {
            "feedbackId": "fb_1a2b3c4d",
            "deleted": true,
            "deletedAt": "2023-10-27T12:00:00"
        }
    }
    ```
- **失败响应**:
    - `400 Bad Request`: `feedbackId` 为空。
    - `403 Forbidden`: 当前用户无权限删除此反馈。
    - `404 Not Found`: 未找到指定的反馈。
    - `500 Internal Server Error`: 服务器内部错误。

## **3. 反馈操作 (Feedback Actions)**

### **3.1. 更新反馈状态**
- **功能**: 单独更新一个反馈的状态。
- **请求地址**: `/{feedbackId}/status`
- **请求方法**: `PUT`
- **权限说明**: 需要管理员/版主权限。通过 `X-User-Id` 记录操作者。
- **路径参数**:
    | 参数名 | 类型 | 描述 |
    | :--- | :--- | :--- |
    | `feedbackId` | String | 要更新状态的反馈ID |
- **请求头**:
    | Header | 类型 | 是否必须 | 描述 |
    | :--- | :--- | :--- | :--- |
    | `X-User-Id` | String | 是 | 操作者的用户ID |
- **请求体 (Request Body)** (`application/json`):
    | 参数名 | 类型 | 是否必须 | 描述 |
    | :--- | :--- | :--- | :--- |
    | `status` | String | 是 | 新的状态。可选值: `pending`, `reviewing`, `in_progress`, `completed`, `rejected`, `duplicate` |
    | `reason` | String | 否 | 状态变更的原因，会记录在日志中 |
- **成功响应 (200 OK)**:
    ```json
    {
        "success": true,
        "message": "反馈状态更新成功",
        "data": {
            "id": "fb_1a2b3c4d",
            "status": "reviewing",
            "updatedAt": "2023-10-27T11:00:00"
        }
    }
    ```
- **失败响应**:
    - `400 Bad Request`: `feedbackId` 或 `status` 为空，或 `status` 值无效。
    - `404 Not Found`: 未找到指定的反馈。
    - `500 Internal Server Error`: 服务器内部错误。

---

### **3.2. 投票**
- **功能**: 对反馈进行赞同或反对投票。再次点击相同投票会取消，点击不同投票会切换。
- **请求地址**: `/{feedbackId}/vote`
- **请求方法**: `POST`
- **权限说明**: 需要用户登录 (`X-User-Id`)。
- **路径参数**:
    | 参数名 | 类型 | 描述 |
    | :--- | :--- | :--- |
    | `feedbackId` | String | 要投票的反馈ID |
- **请求头**:
    | Header | 类型 | 是否必须 | 描述 |
    | :--- | :--- | :--- | :--- |
    | `X-User-Id` | String | 是 | 投票者的用户ID |
- **请求体 (Request Body)** (`application/json`):
    | 参数名 | 类型 | 是否必须 | 描述 |
    | :--- | :--- | :--- | :--- |
    | `voteType` | String | 是 | 投票类型。可选值: `upvote` (赞同), `downvote` (反对) |
- **成功响应 (200 OK)**:
    ```json
    {
        "success": true,
        "message": "投票成功", // 或"投票已取消", "投票类型已更改"
        "data": {
            "feedbackId": "fb_1a2b3c4d",
            "voteType": "upvote", // "canceled" 表示取消投票
            "upvotes": 16,
            "downvotes": 1,
            "votedAt": "2023-10-27T10:15:00"
        }
    }
    ```
- **失败响应**:
    - `400 Bad Request`: 参数不合法。
    - `401 Unauthorized`: 用户未登录。
    - `404 Not Found`: 未找到指定的反馈。
    - `500 Internal Server Error`: 服务器内部错误。

---

### **3.3. 标记为已处理**
- **功能**: 用户或管理员将反馈标记为已处理（状态变为`completed`）。
- **请求地址**: `/{feedbackId}/resolve`
- **请求方法**: `PUT`
- **权限说明**: 需要用户登录 (`X-User-Id`)，且用户必须是反馈创建者或管理员/版主。
- **路径参数**:
    | 参数名 | 类型 | 描述 |
    | :--- | :--- | :--- |
    | `feedbackId` | String | 要标记的反馈ID |
- **成功响应 (200 OK)**:
    ```json
    {
        "success": true,
        "message": "反馈已标记为已处理",
        "data": {
            "feedbackId": "fb_1a2b3c4d",
            "resolved": true,
            "resolvedAt": "2023-10-27T14:00:00"
        }
    }
    ```
- **失败响应**:
    - `401 Unauthorized`, `403 Forbidden`, `404 Not Found`。

---

### **3.4. 批量操作**
- **功能**: 管理员对多个反馈进行批量操作，如修改状态、删除等。
- **请求地址**: `/batch`
- **请求方法**: `POST`
- **权限说明**: 仅限管理员/版主。
- **请求头**:
    | Header | 类型 | 是否必须 | 描述 |
    | :--- | :--- | :--- | :--- |
    | `X-User-Id` | String | 是 | 操作者的用户ID |
- **请求体 (Request Body)** (`application/json`):
    | 参数名 | 类型 | 是否必须 | 描述 |
    | :--- | :--- | :--- | :--- |
    | `action` | String | 是 | 操作类型。可选值: `update_status`, `delete`, `mark_as_read`, `mark_as_resolved` |
    | `feedbackIds` | Array<String> | 是 | 要操作的反馈ID列表 |
    | `status` | String | 否 | 当 `action` 为 `update_status` 时必须，指定新的状态 |
    | `reason` | String | 否 | 操作原因，会记录在日志中 |
- **成功响应 (200 OK)**:
    ```json
    {
        "success": true,
        "message": "批量操作完成，成功: 2, 失败: 1",
        "data": {
            "total": 3,
            "successCount": 2,
            "failCount": 1,
            "results": [
                {
                    "feedbackId": "fb_1",
                    "success": true,
                    "message": "状态更新成功"
                },
                {
                    "feedbackId": "fb_2",
                    "success": true,
                    "message": "删除成功"
                },
                {
                    "feedbackId": "fb_3",
                    "success": false,
                    "message": "反馈不存在"
                }
            ]
        }
    }
    ```
- **失败响应**:
    - `400 Bad Request`: 参数不合法，如 `action` 或 `feedbackIds` 为空。
    - `401 Unauthorized`, `403 Forbidden`。

## **4. 评论 (Comments)**

### **4.1. 添加评论**
- **功能**: 为某个反馈添加一条评论。
- **请求地址**: `/{feedbackId}/comments`
- **请求方法**: `POST`
- **权限说明**: 需要用户登录 (`X-User-Id`)。
- **路径参数**:
    | 参数名 | 类型 | 描述 |
    | :--- | :--- | :--- |
    | `feedbackId` | String | 要评论的反馈ID |
- **请求体 (Request Body)** (`application/json`):
    | 参数名 | 类型 | 是否必须 | 描述 |
    | :--- | :--- | :--- | :--- |
    | `content` | String | 是 | 评论内容 |
    | `isInternal` | Boolean | 否 | 是否为内部评论（仅管理员可见），默认为 `false` |
    | `attachments` | Array<Attachment> | 否 | 评论附件列表 |
- **成功响应 (200 OK)**:
    ```json
    {
        "success": true,
        "message": "添加评论成功",
        "data": {
            "id": "cmt_x1y2z3a4",
            "feedbackId": "fb_1a2b3c4d",
            "content": "我这里也复现了",
            "userId": "user_abc",
            "userName": "李四",
            "userAvatar": "https://example.com/avatars/lisi.png",
            "isInternal": false,
            "attachments": [],
            "createdAt": "2023-10-27T10:15:00",
            "updatedAt": "2023-10-27T10:15:00",
            "edited": false
        }
    }
    ```
- **失败响应**:
    - `400 Bad Request`, `401 Unauthorized`, `404 Not Found`.

---

### **4.2. 获取评论列表**
- **功能**: 分页获取某个反馈的评论/回复列表。
- **请求地址**: `/{feedbackId}/replies`
- **请求方法**: `GET`
- **权限说明**: 公开访问。内部评论需要特定权限。
- **路径参数**:
    | 参数名 | 类型 | 描述 |
    | :--- | :--- | :--- |
    | `feedbackId` | String | 反馈ID |
- **查询参数 (Query Parameters)**:
    | 参数名 | 类型 | 是否必须 | 默认值 | 描述 |
    | :--- | :--- | :--- | :--- | :--- |
    | `page` | Integer | 否 | `1` | 当前页码 |
    | `pageSize` | Integer | 否 | `20` | 每页数量 (最大100) |
    | `includeInternal`| Boolean | 否 | `false` | 是否包含内部评论 (需要权限) |
- **成功响应 (200 OK)**:
    ```json
    {
        "success": true,
        "message": "获取反馈回复成功",
        "data": {
            "total": 5,
            "page": 1,
            "pageSize": 20,
            "totalPages": 1,
            "replies": [
                {
                    "id": "cmt_x1y2z3a4",
                    "feedbackId": "fb_1a2b3c4d",
                    "message": "我这里也复现了",
                    "userId": "user_abc",
                    "userName": "李四",
                    "userAvatar": "...",
                    "isInternal": false,
                    "attachments": [],
                    "createdAt": "2023-10-27T10:15:00",
                    "updatedAt": "2023-10-27T10:15:00",
                    "edited": false
                }
                // ... 更多回复
            ]
        }
    }
    ```
- **失败响应**:
    - `400 Bad Request`, `404 Not Found`.

## **5. 分类 (Categories)**

### **5.1. 获取反馈分类列表**
- **功能**: 获取所有可用的反馈分类，用于表单下拉框等。
- **请求地址**: `/categories`
- **请求方法**: `GET`
- **权限说明**: 公开访问。
- **成功响应 (200 OK)**:
    ```json
    {
        "success": true,
        "message": "获取反馈分类成功",
        "data": [
            {
                "id": "bug",
                "name": "错误报告",
                "value": "bug",
                "description": "系统功能异常或错误",
                "icon": "bug",
                "color": "#F44336"
            },
            {
                "id": "feature",
                "name": "功能建议",
                "value": "feature",
                "description": "新功能或改进建议",
                "icon": "light-bulb",
                "color": "#2196F3"
            }
            // ... 更多分类
        ]
    }
    ```

---

### **5.2. 创建反馈分类**
- **功能**: 管理员创建一个新的反馈分类。
- **请求地址**: `/categories`
- **请求方法**: `POST`
- **权限说明**: 仅限管理员/版主。
- **请求体 (Request Body)** (`application/json`):
    | 参数名 | 类型 | 是否必须 | 描述 |
    | :--- | :--- | :--- | :--- |
    | `name` | String | 是 | 分类显示名称, 如 "UI/UX改进" |
    | `value` | String | 是 | 分类的唯一值, 如 "ui_ux_improvement" |
    | `description`| String | 否 | 分类描述 |
    | `icon` | String | 否 | 图标名称 (如 'tag') |
    | `color` | String | 否 | 颜色代码 (如 '#607D8B') |
- **成功响应 (200 OK)**:
    返回创建后的分类信息。
- **失败响应**:
    - `400 Bad Request`: 参数不合法，或 `value` 已存在。
    - `401 Unauthorized`, `403 Forbidden`.

---

### **5.3. 更新反馈分类**
- **功能**: 管理员更新一个分类的名称或描述。
- **请求地址**: `/categories/{categoryId}`
- **请求方法**: `PUT`
- **权限说明**: 仅限管理员/版主。
- **路径参数**:
    | 参数名 | 类型 | 描述 |
    | :--- | :--- | :--- |
    | `categoryId` | String | 要更新的分类ID |
- **请求体 (Request Body)** (`application/json`):
    | 参数名 | 类型 | 是否必须 | 描述 |
    | :--- | :--- | :--- | :--- |
    | `name` | String | 否 | 新的分类名称 |
    | `description`| String | 否 | 新的分类描述 |
- **成功响应 (200 OK)**:
    返回更新后的分类信息。
- **失败响应**:
    - `401 Unauthorized`, `403 Forbidden`, `404 Not Found`.


---

### **5.4. 删除反馈分类**
- **功能**: 管理员删除一个分类。如果该分类下已有反馈，则会将其标记为“不活跃”而不是直接删除。
- **请求地址**: `/categories/{categoryId}`
- **请求方法**: `DELETE`
- **权限说明**: 仅限管理员/版主。
- **路径参数**:
    | 参数名 | 类型 | 描述 |
    | :--- | :--- | :--- |
    | `categoryId` | String | 要删除的分类ID |
- **成功响应 (200 OK)**:
    ```json
    {
        "success": true,
        // message可能是"删除反馈分类成功" 或 "分类已被标记为不活跃..."
        "message": "删除反馈分类成功",
        "data": {
            "categoryId": "cat_123",
            "deleted": true,
            "deletedAt": "2023-10-27T15:00:00"
        }
    }
    ```
- **失败响应**:
    - `401 Unauthorized`, `403 Forbidden`, `404 Not Found`.

## **6. 统计与数据 (Statistics & Data)**

### **6.1. 获取反馈类型统计**
- **功能**: 获取所有反馈类型及其对应的反馈数量。
- **请求地址**: `/types`
- **请求方法**: `GET`
- **权限说明**: 公开访问。
- **成功响应 (200 OK)**:
    ```json
    {
        "success": true,
        "message": "获取反馈类型成功",
        "data": [
            {
                "id": "bug",
                "name": "错误报告",
                "value": "bug",
                "description": "...",
                "icon": "bug",
                "color": "#F44336",
                "feedbackCount": 200
            },
            {
                "id": "feature",
                "name": "功能建议",
                "value": "feature",
                "description": "...",
                "icon": "light-bulb",
                "color": "#2196F3",
                "feedbackCount": 150
            }
            // ...
        ]
    }
    ```

---

### **6.2. 获取简要统计**
- **功能**: 获取反馈系统的核心统计数据，用于仪表盘概览。
- **请求地址**: `/stats`
- **请求方法**: `GET`
- **权限说明**: 公开访问。
- **查询参数 (Query Parameters)**:
    | 参数名 | 类型 | 是否必须 | 默认值 | 描述 |
    | :--- | :--- | :--- | :--- | :--- |
    | `timeRange` | String | 否 | `"month"` | 时间范围。可选值: `week`, `month`, `quarter`, `year`, `all` |
    | `type` | String | 否 | `"all"` | 按反馈类型筛选 |
- **成功响应 (200 OK)**:
    ```json
    {
        "success": true,
        "message": "获取反馈统计成功",
        "data": {
            "total": 520,
            "byType": { "bug": 200, "feature": 150, "other": 170 },
            "byStatus": { "pending": 100, "reviewing": 50, "completed": 370 },
            "byPriority": { "high": 80, "medium": 320, "low": 120 },
            "byMonth": { "2023-09": 250, "2023-10": 270 },
            "topContributors": [
                { "userId": "user_123", "userName": "张三", "feedbackCount": 25, "upvotesReceived": 150 }
            ],
            "averageResponseTime": 48, // 平均响应时间（小时）
            "resolutionRate": 0.75, // 解决率 (75%)
            "satisfactionScore": 4.2 // 满意度分数 (满分5)
        }
    }
    ```

---

### **6.3. 获取详细统计**
- **功能**: 获取更详细、可细分的统计数据，用于数据分析页面。
- **请求地址**: `/statistics`
- **请求方法**: `GET`
- **权限说明**: 公开访问。
- **查询参数 (Query Parameters)**:
    | 参数名 | 类型 | 是否必须 | 默认值 | 描述 |
    | :--- | :--- | :--- | :--- | :--- |
    | `timeRange` | String | 否 | `"month"` | 时间范围。可选值: `week`, `month`, `quarter`, `year`, `all` |
    | `type` | String | 否 | `"all"` | 按反馈类型筛选 |
    | `status` | String | 否 | `"all"` | 按状态筛选 |
    | `priority` | String | 否 | `"all"` | 按优先级筛选 |
- **成功响应 (200 OK)**:
    *响应结构与 `GET /stats` 类似，但包含更多字段：*
    ```json
    {
        "success": true,
        "message": "获取详细统计成功",
        "data": {
            // ... 与 /stats 相同的字段 ...
            "byDay": { // 按天统计
                "2023-10-26": 10,
                "2023-10-27": 15
            },
            "recentActivity": [ // 最近活动
                { "type": "feedback", "id": "fb_xyz", "title": "新反馈标题", "userId": "user_456", "createdAt": "..." },
                { "type": "reply", "id": "reply_abc", "title": "回复内容摘要...", "userId": "user_789", "createdAt": "..." }
            ],
            "trends": { // 趋势分析
                "growthRate": 50.0, // 增长率
                "currentCount": 15,
                "previousCount": 10,
                "trend": "up" // "up", "down", "stable"
            }
        }
    }
    ```

---

### **6.4. 导出反馈数据**
- **功能**: 管理员根据筛选条件导出反馈数据。
- **请求地址**: `/export`
- **请求方法**: `GET`
- **权限说明**: 仅限管理员/版主。
- **查询参数 (Query Parameters)**:
    | 参数名 | 类型 | 是否必须 | 默认值 | 描述 |
    | :--- | :--- | :--- | :--- | :--- |
    | `format` | String | 否 | `"csv"` | 导出格式。当前支持 `csv` 和 `json` |
    | `type` | String | 否 | `"all"` | 按类型筛选 |
    | `status` | String | 否 | `"all"` | 按状态筛选 |
    | `startDate` | String | 否 | | 开始日期 (格式: `YYYY-MM-DD`) |
    | `endDate` | String | 否 | | 结束日期 (格式: `YYYY-MM-DD`) |
- **成功响应 (200 OK)**:
    ```json
    {
        "success": true,
        "message": "导出反馈数据成功",
        "data": {
            "metadata": {
                "exportDate": "2023-10-27T16:00:00",
                "exportFormat": "csv",
                "totalRecords": 50,
                "filters": {
                    "type": "bug",
                    "status": "all",
                    "startDate": "2023-10-01",
                    "endDate": "2023-10-27"
                }
            },
            "data": [
                {
                    "id": "fb_1a2b3c4d",
                    "title": "登录页面按钮错位",
                    "type": "bug",
                    "status": "completed",
                    "priority": "high",
                    "upvotes": 15,
                    "downvotes": 1,
                    "userName": "张三",
                    "userEmail": "zhangsan@example.com",
                    "createdAt": "2023-10-27T10:00:00",
                    "updatedAt": "2023-10-27T11:00:00",
                    // ... 更多扁平化字段 ...
                    "metadata_browser": "Chrome 108"
                }
                // ... 更多记录
            ]
        }
    }
    ```
    好的，我已经仔细分析了您提供的所有Java文件。这些文件定义了一套完整的通知（Notification）管理相关的API。

我将按照规范的格式，为您整理一份详细的API文档，供前端开发团队使用。

---

# **通知系统 API 文档 (v1)**

## **概述**

本文档详细描述了通知系统的API接口，旨在为前端开发人员提供清晰、准确的接口调用指南。

### **基础 URL**

所有接口的根路径为：`/api/v1/notifications`

### **通用约定**

*   **认证**: 大部分接口需要用户认证。请在请求头（Request Header）中携带 `Authorization` 字段，格式为 `Bearer <your_access_token>`。
*   **ID 格式**: 通知ID（`notificationId`）在后端为整数类型，但在API交互中通常以 `notif_<id>` 的字符串格式表示。接口能够兼容纯数字字符串和带 `notif_` 前缀的字符串。
*   **时间格式**: 所有返回的时间戳（如 `createdAt`, `readAt`, `timestamp`）均为 [ISO 8601](https://en.wikipedia.org/wiki/ISO_8601) 格式的 UTC 时间，例如 `2023-10-27T10:00:00Z`。
*   **响应结构**: 除非特别说明，所有响应都遵循以下基本结构：
    ```json
    {
      "success": true,
      "message": "操作成功的提示信息",
      "data": { ... } // 具体业务数据
    }
    ```

---

## **API 接口详情**

### **1. 获取通知列表**

-   **功能描述**: 获取当前用户的通知列表，支持分页、筛选和排序。
-   **请求方法**: `GET`
-   **请求地址**: `/api/v1/notifications`
-   **请求头**:
    | 参数 | 类型 | 是否必须 | 描述 |
    | :--- | :--- | :--- | :--- |
    | `Authorization` | String | 是 | 用户认证Token, 格式: `Bearer <token>` |
-   **查询参数 (Query Parameters)**:
    | 参数 | 类型 | 是否必须 | 默认值 | 描述 |
    | :--- | :--- | :--- | :--- | :--- |
    | `page` | Integer | 否 | `1` | 当前页码，从1开始。 |
    | `pageSize` | Integer | 否 | `20` | 每页返回的通知数量。 |
    | `type` | String | 否 | | 按通知类型筛选，例如 `document_shared`。 |
    | `unreadOnly`| Boolean | 否 | `false` | 是否只显示未读通知。 |
    | `sortBy` | String | 否 | `created_at` | 排序字段。可选值: `created_at` (创建时间), `title` (标题), `type` (类型), `read` (已读状态)。 |
    | `sortOrder` | String | 否 | `desc` | 排序顺序。可选值: `asc` (升序), `desc` (降序)。 |
-   **成功响应 (200 OK)**:
    ```json
    {
        "success": true,
        "message": "获取通知列表成功",
        "notifications": [
            {
                "id": "notif_101",
                "type": "document_shared",
                "title": "新文档分享",
                "message": "张三向您分享了文档《2023年度总结报告》。",
                "icon": "/icons/document.png",
                "image": null,
                "read": false,
                "readAt": null,
                "createdAt": "2023-10-27T10:30:00Z",
                "relativeTime": "5分钟前",
                "actionUrl": "/docs/doc_123",
                "targetType": "document",
                "targetId": "doc_123",
                "metadata": {
                    "sharerId": "user_456",
                    "sharerName": "张三"
                }
            }
        ],
        "pagination": {
            "page": 1,
            "pageSize": 20,
            "total": 1,
            "totalPages": 1
        }
    }
    ```
-   **响应体字段说明**:
    *   `notifications` (Array): 通知对象列表。
        *   `id` (String): 通知的唯一ID, 例如 `notif_101`。
        *   `type` (String): 通知类型, 例如 `document_shared`, `review_reminder`。
        *   `title` (String): 通知标题。
        *   `message` (String): 通知内容。
        *   `icon` (String, nullable): 通知图标的URL。
        *   `image` (String, nullable): 通知图片的URL。
        *   `read` (Boolean): 是否已读。`true` 为已读, `false` 为未读。
        *   `readAt` (String, nullable): 标记为已读的时间。
        *   `createdAt` (String): 通知创建时间。
        *   `relativeTime` (String): 相对时间，例如 "刚刚", "5分钟前"。
        *   `actionUrl` (String, nullable): 点击通知后跳转的URL。
        *   `targetType` (String, nullable): 关联目标类型，如 `document`。
        *   `targetId` (String, nullable): 关联目标ID。
        *   `metadata` (Object, nullable): 附加元数据，可包含任意键值对。
    *   `pagination` (Object): 分页信息。
        *   `page` (Integer): 当前页码。
        *   `pageSize` (Integer): 每页数量。
        *   `total` (Long): 总记录数。
        *   `totalPages` (Integer): 总页数。
-   **状态码说明**:
    *   `200 OK`: 请求成功。
    *   `401 Unauthorized`: 未授权或Token过期。
    *   `500 Internal Server Error`: 服务器内部错误。

---

### **2. 获取单个通知详情**

-   **功能描述**: 根据ID获取单个通知的详细信息。
-   **请求方法**: `GET`
-   **请求地址**: `/api/v1/notifications/{notificationId}`
-   **请求头**:
    | 参数 | 类型 | 是否必须 | 描述 |
    | :--- | :--- | :--- | :--- |
    | `Authorization` | String | 是 | 用户认证Token, 格式: `Bearer <token>` |
-   **路径参数 (Path Parameters)**:
    | 参数 | 类型 | 描述 |
    | :--- | :--- | :--- |
    | `notificationId` | String | 要获取的通知ID, 例如 `notif_101`。 |
-   **成功响应 (200 OK)**:
    ```json
    {
        "success": true,
        "message": "获取通知详情成功",
        "notification": {
            "id": "notif_101",
            "type": "document_shared",
            "title": "新文档分享",
            "message": "张三向您分享了文档《2023年度总结报告》。",
            "icon": "/icons/document.png",
            "image": null,
            "read": false,
            "readAt": null,
            "createdAt": "2023-10-27T10:30:00Z",
            "relativeTime": "5分钟前",
            "actionUrl": "/docs/doc_123",
            "targetType": "document",
            "targetId": "doc_123",
            "metadata": {
                "sharerId": "user_456",
                "sharerName": "张三"
            }
        }
    }
    ```
-   **响应体字段说明**:
    *   `notification` (Object): 单个通知对象，字段同**获取通知列表**中的通知对象。
-   **状态码说明**:
    *   `200 OK`: 请求成功。
    *   `400 Bad Request`: 通知ID格式错误。
    *   `401 Unauthorized`: 未授权或Token过期。
    *   `404 Not Found`: 通知不存在或无权访问。
    *   `500 Internal Server Error`: 服务器内部错误。

---

### **3. 创建通知**

-   **功能描述**: 创建一条新的通知。
-   **请求方法**: `POST`
-   **请求地址**: `/api/v1/notifications`
-   **请求头**:
    | 参数 | 类型 | 是否必须 | 描述 |
    | :--- | :--- | :--- | :--- |
    | `Authorization` | String | 是 | 用户认证Token, 格式: `Bearer <token>` |
-   **请求体 (Request Body)**:
    | 字段 | 类型 | 是否必须 | 描述 |
    | :--- | :--- | :--- | :--- |
    | `type` | String | 是 | 通知类型, 例如 `system_update`。 |
    | `title` | String | 是 | 通知标题。 |
    | `message` | String | 是 | 通知内容。 |
    | `icon` | String | 否 | 图标URL。 |
    | `image` | String | 否 | 图片URL。 |
    | `actionUrl` | String | 否 | 点击跳转的URL。 |
    | `targetType` | String | 否 | 关联目标类型。 |
    | `targetId` | String | 否 | 关联目标ID。 |
    | `metadata` | Object | 否 | 附加元数据。 |
-   **请求体示例**:
    ```json
    {
        "type": "achievement_unlocked",
        "title": "成就解锁！",
        "message": "恭喜您解锁了“阅读马拉松”成就！",
        "icon": "/icons/achievement.png",
        "actionUrl": "/achievements/marathon",
        "metadata": {
            "achievement_code": "READ_MARATHON_2023"
        }
    }
    ```
-   **成功响应 (201 Created)**:
    ```json
    {
        "success": true,
        "message": "通知创建成功",
        "notification": {
            "id": "notif_102",
            "type": "achievement_unlocked",
            "title": "成就解锁！",
            "message": "恭喜您解锁了“阅读马拉松”成就！",
            "icon": "/icons/achievement.png",
            "image": null,
            "read": false,
            "readAt": null,
            "createdAt": "2023-10-27T11:00:00Z",
            "relativeTime": "刚刚",
            "actionUrl": "/achievements/marathon",
            "targetType": null,
            "targetId": null,
            "metadata": {
                 "achievement_code": "READ_MARATHON_2023"
            }
        }
    }
    ```
-   **响应体字段说明**:
    *   `notification` (Object): 成功创建的通知对象，字段同**获取通知列表**中的通知对象。
-   **状态码说明**:
    *   `201 Created`: 创建成功。
    *   `400 Bad Request`: 请求体缺少必须字段。
    *   `401 Unauthorized`: 未授权或Token过期。
    *   `500 Internal Server Error`: 服务器内部错误。

---

### **4. 标记单个通知为已读**

-   **功能描述**: 将指定ID的通知标记为已读。
-   **请求方法**: `PUT`
-   **请求地址**:
    1.  `/api/v1/notifications/mark-as-read` (通过请求体)
    2.  `/api/v1/notifications/{notificationId}/read` (通过路径参数)
-   **请求头**:
    | 参数 | 类型 | 是否必须 | 描述 |
    | :--- | :--- | :--- | :--- |
    | `Authorization` | String | 是 | 用户认证Token, 格式: `Bearer <token>` |
-   **请求体 (仅适用于 `/mark-as-read`)**:
    | 字段 | 类型 | 是否必须 | 描述 |
    | :--- | :--- | :--- | :--- |
    | `notificationId` | String | 是 | 要标记的通知ID, 例如 `notif_101`。 |
-   **路径参数 (仅适用于 `/{notificationId}/read`)**:
    | 参数 | 类型 | 描述 |
    | :--- | :--- | :--- |
    | `notificationId` | String | 要标记的通知ID, 例如 `notif_101`。 |
-   **成功响应 (200 OK)**:
    ```json
    {
        "success": true,
        "message": "通知已标记为已读",
        "notificationId": "notif_101",
        "readAt": "2023-10-27T11:05:00Z"
    }
    ```
-   **响应体字段说明**:
    *   `notificationId` (String): 已标记的通知ID。
    *   `readAt` (String): 成功标记为已读的时间。如果通知之前已经是已读状态，此字段可能为 `null`。
-   **状态码说明**:
    *   `200 OK`: 操作成功（即使通知已经是已读状态）。
    *   `400 Bad Request`: 通知ID格式错误或缺失。
    *   `401 Unauthorized`: 未授权或Token过期。
    *   `404 Not Found`: 通知不存在或无权访问。
    *   `500 Internal Server Error`: 服务器内部错误。

---

### **5. 标记所有通知为已读**

-   **功能描述**: 将当前用户的所有未读通知标记为已读。
-   **请求方法**: `PUT`
-   **请求地址**:
    1.  `/api/v1/notifications/mark-all-as-read`
    2.  `/api/v1/notifications/read-all`
-   **请求头**:
    | 参数 | 类型 | 是否必须 | 描述 |
    | :--- | :--- | :--- | :--- |
    | `Authorization` | String | 是 | 用户认证Token, 格式: `Bearer <token>` |
-   **成功响应 (200 OK)**:
    ```json
    {
        "success": true,
        "message": "所有通知已标记为已读",
        "markedCount": 15,
        "timestamp": "2023-10-27T11:10:00Z"
    }
    ```
-   **响应体字段说明**:
    *   `markedCount` (Integer): 本次操作成功标记为已读的通知数量。如果为0，表示没有未读通知。
    *   `timestamp` (String): 操作完成的时间。
-   **状态码说明**:
    *   `200 OK`: 操作成功。
    *   `401 Unauthorized`: 未授权或Token过期。
    *   `500 Internal Server Error`: 服务器内部错误。

---

### **6. 批量标记通知为已读**

-   **功能描述**: 根据ID列表，批量将通知标记为已读。
-   **请求方法**: `PUT`
-   **请求地址**: `/api/v1/notifications/batch-read`
-   **请求头**:
    | 参数 | 类型 | 是否必须 | 描述 |
    | :--- | :--- | :--- | :--- |
    | `Authorization` | String | 是 | 用户认证Token, 格式: `Bearer <token>` |
-   **请求体 (Request Body)**:
    | 字段 | 类型 | 是否必须 | 描述 |
    | :--- | :--- | :--- | :--- |
    | `ids` | Array[String] | 是 | 要标记为已读的通知ID列表。 |
-   **请求体示例**:
    ```json
    {
        "ids": ["notif_101", "notif_102", "abc"]
    }
    ```
-   **成功响应 (200 OK)**:
    ```json
    {
        "success": true,
        "message": "批量标记通知为已读成功",
        "processedCount": 2,
        "failedCount": 1,
        "failedItems": [
            {
                "id": "abc",
                "error": "通知ID格式错误"
            }
        ]
    }
    ```
-   **响应体字段说明**:
    *   `processedCount` (Integer): 成功处理的通知数量。
    *   `failedCount` (Integer): 处理失败的ID数量。
    *   `failedItems` (Array, nullable): 处理失败的项列表，如果全部成功则为`null`。
        *   `id` (String): 处理失败的ID。
        *   `error` (String): 失败原因。
-   **状态码说明**:
    *   `200 OK`: 请求成功。
    *   `400 Bad Request`: 请求体无效或ID列表为空。
    *   `401 Unauthorized`: 未授权或Token过期。
    *   `500 Internal Server Error`: 服务器内部错误。

---

### **7. 删除单个通知**

-   **功能描述**: 根据ID删除单个通知。
-   **请求方法**: `DELETE`
-   **请求地址**: `/api/v1/notifications/{notificationId}`
-   **请求头**:
    | 参数 | 类型 | 是否必须 | 描述 |
    | :--- | :--- | :--- | :--- |
    | `Authorization` | String | 是 | 用户认证Token, 格式: `Bearer <token>` |
-   **路径参数 (Path Parameters)**:
    | 参数 | 类型 | 描述 |
    | :--- | :--- | :--- |
    | `notificationId` | String | 要删除的通知ID, 例如 `notif_101`。 |
-   **成功响应 (200 OK)**:
    ```json
    {
        "success": true,
        "message": "通知删除成功",
        "notificationId": "notif_101"
    }
    ```
-   **响应体字段说明**:
    *   `notificationId` (String): 成功删除的通知ID。
-   **状态码说明**:
    *   `200 OK`: 删除成功。
    *   `400 Bad Request`: 通知ID格式错误。
    *   `401 Unauthorized`: 未授权或Token过期。
    *   `404 Not Found`: 通知不存在或无权访问。
    *   `500 Internal Server Error`: 服务器内部错误。

---

### **8. 批量删除通知**

-   **功能描述**: 根据ID列表，批量删除通知。
-   **请求方法**: `DELETE`
-   **请求地址**: `/api/v1/notifications/batch`
-   **请求头**:
    | 参数 | 类型 | 是否必须 | 描述 |
    | :--- | :--- | :--- | :--- |
    | `Authorization` | String | 是 | 用户认证Token, 格式: `Bearer <token>` |
-   **请求体 (Request Body)**:
    | 字段 | 类型 | 是否必须 | 描述 |
    | :--- | :--- | :--- | :--- |
    | `notificationIds` | Array[String] | 是 | 要删除的通知ID列表。 |
-   **请求体示例**:
    ```json
    {
        "notificationIds": ["notif_101", "notif_102", "abc"]
    }
    ```
-   **成功响应 (200 OK)**:
    ```json
    {
        "success": true,
        "message": "批量删除通知成功",
        "processedCount": 2,
        "failedCount": 1,
        "failedItems": [
            {
                "id": "abc",
                "error": "通知ID格式错误"
            }
        ]
    }
    ```
-   **响应体字段说明**:
    *   `processedCount` (Integer): 成功删除的通知数量。
    *   `failedCount` (Integer): 处理失败的ID数量。
    *   `failedItems` (Array, nullable): 处理失败的项列表，字段同**批量标记为已读**。
-   **状态码说明**:
    *   `200 OK`: 请求成功。
    *   `400 Bad Request`: 请求体无效或ID列表为空。
    *   `401 Unauthorized`: 未授权或Token过期。
    *   `500 Internal Server Error`: 服务器内部错误。

---

### **9. 清除所有通知**

-   **功能描述**: 删除当前用户的所有通知。此操作会永久移除所有通知记录。
-   **请求方法**: `DELETE`
-   **请求地址**:
    1.  `/api/v1/notifications/clear-all`
    2.  `/api/v1/notifications/history` (功能相同)
-   **请求头**:
    | 参数 | 类型 | 是否必须 | 描述 |
    | :--- | :--- | :--- | :--- |
    | `Authorization` | String | 是 | 用户认证Token, 格式: `Bearer <token>` |
-   **成功响应 (200 OK)**:
    ```json
    {
        "success": true,
        "message": "所有通知已清除",
        "clearedCount": 50,
        "timestamp": "2023-10-27T11:20:00Z"
    }
    ```
-   **响应体字段说明**:
    *   `clearedCount` (Integer): 成功清除的通知总数。如果为0，表示没有可清除的通知。
    *   `timestamp` (String): 操作完成的时间。
-   **状态码说明**:
    *   `200 OK`: 操作成功。
    *   `401 Unauthorized`: 未授权或Token过期。
    *   `500 Internal Server Error`: 服务器内部错误。

<br>

## **统计 & 设置类接口**

---

### **10. 获取未读通知数量**

-   **功能描述**: 快速获取当前用户的未读通知总数。
-   **请求方法**: `GET`
-   **请求地址**: `/api/v1/notifications/unread-count`
-   **请求头**:
    | 参数 | 类型 | 是否必须 | 描述 |
    | :--- | :--- | :--- | :--- |
    | `Authorization` | String | 是 | 用户认证Token, 格式: `Bearer <token>` |
-   **成功响应 (200 OK)**:
    ```json
    {
        "success": true,
        "message": "获取未读通知数量成功",
        "unreadCount": 15
    }
    ```
-   **响应体字段说明**:
    *   `unreadCount` (Integer): 未读通知的总数。
-   **状态码说明**:
    *   `200 OK`: 请求成功。
    *   `401 Unauthorized`: 未授权或Token过期。
    *   `500 Internal Server Error`: 服务器内部错误。

---

### **11. 获取通知统计数据**

-   **功能描述**: 获取当前用户的通知统计信息，如总数、阅读率、分类统计等。
-   **请求方法**: `GET`
-   **请求地址**: `/api/v1/notifications/stats`
-   **请求头**:
    | 参数 | 类型 | 是否必须 | 描述 |
    | :--- | :--- | :--- | :--- |
    | `Authorization` | String | 是 | 用户认证Token, 格式: `Bearer <token>` |
-   **成功响应 (200 OK)**:
    ```json
    {
        "success": true,
        "message": "获取通知统计数据成功",
        "stats": {
            "totalNotifications": 100,
            "unreadCount": 15,
            "readRate": 85.0,
            "formattedReadRate": "85.0%",
            "byType": {
                "document_shared": 40,
                "review_reminder": 50,
                "system_update": 10
            },
            "byDay": {
                "2023-10-26": 12,
                "2023-10-27": 8
            },
            "averageDailyNotifications": 5.5,
            "lastNotificationAt": "2023-10-27T10:30:00Z"
        }
    }
    ```
-   **响应体字段说明**:
    *   `stats` (Object): 统计数据对象。
        *   `totalNotifications` (Integer): 通知总数。
        *   `unreadCount` (Integer): 未读通知数。
        *   `readRate` (Double): 阅读率 (0-100)。
        *   `formattedReadRate` (String): 格式化后的阅读率，例如 "85.0%"。
        *   `byType` (Object): 按类型统计的通知数量。
        *   `byDay` (Object): 最近7天按天统计的通知数量。
        *   `averageDailyNotifications` (Double): 平均每日收到的通知数。
        *   `lastNotificationAt` (String): 最新一条通知的创建时间。
-   **状态码说明**:
    *   `200 OK`: 请求成功。
    *   `401 Unauthorized`: 未授权或Token过期。
    *   `500 Internal Server Error`: 服务器内部错误。

---

### **12. 获取通知历史**

-   **功能描述**: 获取历史通知，支持按日期和类型进行筛选。
-   **请求方法**: `GET`
-   **请求地址**: `/api/v1/notifications/history`
-   **请求头**:
    | 参数 | 类型 | 是否必须 | 描述 |
    | :--- | :--- | :--- | :--- |
    | `Authorization` | String | 是 | 用户认证Token, 格式: `Bearer <token>` |
-   **查询参数 (Query Parameters)**:
    | 参数 | 类型 | 是否必须 | 默认值 | 描述 |
    | :--- | :--- | :--- | :--- | :--- |
    | `page` | Integer | 否 | `1` | 当前页码。 |
    | `pageSize` | Integer | 否 | `50` | 每页数量。 |
    | `startDate`| String | 否 | | 开始日期, 格式 `YYYY-MM-DD`。 |
    | `endDate` | String | 否 | | 结束日期, 格式 `YYYY-MM-DD`。 |
    | `type` | String | 否 | `all` | 通知类型，`all` 表示所有类型。 |
-   **成功响应 (200 OK)**:
    *   响应结构与**获取通知列表**接口完全相同，包含 `notifications` 和 `pagination` 字段。
-   **状态码说明**:
    *   `200 OK`: 请求成功。
    *   `401 Unauthorized`: 未授权或Token过期。
    *   `500 Internal Server Error`: 服务器内部错误。

---

### **13. 获取通知设置**

-   **功能描述**: 获取当前用户的通知偏好设置。
-   **请求方法**: `GET`
-   **请求地址**: `/api/v1/notifications/settings`
-   **请求头**:
    | 参数 | 类型 | 是否必须 | 描述 |
    | :--- | :--- | :--- | :--- |
    | `Authorization` | String | 是 | 用户认证Token, 格式: `Bearer <token>` |
-   **成功响应 (200 OK)**:
    ```json
    {
        "success": true,
        "message": "获取通知设置成功",
        "settings": {
            "email": true,
            "push": true,
            "desktop": false,
            "frequency": "immediate",
            "quietHours": {
                "enabled": true,
                "start": "22:00",
                "end": "08:00"
            },
            "types": {
                "document_shared": true,
                "review_reminder": true,
                "achievement_unlocked": true,
                "system_update": true,
                "promotional": false
            },
            "updatedAt": "2023-10-26T14:00:00Z"
        }
    }
    ```
-   **响应体字段说明**:
    *   `settings` (Object): 设置对象。
        *   `email`, `push`, `desktop` (Boolean): 各渠道通知开关。
        *   `frequency` (String): 通知频率, 例如 `immediate`, `daily`。
        *   `quietHours` (Object): 免打扰时间设置。
        *   `types` (Object): 各类通知的开关状态。
        *   `updatedAt` (String): 设置的最后更新时间。
-   **状态码说明**:
    *   `200 OK`: 请求成功。
    *   `401 Unauthorized`: 未授权或Token过期。
    *   `500 Internal Server Error`: 服务器内部错误。

---

### **14. 更新通知设置**

-   **功能描述**: 更新用户的通知偏好设置。
-   **请求方法**: `PUT`
-   **请求地址**: `/api/v1/notifications/settings`
-   **请求头**:
    | 参数 | 类型 | 是否必须 | 描述 |
    | :--- | :--- | :--- | :--- |
    | `Authorization` | String | 是 | 用户认证Token, 格式: `Bearer <token>` |
-   **请求体 (Request Body)**:
    *   请求体结构与**获取通知设置**响应中的 `settings` 对象类似，所有字段均为可选。发送的字段将被更新。
-   **请求体示例 (仅更新部分设置)**:
    ```json
    {
        "desktop": true,
        "quietHours": {
            "enabled": false
        },
        "types": {
            "promotional": true
        }
    }
    ```
-   **成功响应 (200 OK)**:
    *   响应结构与**获取通知设置**的成功响应相同，返回更新后的完整设置。
-   **状态码说明**:
    *   `200 OK`: 更新成功。
    *   `401 Unauthorized`: 未授权或Token过期。
    *   `500 Internal Server Error`: 服务器内部错误。

<br>

## **订阅 & 调试类接口**

---

### **15. 订阅通知频道**

-   **功能描述**: 为特定设备或渠道订阅通知。
-   **请求方法**: `POST`
-   **请求地址**: `/api/v1/notifications/subscribe`
-   **请求头**:
    | 参数 | 类型 | 是否必须 | 描述 |
    | :--- | :--- | :--- | :--- |
    | `Authorization` | String | 是 | 用户认证Token, 格式: `Bearer <token>` |
-   **请求体 (Request Body)**:
    | 字段 | 类型 | 是否必须 | 描述 |
    | :--- | :--- | :--- | :--- |
    | `channel` | String | 是 | 订阅的频道。可选值: `push`, `email`, `desktop`。 |
    | `deviceToken`| String | `channel`为`push`时是 | 设备的唯一令牌，用于推送通知。 |
-   **请求体示例**:
    ```json
    {
        "channel": "push",
        "deviceToken": "a1b2c3d4e5f6..."
    }
    ```
-   **成功响应 (200 OK)**:
    ```json
    {
        "success": true,
        "message": "订阅通知频道成功",
        "channel": "push",
        "subscribedAt": "2023-10-27T11:50:00Z"
    }
    ```
-   **状态码说明**:
    *   `200 OK`: 订阅成功。
    *   `400 Bad Request`: 参数无效。
    *   `401 Unauthorized`: 未授权或Token过期。
    *   `500 Internal Server Error`: 服务器内部错误。

---

### **16. 取消订阅通知频道**

-   **功能描述**: 取消对特定通知渠道的订阅。
-   **请求方法**: `DELETE`
-   **请求地址**: `/api/v1/notifications/unsubscribe`
-   **请求头**:
    | 参数 | 类型 | 是否必须 | 描述 |
    | :--- | :--- | :--- | :--- |
    | `Authorization` | String | 是 | 用户认证Token, 格式: `Bearer <token>` |
-   **请求体 (Request Body)**:
    | 字段 | 类型 | 是否必须 | 描述 |
    | :--- | :--- | :--- | :--- |
    | `channel` | String | 是 | 要取消订阅的频道。可选值: `push`, `email`, `desktop`。 |
-   **请求体示例**:
    ```json
    {
        "channel": "push"
    }
    ```
-   **成功响应 (200 OK)**:
    ```json
    {
        "success": true,
        "message": "取消订阅通知频道成功",
        "channel": "push",
        "unsubscribedAt": "2023-10-27T11:55:00Z"
    }
    ```
-   **状态码说明**:
    *   `200 OK`: 取消订阅成功。
    *   `400 Bad Request`: 参数无效。
    *   `401 Unauthorized`: 未授权或Token过期。
    *   `500 Internal Server Error`: 服务器内部错误。

---

### **17. 发送测试通知**

-   **功能描述**: 为当前用户发送一条测试通知，用于调试。
-   **请求方法**: `POST`
-   **请求地址**: `/api/v1/notifications/test`
-   **请求头**:
    | 参数 | 类型 | 是否必须 | 描述 |
    | :--- | :--- | :--- | :--- |
    | `Authorization` | String | 是 | 用户认证Token, 格式: `Bearer <token>` |
-   **请求体 (Request Body)**:
    *   请求体字段均为可选，如果不提供，将使用默认值。
    | 字段 | 类型 | 默认值 | 描述 |
    | :--- | :--- | :--- | :--- |
    | `type` | String | `test` | 通知类型。 |
    | `title` | String | `测试通知` | 通知标题。 |
    | `message`| String | `这是一条测试通知` | 通知内容。 |
    | `icon` | String | `/icons/test.png`| 图标URL。 |
    | `targetType` | String | `test` | 关联目标类型。 |
    | `targetId` | String | `test_123` | 关联目标ID。 |
-   **请求体示例 (使用默认值)**:
    ```json
    {}
    ```
-   **成功响应 (200 OK)**:
    *   响应结构与**创建通知**的成功响应相同，返回创建的测试通知对象。
-   **状态码说明**:
    *   `200 OK`: 测试通知发送成功。
    *   `401 Unauthorized`: 未授权或Token过期。
    *   `500 Internal Server Error`: 服务器内部错误。

---
好的，我已经仔细分析了你提供的所有 Java 接口定义文件。根据这些文件，我为你整理了一份完整的、供前端开发团队使用的 API 接口文档。

文档结构清晰，涵盖了每个接口的功能说明、请求地址、请求方法、请求参数、响应格式、状态码说明以及示例，旨在帮助前端团队快速理解和对接。

---

# **OCR 相关接口文档**

本文档详细描述了与文档光学字符识别（OCR）功能相关的后端API接口。

**通用说明:**
- **根路径 (Base URL):** 所有接口的根路径为 `/api/v1`。
- **认证 (Authentication):** 文档中未明确包含认证逻辑，实际部署时可能需要通过 Header 传递 `Authorization` Token。
- **数据格式 (Data Format):** 所有请求和响应的主体格式均为 `application/json`。
- **日期格式 (Date Format):** 除非另有说明，所有日期和时间字符串均采用 `ISO 8601` 格式，例如 `2023-10-27T10:00:00`。

---

## **1. 文档与任务创建 (Document & Task Creation)**

### 1.1 上传文档并附带OCR结果

**功能描述**
上传一个新文档，可以同时提供预先处理好的OCR结果。服务器将保存文档信息和OCR结果。

- **请求地址:** `/api/v1/documents/upload-with-ocr`
- **请求方法:** `POST`

#### **请求参数 (Request Body)**

| 参数名 | 类型 | 必需 | 描述 |
| :--- | :--- | :--- | :--- |
| `title` | `String` | 是 | 文档的标题。 |
| `fileContent` | `String` | 是 | 文件的Base64编码内容。 |
| `author` | `String` | 否 | 文档的作者。 |
| `tags` | `String` | 否 | 标签的JSON数组字符串，例如：`"[\"技术\", \"后端\"]"`。 |
| `language`| `String` | 否 | 文档的主要语言。 |
| `description`| `String`| 否 | 文档的描述信息。 |
| `autoOCR` | `boolean`| 否 | 是否在上传后自动触发OCR（此接口中主要用于标记，实际处理依赖 `ocrResult`）。 |
| `ocrResult` | `String` | 否 | 一个包含单页OCR结果的JSON字符串。如果提供，服务器将直接保存此结果。详见下方 `OcrResultData` 结构。 |
| `extractImages`| `boolean`| 否 | 是否提取文档中的图片（功能标记）。 |
| `createThumbnails`| `boolean`| 否 | 是否创建文档缩略图（功能标记）。 |
| `preserveFormat`| `boolean`| 否 | 是否保留原始格式（功能标记）。 |

**`ocrResult` 内部 `OcrResultData` 结构:**
```json
{
  "text": "识别出的文本内容...",
  "confidence": 95.5,
  "words": "[{\"text\":\"单词1\", \"bbox\":[...]}, ...]",
  "lines": "[{\"text\":\"行1\", \"bbox\":[...]}, ...]",
  "blocks": "[{\"text\":\"块1\", \"bbox\":[...]}, ...]",
  "metadata": "{\"engine\":\"tesseract\", \"language\":\"eng\"}"
}
```

#### **响应格式 (Response Body)**

| 参数名 | 类型 | 描述 |
| :--- | :--- | :--- |
| `success` | `boolean` | 请求是否成功。 |
| `message` | `String` | 响应信息。 |
| `data` | `Object` | 成功时返回的数据，结构如下。 |
| `data.id`| `String` | 创建的OCR结果记录ID。 |
| `data.documentId`|`String` | 新创建的文档ID。 |
| `data.title` | `String` | 文档标题。 |
| `data.ocrProcessed`| `boolean`| OCR是否已处理（基于是否提供了 `ocrResult`）。 |
| `data.ocrConfidence`| `double`| OCR识别的置信度。 |
| `data.ocrText` | `String` | OCR识别的文本摘要。 |
| `data.ocrPages` | `String` | 包含OCR结果页面的JSON数组字符串。 |
| `data.createdAt` | `String` | 创建时间。 |
| `data.updatedAt` | `String` | 更新时间。 |

#### **状态码说明**
- `200 OK`: 上传和处理成功。
- `400 Bad Request`: 请求参数无效，如标题或文件内容为空。
- `500 Internal Server Error`: 服务器内部错误。

#### **示例**
**请求:**
```http
POST /api/v1/documents/upload-with-ocr
Content-Type: application/json

{
  "title": "项目年度报告",
  "author": "开发团队",
  "tags": "[\"报告\", \"年度总结\"]",
  "language": "zh",
  "description": "2023年项目年度总结报告。",
  "autoOCR": true,
  "ocrResult": "{\"text\":\"这是第一页的OCR内容。\",\"confidence\":92.8}",
  "fileContent": "JVBERi0xLjQKJ..."
}
```

**响应:**
```json
{
  "success": true,
  "message": "文档上传并OCR处理成功",
  "data": {
    "id": "ocr_1698389482181",
    "documentId": "doc_e8c1a7d2",
    "title": "项目年度报告",
    "ocrProcessed": true,
    "ocrConfidence": 92.8,
    "ocrText": "这是第一页的OCR内容。",
    "ocrPages": "[{\"page\":1,\"text\":\"这是第一页的OCR内容。\",\"confidence\":92.8}]",
    "createdAt": "2023-10-27T10:51:22.181",
    "updatedAt": "2023-10-27T10:51:22.181"
  }
}
```

---

### 1.2 发起批量OCR处理任务

**功能描述**
为多个文档的指定页面（或默认页面）创建一个异步的批量OCR处理任务。服务器将立即返回一个任务ID，前端可以通过该ID轮询任务状态。

- **请求地址:** `/api/v1/documents/batch-ocr`
- **请求方法:** `POST`

#### **请求参数 (Request Body)**

| 参数名 | 类型 | 必需 | 描述 |
| :--- | :--- | :--- | :--- |
| `documentIds` | `List<String>` | 是 | 需要进行OCR处理的文档ID列表。 |
| `options` | `Object` | 否 | OCR处理选项，结构见下表。 |
| `pages` | `Map<String, List<Integer>>` | 否 | 指定每个文档需要处理的页码。Key为 `documentId`，Value为页码列表。如果未提供，则默认处理每个文档的第一页。 |

**`options` 结构:**

| 参数名 | 类型 | 必需 | 默认值 | 描述 |
| :--- | :--- | :--- | :--- | :--- |
| `language` | `String` | 否 | "auto" | 识别语言。 |
| `confidence`| `Integer`| 否 | 70 | 结果采纳的最低置信度阈值。 |
| `preprocess`| `boolean`| 否 | `true` | 是否进行图像预处理。 |
| `format` | `String` | 否 | "text" | 输出格式。 |
| `pageSegMode`| `Integer`| 否 | 6 | Tesseract的页面分割模式。 |

#### **响应格式 (Response Body)**

| 参数名 | 类型 | 描述 |
| :--- | :--- | :--- |
| `success` | `boolean` | 请求是否成功。 |
| `message` | `String` | 响应信息。 |
| `data` | `Object` | 成功时返回的批量任务信息。 |
| `data.batchId`|`String` | 创建的批量任务ID。 |
| `data.totalDocuments`| `Integer` | 本次任务处理的文档总数。 |
| `data.totalPages` | `Integer` | 本次任务处理的总页数。 |
| `data.estimatedTime`| `Integer` | 预估处理时间（秒）。 |

#### **状态码说明**
- `200 OK`: 批量任务已成功启动。
- `400 Bad Request`: 请求参数无效，如 `documentIds` 列表为空。
- `404 Not Found`: `documentIds` 中包含不存在的文档ID。
- `500 Internal Server Error`: 服务器内部错误。


#### **示例**
**请求:**
```http
POST /api/v1/documents/batch-ocr
Content-Type: application/json

{
  "documentIds": ["doc_abc123", "doc_def456"],
  "options": {
    "language": "zh",
    "confidence": 75
  },
  "pages": {
    "doc_abc123": [1, 3, 5],
    "doc_def456": [1]
  }
}
```

**响应:**
```json
{
  "success": true,
  "message": "批量OCR处理任务已启动",
  "data": {
    "batchId": "batch_ocr_a1b2c3d4",
    "totalDocuments": 2,
    "totalPages": 4,
    "estimatedTime": 40
  }
}
```

---

### 1.3 对指定页面内容发起OCR处理任务

**功能描述**
直接提供页面内容（如Base64编码的图片）发起一个单页的异步OCR处理任务。这对于前端截屏识别或处理单张图片非常有用。

- **请求地址:** `/api/v1/documents/{documentId}/pages/{page}/ocr-process`
- **请求方法:** `POST`

#### **请求参数**
- **路径参数 (Path Parameters):**
  | 参数名 | 类型 | 必需 | 描述 |
  | :--- | :--- | :--- | :--- |
  | `documentId`| `String`| 是 | 页面所属的文档ID。 |
  | `page` | `Integer`| 是 | 待处理的页码。 |

- **请求体 (Request Body):**
  | 参数名 | 类型 | 必需 | 描述 |
  | :--- | :--- | :--- | :--- |
  | `content` | `String` | 是 | 页面内容，可以是Base64编码的图片字符串或HTML文本。 |
  | `isImageContent`| `boolean`| 是 | 标记 `content` 是否为图片内容。`true`为图片，`false`为HTML。 |
  | `options` | `Object` | 否 | OCR处理选项，结构与 `1.2 发起批量OCR处理任务` 中的 `options` 类似。 |

#### **响应格式 (Response Body)**

| 参数名 | 类型 | 描述 |
| :--- | :--- | :--- |
| `success` | `boolean` | 请求是否成功。 |
| `message` | `String` | 响应信息。 |
| `data` | `Object` | 成功时返回的单页任务信息。 |
| `data.taskId`|`String` | 创建的单页任务ID。 |
| `data.status` | `String` | 任务初始状态，通常为 "processing"。 |
| `data.progress`| `Integer`| 任务初始进度，通常为 0。 |
| `data.estimatedTime`| `Integer` | 预估处理时间（秒）。 |

#### **状态码说明**
- `200 OK`: 单页OCR任务已成功启动。
- `400 Bad Request`: 请求参数无效，如 `content` 为空。
- `404 Not Found`: 指定的 `documentId` 不存在。
- `500 Internal Server Error`: 服务器内部错误。

#### **示例**
**请求:**
```http
POST /api/v1/documents/doc_abc123/pages/1/ocr-process
Content-Type: application/json

{
  "content": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUg...",
  "isImageContent": true,
  "options": {
    "language": "eng"
  }
}
```

**响应:**
```json
{
  "success": true,
  "message": "页面OCR处理任务已启动",
  "data": {
    "taskId": "page_ocr_f5e4d3c2",
    "status": "processing",
    "progress": 0,
    "estimatedTime": 15
  }
}
```

---

## **2. 任务管理与状态查询 (Task Management & Status)**

### 2.1 获取OCR任务状态

**功能描述**
查询一个（批量或单个）OCR任务的当前状态、进度和结果。前端应使用此接口进行轮询，以更新任务状态。

- **请求地址:** `/api/v1/documents/ocr/tasks/{taskId}/status`
- **请求方法:** `GET`

#### **请求参数 (Path Parameters)**

| 参数名 | 类型 | 必需 | 描述 |
| :--- | :--- | :--- | :--- |
| `taskId` | `String` | 是 | 要查询状态的任务ID（可以是批量任务ID或单页任务ID）。 |


#### **响应格式 (Response Body)**

| 参数名 | 类型 | 描述 |
| :--- | :--- | :--- |
| `success` | `boolean` | 请求是否成功。 |
| `message` | `String` | 响应信息。 |
| `data` | `Object` | 成功时返回的任务状态数据。 |
| `data.taskId` | `String` | 任务ID。 |
| `data.status` | `String` | 任务状态，如 `processing`, `completed`, `failed`, `cancelled`。 |
| `data.progress` | `Integer` | 任务进度百分比（0-100）。 |
| `data.currentDocument` | `String` | (仅单页任务) 当前处理的文档ID。 |
| `data.currentPage` | `Integer` | (仅单页任务) 当前处理的页码。 |
| `data.totalPages` | `Integer` | 任务总页数。 |
| `data.estimatedTimeRemaining` | `Integer` | 预估剩余时间（秒）。 |
| `data.result` | `Object` | 任务完成后出现。包含任务的最终统计结果。 |
| `data.result.processedPages` | `Integer` | 已处理的总页数。 |
| `data.result.successfulPages`| `Integer` | 成功处理的页数。 |
| `data.result.failedPages` | `Integer` | 失败处理的页数。 |
| `data.result.averageConfidence`|`Double` | 平均置信度。 |

#### **状态码说明**
- `200 OK`: 获取状态成功。
- `400 Bad Request`: 任务ID无效。
- `404 Not Found`: 任务ID不存在。
- `500 Internal Server Error`: 服务器内部错误。


#### **示例**
**请求:**
```http
GET /api/v1/documents/ocr/tasks/batch_ocr_a1b2c3d4/status
```

**响应 (处理中):**
```json
{
  "success": true,
  "message": "获取批量OCR任务状态成功",
  "data": {
    "taskId": "batch_ocr_a1b2c3d4",
    "status": "processing",
    "progress": 50,
    "currentDocument": null,
    "currentPage": null,
    "totalPages": 4,
    "estimatedTimeRemaining": 20,
    "result": null
  }
}
```

**响应 (已完成):**
```json
{
  "success": true,
  "message": "获取批量OCR任务状态成功",
  "data": {
    "taskId": "batch_ocr_a1b2c3d4",
    "status": "completed",
    "progress": 100,
    "currentDocument": null,
    "currentPage": null,
    "totalPages": 4,
    "estimatedTimeRemaining": 0,
    "result": {
      "processedPages": 4,
      "successfulPages": 4,
      "failedPages": 0,
      "averageConfidence": 91.45
    }
  }
}
```

---

### 2.2 取消OCR任务

**功能描述**
取消一个正在进行中的OCR任务。

- **请求地址:** `/api/v1/documents/ocr/tasks/{taskId}/cancel`
- **请求方法:** `POST`

#### **请求参数**
- **路径参数 (Path Parameters):**
  | 参数名 | 类型 | 必需 | 描述 |
  | :--- | :--- | :--- | :--- |
  | `taskId` | `String` | 是 | 要取消的任务ID。 |
- **请求体 (Request Body):**
  | 参数名 | 类型 | 必需 | 描述 |
  | :--- | :--- | :--- | :--- |
  | `reason` | `String` | 否 | 取消任务的原因。 |


#### **响应格式 (Response Body)**

| 参数名 | 类型 | 描述 |
| :--- | :--- | :--- |
| `success` | `boolean` | 请求是否成功。 |
| `message` | `String` | 响应信息。 |
| `data` | `Object` | 成功时返回的取消确认信息。 |
| `data.taskId` | `String` | 被取消的任务ID。 |
| `data.status` | `String` | 任务状态，将为 `cancelled`。 |
| `data.cancelledAt`|`String` | 取消时间。 |
| `data.reason` | `String` | 取消原因。 |

#### **状态码说明**
- `200 OK`: 任务取消成功。
- `400 Bad Request`: 任务已完成或已取消，无法再次取消。
- `404 Not Found`: 任务ID不存在。
- `500 Internal Server Error`: 服务器内部错误。

#### **示例**
**请求:**
```http
POST /api/v1/documents/ocr/tasks/batch_ocr_a1b2c3d4/cancel
Content-Type: application/json

{
  "reason": "用户手动取消"
}
```

**响应:**
```json
{
  "success": true,
  "message": "批量OCR任务取消成功",
  "data": {
    "taskId": "batch_ocr_a1b2c3d4",
    "status": "cancelled",
    "cancelledAt": "2023-10-27T11:05:00",
    "reason": "用户手动取消"
  }
}
```

---

## **3. OCR 结果与数据获取 (OCR Results & Data Retrieval)**

### 3.1 获取指定页面的OCR结果

**功能描述**
获取文档中特定页面的详细OCR识别结果。

- **请求地址:** `/api/v1/documents/{documentId}/ocr/{page}`
- **请求方法:** `GET`

#### **请求参数 (Path Parameters)**

| 参数名 | 类型 | 必需 | 描述 |
| :--- | :--- | :--- | :--- |
| `documentId`| `String`| 是 | 文档ID。 |
| `page` | `Integer`| 是 | 要获取结果的页码。 |

#### **响应格式 (Response Body)**

| 参数名 | 类型 | 描述 |
| :--- | :--- | :--- |
| `success` | `boolean` | 请求是否成功。 |
| `message` | `String` | 响应信息。 |
| `data` | `Object` | 成功时返回的OCR结果数据。 |
| `data.id`| `String` | OCR结果记录的唯一ID。 |
| `data.documentId`|`String` | 文档ID。 |
| `data.page` | `Integer` | 页码。 |
| `data.text` | `String` | 识别出的完整文本。 |
| `data.confidence`|`Double` | 平均置信度。 |
| `data.words` | `String` | 包含所有识别单词及其位置的JSON数组字符串。 |
| `data.lines` | `String` | 包含所有识别文本行及其位置的JSON数组字符串。 |
| `data.blocks`| `String` | 包含所有识别文本块及其位置的JSON数组字符串。 |
| `data.metadata`|`String` | 包含OCR引擎、语言等元数据的JSON对象字符串。 |
| `data.createdAt`|`String` | 创建时间。 |
| `data.updatedAt`|`String` | 最后更新时间。 |

#### **状态码说明**
- `200 OK`: 获取成功。
- `400 Bad Request`: 页码无效。
- `404 Not Found`: 文档或指定页面的OCR结果不存在。
- `500 Internal Server Error`: 服务器内部错误。


#### **示例**
**请求:**
```http
GET /api/v1/documents/doc_abc123/ocr/1
```

**响应:**
```json
{
  "success": true,
  "message": "获取OCR结果成功",
  "data": {
    "id": "ocr_1698389482181",
    "documentId": "doc_abc123",
    "page": 1,
    "text": "这是第一页的OCR内容。",
    "confidence": 92.8,
    "words": "[]",
    "lines": "[]",
    "blocks": "[]",
    "metadata": "{\"engine\":\"tesseract\"}",
    "createdAt": "2023-10-27T10:51:22.181",
    "updatedAt": "2023-10-27T10:51:22.181"
  }
}
```

---

### 3.2 导出文档的OCR文本

**功能描述**
将指定文档的OCR结果导出为特定格式的文件（如TXT, JSON, CSV）。

- **请求地址:** `/api/v1/documents/{documentId}/ocr/export`
- **请求方法:** `POST`

#### **请求参数**
- **路径参数 (Path Parameters):**
  | 参数名 | 类型 | 必需 | 描述 |
  | :--- | :--- | :--- | :--- |
  | `documentId`| `String`| 是 | 文档ID。 |
- **请求体 (Request Body):**
  | 参数名 | 类型 | 必需 | 默认值 | 描述 |
  | :--- | :--- | :--- | :--- | :--- |
  | `pages` | `List<Integer>` | 否 | (所有页面) | 要导出的页面列表。 |
  | `format`| `String` | 否 | "txt" | 导出格式，支持 `txt`, `json`, `csv`。 |
  | `includeMetadata`|`boolean`| 否 | `true` | 是否在导出内容中包含元数据。 |
  | `includeConfidence`|`boolean`| 否 |`false` | 是否在导出内容中包含置信度。 |

#### **响应格式 (Response Body)**

| 参数名 | 类型 | 描述 |
| :--- | :--- | :--- |
| `success` | `boolean` | 请求是否成功。 |
| `message` | `String` | 响应信息。 |
| `data` | `Object` | 成功时返回的导出任务信息。 |
| `data.exportId`|`String` | 导出任务的唯一ID。 |
| `data.documentId`|`String` | 文档ID。 |
| `data.format` | `String` | 导出的文件格式。 |
| `data.downloadUrl`| `String` | 文件下载链接。 |
| `data.totalPages`| `Integer`| 导出的总页数。 |
| `data.createdAt` | `String` | 导出任务创建时间。 |

#### **状态码说明**
- `200 OK`: 导出任务创建成功。
- `404 Not Found`: 文档或OCR结果不存在。
- `500 Internal Server Error`: 服务器内部错误。


#### **示例**
**请求:**
```http
POST /api/v1/documents/doc_abc123/ocr/export
Content-Type: application/json

{
  "pages": [1, 2],
  "format": "json",
  "includeConfidence": true
}
```

**响应:**
```json
{
  "success": true,
  "message": "OCR文本导出成功",
  "data": {
    "exportId": "export_b4c3d2a1",
    "documentId": "doc_abc123",
    "format": "json",
    "downloadUrl": "/api/exports/export_b4c3d2a1.json",
    "totalPages": 2,
    "createdAt": "2023-10-27T11:20:00"
  }
}
```

---

### 3.3 获取OCR历史记录

**功能描述**
获取单个或所有文档的OCR处理历史记录，支持分页和按日期筛选。

- **请求地址 (单个文档):** `/api/v1/documents/{documentId}/ocr/histories`
- **请求地址 (所有文档):** `/api/v1/documents/ocr/histories`
- **请求方法:** `GET`

#### **请求参数**
- **路径参数 (Path Parameters):**
  | 参数名 | 类型 | 必需 | 描述 |
  | :--- | :--- | :--- | :--- |
  | `documentId`| `String`| 是 (仅单个文档)| 文档ID。 |

- **查询参数 (Query Parameters):**
  | 参数名 | 类型 | 必需 | 默认值 | 描述 |
  | :--- | :--- | :--- | :--- | :--- |
  | `page` | `Integer` | 否(仅单个文档)| - | 筛选特定页码的历史记录。 |
  | `startDate`| `String` | 否 | - | 开始日期，格式 `YYYY-MM-DD`。 |
  | `endDate` | `String` | 否 | - | 结束日期，格式 `YYYY-MM-DD`。 |
  | `pageNum` | `Integer` | 否(仅所有文档)| 1 | 分页页码。 |
  | `pageSize`| `Integer` | 否(仅所有文档)| 20 | 每页记录数。 |


#### **响应格式 (Response Body)**
响应体为一个对象，包含 `success`, `message` 和 `data` 字段。`data` 是一个 `OcrHistoryItem` 对象数组。
对于“所有文档”的接口，还会额外返回 `totalCount`, `totalPages`, `currentPage` 字段。

**`OcrHistoryItem` 结构:**
| 参数名 | 类型 | 描述 |
| :--- | :--- | :--- |
| `id` | `String` | OCR结果记录的唯一ID。 |
| `documentId`|`String` | 文档ID。 |
| `page` | `Integer` | 页码。 |
| `text` | `String` | 识别出的文本。 |
| `confidence`|`Double` | 置信度。 |
| `metadata` | `String` | 元数据的JSON字符串。 |
| `createdAt` | `String` | 创建时间。 |
| `updatedAt` | `String` | 更新时间。 |

#### **示例**
**请求:**
```http
GET /api/v1/documents/doc_abc123/ocr/histories?startDate=2023-01-01
```

**响应:**
```json
{
  "success": true,
  "message": "获取OCR历史成功",
  "data": [
    {
      "id": "ocr_1698389482181",
      "documentId": "doc_abc123",
      "page": 1,
      "text": "这是第一页的OCR内容。",
      "confidence": 92.8,
      "metadata": "{\"engine\":\"tesseract\"}",
      "createdAt": "2023-10-27T10:51:22.181",
      "updatedAt": "2023-10-27T10:51:22.181"
    }
  ]
}
```

---

## **4. 配置与更新 (Configuration & Updates)**

### 4.1 更新指定页面的OCR结果

**功能描述**
手动更新或修正某一页的OCR结果。如果该页没有结果，则会创建一条新记录。

- **请求地址:** `/api/v1/documents/{documentId}/ocr/{page}`
- **请求方法:** `PUT`

#### **请求参数**
- **路径参数 (Path Parameters):**
  | 参数名 | 类型 | 必需 | 描述 |
  | :--- | :--- | :--- | :--- |
  | `documentId`| `String`| 是 | 文档ID。 |
  | `page` | `Integer`| 是 | 要更新的页码。 |

- **请求体 (Request Body):**
  | 参数名 | 类型 | 必需 | 描述 |
  | :--- | :--- | :--- | :--- |
  | `ocrData` | `Object` | 是 | 包含要更新的OCR数据。 |
  | `ocrData.text`| `String` | 是 | 更新后的文本内容。 |
  | `ocrData.confidence`| `Double` | 否 | 更新后的置信度。 |
  | `ocrData.words`| `String` | 否 | 更新后的单词JSON字符串。 |
  | `ocrData.lines`| `String` | 否 | 更新后的文本行JSON字符串。 |
  | `ocrData.metadata`|`String` | 否 | 更新后的元数据JSON字符串。 |


#### **响应格式 (Response Body)**
| 参数名 | 类型 | 描述 |
| :--- | :--- | :--- |
| `success` | `boolean` | 请求是否成功。 |
| `message` | `String` | 响应信息。 |
| `data` | `Object` | 成功时返回更新后的部分数据。 |
| `data.id`| `String` | OCR结果记录ID。 |
| `data.documentId`|`String` | 文档ID。 |
| `data.page` | `Integer` | 页码。 |
| `data.text` | `String` | 更新后的文本。 |
| `data.confidence`|`Double` | 更新后的置信度。 |
| `data.updatedAt`|`String` | 更新时间。 |


#### **状态码说明**
- `200 OK`: 更新成功。
- `400 Bad Request`: 请求数据无效，如 `ocrData.text` 为空。
- `404 Not Found`: 文档不存在。
- `500 Internal Server Error`: 服务器内部错误。


#### **示例**
**请求:**
```http
PUT /api/v1/documents/doc_abc123/ocr/1
Content-Type: application/json

{
  "ocrData": {
    "text": "这是手动修正后的第一页内容。",
    "confidence": 100.0
  }
}
```

**响应:**
```json
{
  "success": true,
  "message": "OCR结果更新成功",
  "data": {
    "id": "ocr_1698389482181",
    "documentId": "doc_abc12s3",
    "page": 1,
    "text": "这是手动修正后的第一页内容。",
    "confidence": 100.0,
    "updatedAt": "2023-10-27T11:45:10.555"
  }
}
```

---

### 4.2 获取OCR相关设置

**功能描述**
获取指定文档的默认OCR处理设置。

- **请求地址:** `/api/v1/documents/{documentId}/ocr/options`
- **请求方法:** `GET`

#### **请求参数 (Path Parameters)**

| 参数名 | 类型 | 必需 | 描述 |
| :--- | :--- | :--- | :--- |
| `documentId`| `String`| 是 | 文档ID。 |

#### **响应格式 (Response Body)**
| 参数名 | 类型 | 描述 |
| :--- | :--- | :--- |
| `success` | `boolean` | 请求是否成功。 |
| `message` | `String` | 响应信息。 |
| `data` | `Object` | 成功时返回的设置数据。 |
| `data.documentId`|`String` | 文档ID。 |
| `data.settings`| `Object`| OCR设置对象。 |
| `data.settings.defaultLanguage` | `String` | 默认识别语言。 |
| `data.settings.defaultConfidence`| `Integer`| 默认置信度阈值。 |
| `data.settings.autoPreprocess` | `boolean`| 是否默认开启预处理。 |
| `data.settings.supportedLanguages`|`String` | 支持的语言列表（JSON数组字符串）。 |
| `data.settings.engine` | `String` | 使用的OCR引擎。 |
| `data.updatedAt`| `String` | 设置的最后更新时间。 |


#### **示例**
**请求:**
```http
GET /api/v1/documents/doc_abc123/ocr/options
```
**响应:**
```json
{
  "success": true,
  "message": "获取OCR设置成功",
  "data": {
    "documentId": "doc_abc123",
    "settings": {
      "defaultLanguage": "auto",
      "defaultConfidence": 70,
      "autoPreprocess": true,
      "supportedLanguages": "[\"zh\",\"en\",\"ja\",\"ko\"]",
      "engine": "tesseract"
    },
    "updatedAt": "2023-10-27T11:50:00"
  }
}
```

---

### 4.3 更新OCR相关设置

**功能描述**
更新指定文档的默认OCR处理设置。如果不存在则创建。

- **请求地址:** `/api/v1/documents/{documentId}/ocr/options`
- **请求方法:** `PUT`

#### **请求参数**
- **路径参数 (Path Parameters):**
  | 参数名 | 类型 | 必需 | 描述 |
  | :--- | :--- | :--- | :--- |
  | `documentId`| `String`| 是 | 文档ID。 |
- **请求体 (Request Body):**
  | 参数名 | 类型 | 必需 | 描述 |
  | :--- | :--- | :--- | :--- |
  | `settings` | `Object` | 是 | 包含要更新的设置项，结构同 `4.2 获取OCR相关设置` 的 `settings` 对象。可以只提供需要修改的字段。 |

#### **响应格式 (Response Body)**
响应格式与 `4.2 获取OCR相关设置` 完全相同，返回更新后的完整设置。

#### **示例**
**请求:**
```http
PUT /api/v1/documents/doc_abc123/ocr/options
Content-Type: application/json

{
  "settings": {
    "defaultLanguage": "zh",
    "defaultConfidence": 80
  }
}
```

**响应:**
```json
{
  "success": true,
  "message": "OCR设置更新成功",
  "data": {
    "documentId": "doc_abc123",
    "settings": {
      "defaultLanguage": "zh",
      "defaultConfidence": 80,
      "autoPreprocess": true,
      "supportedLanguages": "[\"zh\",\"en\",\"ja\",\"ko\"]",
      "engine": "tesseract"
    },
    "updatedAt": "2023-10-27T11:55:00"
  }
}
```好的，我已经分析了您提供的所有Java文件，并为您整理了一份详细的API文档。这份文档包含了每个接口的详细信息，旨在为前端开发团队提供清晰、规范的参考。

---

# **离线功能模块 API 文档**

## **通用说明**

### **1. 基础 URL**

所有接口的基础路径为 `/api/v1/offline`。

### **2. 认证方式**

所有接口都需要通过 `Authorization` 请求头进行用户认证。

- **格式**: `Bearer <token>`
- **示例**: `Authorization: Bearer your_access_token_here`

如果认证失败（未提供Token或Token无效/过期），服务器将返回 `401 Unauthorized` 状态码。

### **3. 数据格式**

- 请求体 (Request Body) 和响应体 (Response Body) 均为 `application/json` 格式。

### **4. 通用响应结构**

大多数响应都遵循以下结构：

```json
{
  "success": true,
  "message": "操作成功的提示信息",
  "data": {
    // 具体的业务数据
  }
}
```

- `success` (`boolean`): 表示操作是否成功。`true` 为成功，`false` 为失败。
- `message` (`string`): 操作结果的文本描述。
- `data` (`object` | `null`): 操作成功时返回的数据。失败时通常为 `null`。

### **5. 通用状态码**

- `200 OK`: 请求成功。
- `400 Bad Request`: 请求参数错误（如格式不正确、缺少必填项、超出范围等）。
- `401 Unauthorized`: 未登录或登录已过期。
- `404 Not Found`: 请求的资源不存在。
- `500 Internal Server Error`: 服务器内部发生未知错误。

---

## **接口文档详情**

### **1. 批量下载文档到离线**

- **功能描述:** 将多个在线文档批量创建为离线下载任务。
- **请求地址:** `/documents/batch-download`
- **请求方法:** `POST`

#### **请求体 (Request Body)**

```json
{
  "document_ids": ["doc_id_1", "doc_id_2"]
}
```
- **字段说明:**
  - `document_ids` (`string[]`): **必需**。要下载的在线文档ID数组，一次最多100个。

#### **响应体 (Response Body) - 成功 (200 OK)**

```json
{
  "success": true,
  "message": "批量下载任务已提交，成功2个，失败0个",
  "data": {
    "batchId": "batch_e8e3d0d8-1b77-4bde-8f4b-00b6f9f3b5e4",
    "total": 2,
    "successCount": 2,
    "failCount": 0,
    "results": [
      {
        "documentId": "doc_id_1",
        "success": true,
        "message": "下载任务已创建",
        "offlineDocId": "offline_doc_f2a4c1b9-3e5f-4a6b-9c8a-1a2b3c4d5e6f",
        "downloadId": "dl_a1b2c3d4-e5f6-7a8b-9c0d-e1f2a3b4c5d6"
      },
      {
        "documentId": "doc_id_2",
        "success": true,
        "message": "下载任务已创建",
        "offlineDocId": "offline_doc_b9c8a7b6-5e4d-3c2b-1a0f-9e8d7c6b5a4b",
        "downloadId": "dl_f1e2d3c4-b5a6-7d8e-9f0a-b1c2d3e4f5a6"
      }
    ]
  }
}
```
- **字段说明:**
  - `data`:
    - `batchId` (`string`): 本次批量任务的唯一ID。
    - `total` (`integer`): 请求下载的总数。
    - `successCount` (`integer`): 成功创建任务的数量。
    - `failCount` (`integer`): 创建任务失败的数量。
    - `results` (`array`): 每个文档的处理结果。
      - `documentId` (`string`): 原始文档ID。
      - `success` (`boolean`): 该文档是否成功创建下载任务。
      - `message` (`string`): 处理结果描述。
      - `offlineDocId` (`string`): （若成功）生成的离线文档ID。
      - `downloadId` (`string`): （若成功）生成的下载任务ID。

---

### **2. 批量删除离线文档**

- **功能描述:** 批量删除已下载的离线文档。
- **请求地址:** `/documents/batch`
- **请求方法:** `DELETE`

#### **请求体 (Request Body)**

```json
{
  "offline_doc_ids": ["offline_doc_id_1", "offline_doc_id_2"]
}
```
- **字段说明:**
  - `offline_doc_ids` (`string[]`): **必需**。要删除的离线文档ID数组，一次最多100个。

#### **响应体 (Response Body) - 成功 (200 OK)**

```json
{
  "success": true,
  "message": "批量删除完成，成功1个，失败1个",
  "data": {
    "total": 2,
    "successCount": 1,
    "failCount": 1,
    "results": [
      {
        "offlineDocId": "offline_doc_id_1",
        "success": true,
        "message": "删除成功"
      },
      {
        "offlineDocId": "offline_doc_id_2_not_exist",
        "success": false,
        "message": "离线文档不存在或无权删除"
      }
    ]
  }
}
```
- **字段说明:**
  - `data`:
    - `total` (`integer`): 请求删除的总数。
    - `successCount` (`integer`): 成功删除的数量。
    - `failCount` (`integer`): 删除失败的数量。
    - `results` (`array`): 每个文档的删除结果。
      - `offlineDocId` (`string`): 离线文档ID。
      - `success` (`boolean`): 该文档是否删除成功。
      - `message` (`string`): 删除结果描述。

---

### **3. 获取离线文档列表**

- **功能描述:** 分页获取当前用户的所有离线文档。
- **请求地址:** `/documents`
- **请求方法:** `GET`

#### **查询参数 (Query Parameters)**

| 参数名 | 类型 | 是否必选 | 默认值 | 描述 |
|---|---|---|---|---|
| page | integer | 否 | 1 | 当前页码，从1开始。 |
| pageSize | integer | 否 | 20 | 每页显示的记录数。 |

#### **响应体 (Response Body) - 成功 (200 OK)**

```json
{
  "success": true,
  "message": "获取离线文档列表成功",
  "data": {
    "documents": [
      {
        "id": "offline_doc_f2a4c1b9-3e5f-4a6b-9c8a-1a2b3c4d5e6f",
        "documentId": "doc_id_1",
        "title": "文档标题",
        "content": "文档内容预览...",
        "description": "这是文档的描述信息",
        "tags": ["Java", "Spring"],
        "fileSize": 10240,
        "fileType": "pdf",
        "downloadUrl": "/api/v1/offline/documents/offline_doc_f2a4c1b9.../download",
        "isSynced": true,
        "offlineVersion": 2,
        "updatedAt": "2023-10-27T10:30:00",
        "createdAt": "2023-10-26T08:00:00"
      }
    ],
    "pagination": {
      "page": 1,
      "pageSize": 20,
      "total": 1,
      "totalPages": 1
    }
  }
}
```
- **字段说明:**
  - `data`:
    - `documents` (`array`): 离线文档列表。
      - `id` (`string`): 离线文档的唯一ID。
      - `documentId` (`string`): 原始在线文档的ID。
      - `title` (`string`): 文档标题。
      - `content` (`string`): 文档内容（可能为部分或完整）。
      - `description` (`string`): 文档描述。
      - `tags` (`string[]`): 文档标签。
      - `fileSize` (`long`): 文件大小（字节）。
      - `fileType` (`string`): 文件类型（如: pdf, epub）。
      - `downloadUrl` (`string`): 离线下载地址。
      - `isSynced` (`boolean`): 是否已与云端同步。
      - `offlineVersion` (`integer`): 离线版本号。
      - `updatedAt` (`string`): 最后更新时间。
      - `createdAt` (`string`): 创建时间。
    - `pagination` (`object`): 分页信息。
      - `page` (`integer`): 当前页码。
      - `pageSize` (`integer`): 每页数量。
      - `total` (`integer`): 总记录数。
      - `totalPages` (`integer`): 总页数。

---

### **4. 获取单个离线文档详情**

- **功能描述:** 根据离线文档ID获取其详细信息。
- **请求地址:** `/documents/{offlineDocId}`
- **请求方法:** `GET`

#### **路径参数 (Path Parameters)**

| 参数名 | 类型 | 描述 |
|---|---|---|
| offlineDocId | string | **必需**。离线文档的唯一ID。 |

#### **响应体 (Response Body) - 成功 (200 OK)**

```json
{
  "success": true,
  "message": "获取离线文档详情成功",
  "data": {
    "document": {
      "id": "offline_doc_f2a4c1b9-3e5f-4a6b-9c8a-1a2b3c4d5e6f",
      "documentId": "doc_id_1",
      "title": "文档标题",
      "content": "完整的文档内容...",
      "description": "这是文档的描述信息",
      "tags": ["Java", "Spring"],
      "fileSize": 10240,
      "fileType": "pdf",
      "downloadUrl": "/api/v1/offline/documents/offline_doc_f2a4c1b9.../download",
      "isSynced": true,
      "offlineVersion": 2,
      "updatedAt": "2023-10-27T10:30:00",
      "createdAt": "2023-10-26T08:00:00"
    }
  }
}
```
- **字段说明:**
  - `data.document`: 离线文档对象，字段同 **获取离线文档列表** 中的文档对象。

---

### **5. 更新离线文档信息**

- **功能描述:** 更新离线文档的元数据（如标题、描述、标签）。
- **请求地址:** `/documents/{offlineDocId}`
- **请求方法:** `PUT`

#### **路径参数 (Path Parameters)**

| 参数名 | 类型 | 描述 |
|---|---|---|
| offlineDocId | string | **必需**。要更新的离线文档ID。 |

#### **请求体 (Request Body)**

```json
{
  "data": {
    "title": "新的文档标题",
    "description": "更新后的描述",
    "tags": ["Java", "Updated"]
  }
}
```
- **字段说明:**
  - `data`:
    - `title` (`string`): **可选**。新的文档标题。
    - `description` (`string`): **可选**。新的文档描述。
    - `tags` (`string[]`): **可选**。新的标签数组。

#### **响应体 (Response Body) - 成功 (200 OK)**

```json
{
  "success": true,
  "message": "离线文档更新成功",
  "data": {
    "offlineDocId": "offline_doc_f2a4c1b9...",
    "title": "新的文档标题",
    "description": "更新后的描述",
    "tags": ["Java", "Updated"],
    "isSynced": false,
    "updatedAt": "2023-10-28T11:00:00"
  }
}
```
- **字段说明:**
  - `data`:
    - `offlineDocId` (`string`): 被更新的离线文档ID。
    - `title`, `description`, `tags`: 更新后的字段。
    - `isSynced` (`boolean`): 更新后此字段会变为`false`，表示需要同步。
    - `updatedAt` (`string`): 更新时间。


---
### **6. 删除单个离线文档**

- **功能描述:** 从本地离线存储中删除单个文档。
- **请求地址:** `/documents/{offlineDocId}`
- **请求方法:** `DELETE`

#### **路径参数 (Path Parameters)**

| 参数名 | 类型 | 描述 |
|---|---|---|
| offlineDocId | string | **必需**。要删除的离线文档ID。 |

#### **响应体 (Response Body) - 成功 (200 OK)**

```json
{
  "success": true,
  "message": "离线文档删除成功"
}
```

---

### **7. 检查文档是否已离线**

- **功能描述:** 检查某个在线文档是否已经被下载到本地。
- **请求地址:** `/documents/{documentId}/status`
- **请求方法:** `GET`

#### **路径参数 (Path Parameters)**

| 参数名 | 类型 | 描述 |
|---|---|---|
| documentId | string | **必需**。在线文档的ID。 |

#### **响应体 (Response Body) - 成功 (200 OK)**

```json
{
  "success": true,
  "message": "文档已离线下载", // 或 "文档未离线下载"
  "data": {
    "documentId": "doc_id_1",
    "isOffline": true,
    "offlineDocId": "offline_doc_f2a4c1b9...",
    "downloadUrl": "/api/offline/documents/offline_doc_f2a4c1b9.../download",
    "isSynced": true,
    "offlineVersion": 2,
    "updatedAt": "2023-10-27T10:30:00",
    "createdAt": "2023-10-26T08:00:00"
  }
}
```
- **字段说明:**
  - `data`:
    - `documentId` (`string`): 查询的在线文档ID。
    - `isOffline` (`boolean`): 是否已离线。
    - ... （若`isOffline`为`true`）其他字段同 **获取离线文档列表** 中的文档对象。若为`false`，这些字段为`null`或默认值。

---

### **8. 下载单个文档到离线**

- **功能描述:** 为单个在线文档创建离线下载任务。
- **请求地址:** `/documents/{documentId}/download`
- **请求方法:** `POST`

#### **路径参数 (Path Parameters)**

| 参数名 | 类型 | 描述 |
|---|---|---|
| documentId | string | **必需**。要下载的在线文档ID。 |

#### **响应体 (Response Body) - 成功 (200 OK)**

```json
{
  "success": true,
  "message": "文档下载任务已开始",
  "data": {
    "offlineDocId": "offline_doc_e8e3d0d8...",
    "downloadId": "dl_a1b2c3d4...",
    "status": "pending",
    "progress": 0
  }
}
```
- **字段说明:**
  - `data`:
    - `offlineDocId` (`string`): 生成的离线文档ID。
    - `downloadId` (`string`): 本次下载任务的ID。
    - `status` (`string`): 任务初始状态（如: `pending`, `downloading`）。
    - `progress` (`integer`): 初始进度（通常为0）。

---

### **9. 获取离线下载任务状态**

- **功能描述:** 查询指定下载任务的当前状态和进度。
- **请求地址:** `/downloads/{downloadId}/status`
- **请求方法:** `GET`

#### **路径参数 (Path Parameters)**

| 参数名 | 类型 | 描述 |
|---|---|---|
| downloadId | string | **必需**。下载任务的ID。 |

#### **响应体 (Response Body) - 成功 (200 OK)**

```json
{
  "success": true,
  "message": "获取下载状态成功",
  "data": {
    "downloadId": "dl_a1b2c3d4...",
    "status": "downloading",
    "progress": 50,
    "speed": "1.2 MB/s",
    "eta": "15s",
    "documentId": "doc_id_1",
    "documentTitle": "文档标题",
    "fileSize": 20480,
    "downloadedSize": 10240,
    "startTime": "2023-10-28T12:00:00",
    "endTime": null,
    "error": null
  }
}
```
- **字段说明:**
  - `data`:
    - `downloadId` (`string`): 下载任务ID。
    - `status` (`string`): 当前状态 (`pending`, `downloading`, `completed`, `failed`, `cancelled`)。
    - `progress` (`integer`): 下载进度 (0-100)。
    - `speed` (`string`): 下载速度。
    - `eta` (`string`): 预计剩余时间。
    - `documentId` (`string`): 关联的文档ID。
    - `documentTitle` (`string`): 关联的文档标题。
    - `fileSize` (`long`): 文件总大小（字节）。
    - `downloadedSize` (`long`): 已下载大小（字节）。
    - `startTime` (`string`): 任务开始时间。
    - `endTime` (`string`): 任务结束时间（若已结束）。
    - `error` (`string`): 错误信息（若失败）。

---

### **10. 取消离线下载任务**

- **功能描述:** 取消一个正在进行或等待中的下载任务。
- **请求地址:** `/downloads/{downloadId}`
- **请求方法:** `DELETE`

#### **路径参数 (Path Parameters)**

| 参数名 | 类型 | 描述 |
|---|---|---|
| downloadId | string | **必需**。要取消的下载任务ID。 |

#### **响应体 (Response Body) - 成功 (200 OK)**

```json
{
  "success": true,
  "message": "下载任务已取消"
}
```
- **状态码说明:**
  - `400 Bad Request`: 如果任务已完成、失败或已取消，无法再次取消。

---

### **11. 获取离线设置**

- **功能描述:** 获取用户的离线功能相关设置。
- **请求地址:** `/settings`
- **请求方法:** `GET`

#### **响应体 (Response Body) - 成功 (200 OK)**

```json
{
  "success": true,
  "message": "获取离线设置成功",
  "data": {
    "offlineMode": false,
    "autoSync": true,
    "syncInterval": 5,
    "storageLimit": 1024,
    "wifiOnly": true,
    "lastSyncTime": "2023-10-27T10:30:00",
    "updatedAt": "2023-10-27T09:00:00"
  }
}
```
- **字段说明:**
  - `data`:
    - `offlineMode` (`boolean`): 是否启用离线模式。
    - `autoSync` (`boolean`): 是否自动同步。
    - `syncInterval` (`integer`): 自动同步间隔（分钟）。
    - `storageLimit` (`integer`): 离线存储空间上限（MB）。
    - `wifiOnly` (`boolean`): 是否仅在Wi-Fi下同步。
    - `lastSyncTime` (`string`): 上次同步时间。
    - `updatedAt` (`string`): 设置最后更新时间。

---

### **12. 更新离线设置**

- **功能描述:** 更新用户的离线功能相关设置。
- **请求地址:** `/settings`
- **请求方法:** `PUT`

#### **请求体 (Request Body)**

```json
{
  "offlineMode": false,
  "autoSync": false,
  "syncInterval": 15,
  "storageLimit": 2048,
  "wifiOnly": false
}
```
- **字段说明:**
  - 所有字段均为 **必需**。前端应提交完整的设置对象。

#### **响应体 (Response Body) - 成功 (200 OK)**

```json
{
  "success": true,
  "message": "离线设置更新成功",
  "data": {
    "offlineMode": false,
    "autoSync": false,
    "syncInterval": 15,
    "storageLimit": 2048,
    "wifiOnly": false,
    "updatedAt": "2023-10-28T14:00:00"
  }
}
```
- **字段说明:**
  - `data`: 更新后的设置对象，字段同 **获取离线设置**。

---

### **13. 清理离线缓存**

- **功能描述:** 删除当前用户所有的离线文档和下载记录。
- **请求地址:** `/cache`
- **请求方法:** `DELETE`

#### **响应体 (Response Body) - 成功 (200 OK)**

```json
{
  "success": true,
  "message": "离线缓存清理成功，释放了 50.50 MB 空间",
  "data": {
    "deletedDocuments": 10,
    "deletedDownloads": 12,
    "freedSpace": 52953088
  }
}
```
- **字段说明:**
  - `data`:
    - `deletedDocuments` (`integer`): 删除的离线文档数量。
    - `deletedDownloads` (`integer`): 删除的下载记录数量。
    - `freedSpace` (`long`): 释放的空间大小（字节）。


---

### **14. 设置离线存储上限**

- **功能描述:** 单独设置离线存储空间的大小限制。
- **请求地址:** `/storage-limit`
- **请求方法:** `PUT`

#### **请求体 (Request Body)**

```json
{
  "limit_mb": 2048
}
```
- **字段说明:**
  - `limit_mb` (`integer`): **必需**。存储上限，单位为MB。有效范围1-10240。

#### **响应体 (Response Body) - 成功 (200 OK)**
```json
{
  "success": true,
  "message": "离线存储限制已设置为 2048 MB",
  "data": {
    "limit_mb": 2048,
    "updatedAt": "2023-10-28T14:15:00"
  }
}
```

---

### **15. 获取离线存储统计**

- **功能描述:** 获取离线数据的存储使用情况统计。
- **请求地址:** `/stats`
- **请求方法:** `GET`

#### **响应体 (Response Body) - 成功 (200 OK)**

```json
{
  "success": true,
  "message": "获取离线存储统计成功",
  "data": {
    "totalSize": 15728640,
    "documentCount": 5,
    "vocabularyCount": 100,
    "reviewCount": 250,
    "noteCount": 20,
    "highlightCount": 50,
    "byType": {
      "documents": 10485760,
      "vocabulary": 102400,
      "reviews": 128000,
      "notes": 40960,
      "highlights": 12800
    },
    "byStatus": {
      "synced": 4,
      "pending": 1,
      "failed": 0
    }
  }
}
```
- **字段说明:**
  - `data`:
    - `totalSize` (`long`): 总占用空间（字节）。
    - `documentCount`, `vocabularyCount`...: 各类型数据总数。
    - `byType` (`object`): 按数据类型划分的占用空间（字节）。
    - `byStatus` (`object`): 按同步状态划分的项目数。

---

### **16. 开始同步任务**

- **功能描述:** 手动触发一个同步任务（例如，同步所有本地更改到云端）。
- **请求地址:** `/sync/task`
- **请求方法:** `POST`

#### **请求体 (Request Body)**

```json
{
  "taskType": "upload_all"
}
```
- **字段说明:**
  - `taskType` (`string`): **必需**。任务类型，例如 `upload_all`（上传所有本地变更）、`download_all`（下载所有云端变更）等。

#### **响应体 (Response Body) - 成功 (200 OK)**

```json
{
  "success": true,
  "message": "同步任务已开始",
  "data": {
    "taskId": "sync_task_d1c2b3a4...",
    "taskType": "upload_all",
    "status": "running",
    "startTime": "2023-10-28T15:00:00"
  }
}
```
- **状态码说明:**
  - `400 Bad Request`: 如果已有正在进行的同步任务。

---

### **17. 取消同步任务**

- **功能描述:** 取消一个正在进行的同步任务。
- **请求地址:** `/sync/task/{taskId}`
- **请求方法:** `DELETE`

#### **路径参数 (Path Parameters)**

| 参数名 | 类型 | 描述 |
|---|---|---|
| taskId | string | **必需**。要取消的同步任务ID。 |

#### **响应体 (Response Body) - 成功 (200 OK)**

```json
{
  "success": true,
  "message": "同步任务已取消"
}
```
- **状态码说明:**
  - `400 Bad Request`: 如果任务已结束（完成、失败、已取消），无法再次取消。

---

### **18. 获取同步状态**

- **功能描述:** 获取当前的整体同步状态。
- **请求地址:** `/sync/status`
- **请求方法:** `GET`

#### **查询参数 (Query Parameters)**

| 参数名 | 类型 | 是否必选 | 默认值 | 描述 |
|---|---|---|---|---|
| type | string | 否 | all | 要查询状态的数据类型（如: `documents`, `notes`, `all`）。 |
| status | string | 否 | pending | 要查询状态的类型（如: `pending`, `failed`）。 |


#### **响应体 (Response Body) - 成功 (200 OK)**

```json
{
  "success": true,
  "message": "获取同步状态成功",
  "data": {
    "isSyncing": false,
    "lastSyncTime": "2023-10-28T15:05:00",
    "syncProgress": 100,
    "syncError": null,
    "pendingOperations": 0,
    "syncSpeed": "0 KB/s",
    "syncedItems": 10,
    "failedItems": 0
  }
}
```
- **字段说明:**
  - `data`:
    - `isSyncing` (`boolean`): 当前是否有任务正在运行。
    - `lastSyncTime` (`string`): 上次成功同步时间。
    - `syncProgress` (`integer`): 最近一次/当前任务的进度。
    - `syncError` (`string`): 错误信息。
    - `pendingOperations` (`integer`): 待同步的操作数量。
    - `syncSpeed` (`string`): 同步速度。
    - `syncedItems` (`integer`): 已同步项目数。
    - `failedItems` (`integer`): 同步失败项目数。

---

### **19. 获取同步历史**

- **功能描述:** 分页获取同步任务的历史记录。
- **请求地址:** `/sync/history`
- **请求方法:** `GET`

#### **查询参数 (Query Parameters)**

| 参数名 | 类型 | 是否必选 | 默认值 | 描述 |
|---|---|---|---|---|
| page | integer | 否 | 1 | 当前页码。 |
| pageSize | integer | 否 | 20 | 每页数量。 |
| startDate | string | 否 | | 筛选开始日期（格式: `YYYY-MM-DD`）。 |
| endDate | string | 否 | | 筛选结束日期（格式: `YYYY-MM-DD`）。 |
| type | string | 否 | all | 筛选任务类型。 |
| status | string | 否 | | 筛选任务状态 (`completed`, `failed`, `cancelled`)。 |

#### **响应体 (Response Body) - 成功 (200 OK)**

```json
{
  "success": true,
  "message": "获取同步历史成功",
  "data": {
    "total": 1,
    "page": 1,
    "pageSize": 20,
    "totalPages": 1,
    "items": [
      {
        "syncHistId": "sync_hist_12345",
        "taskId": "sync_task_d1c2b3a4...",
        "taskType": "upload_all",
        "status": "completed",
        "syncedItems": 10,
        "failedItems": 0,
        "duration": 300.5,
        "error": null,
        "startTime": "2023-10-28T15:00:00",
        "endTime": "2023-10-28T15:05:00",
        "createdAt": "2023-10-28T15:05:01"
      }
    ]
  }
}
```

---

### **20. 同步数据接口 (通用模式)**

以下接口（`document`, `note`, `highlight`, `review`, `vocabulary`）遵循相似的模式，用于将单个本地数据项的变更同步到云端。

- **功能描述:** 同步单个数据项。
- **请求地址:**
  - `/sync/document`
  - `/sync/note`
  - `/sync/highlight`
  - `/sync/review`
  - `/sync/vocabulary`
- **请求方法:** `POST`

#### **请求体 (Request Body) - 以`document`为例**

```json
{
  "document": {
    "id": "doc_id_1",
    "title": "在本地修改后的标题",
    "content": "在本地修改后的内容",
    "updatedAt": "2023-10-28T16:00:00",
    "offlineVersion": 3
  }
}
```
- **字段说明 (通用):**
  - `<item>`: 请求体的主键，如 `document`, `note` 等。
    - `id` (`string`): **必需**。数据项的唯一ID。
    - `...`: 数据项的其他字段，如 `title`, `content`。
    - `updatedAt` / `createdAt` / `reviewTime` (`string`): 本地记录的修改/创建时间。
    - `offlineVersion` (`integer`): **必需**。本地记录的版本号，用于冲突解决。

#### **响应体 (Response Body) - 以`document`为例**

```json
{
  "success": true,
  "message": "文档同步成功",
  "data": {
    "documentId": "doc_id_1",
    "synced": true,
    "syncedAt": "刚刚同步",
    "offlineVersion": 3
  }
}
```
- **字段说明 (通用):**
  - `data`:
    - `<item>Id` (`string`): 同步的数据项ID。
    - `synced` (`boolean`): 是否同步成功。
    - `syncedAt` (`string`): 同步时间描述。
    - `offlineVersion` (`integer`): 同步后确认的版本号。
    好的，我已经仔细分析了您提供的所有 Java 文件，并根据其中的 `@RestController`、`@RequestMapping`、`@PathVariable`、`@RequestParam`、`@RequestBody` 等注解以及 DTO（Data Transfer Object）定义，为您整理了一份详尽的 API 接口文档。

该文档专为前端开发人员设计，结构清晰，包含了每个接口的详细信息。

---

## **阅读 App - 生词本 API 文档**

### **目录**

1.  **通用说明**
    *   [基础 URL](#基础-url)
    *   [认证方式](#认证方式)
    *   [通用响应格式](#通用响应格式)
2.  **生词本管理 (`/api/v1/vocabulary`)**
    *   [1. 添加生词到生词本](#1-添加生词到生词本)
    *   [2. 获取生词本列表](#2-获取生词本列表)
    *   [3. 搜索生词本](#3-搜索生词本)
    *   [4. 获取单个生词详情](#4-获取单个生词详情)
    *   [5. 更新单个生词信息](#5-更新单个生词信息)
    *   [6. 删除单个生词](#6-删除单个生词)
    *   [7. 标记单词为已掌握](#7-标记单词为已掌握)
    *   [8. 重置单词学习状态](#8-重置单词学习状态)
    *   [9. 批量操作生词](#9-批量操作生词)
    *   [10. 批量更新生词](#10-批量更新生词)
    *   [11. 导出生词本](#11-导出生词本)
    *   [12. 导入生词本](#12-导入生词本)
3.  **统计信息 (`/api/v1/vocabulary`)**
    *   [13. 获取生词统计概览](#13-获取生词统计概览)
    *   [14. 获取学习统计详情](#14-获取学习统计详情)
    *   [15. 获取复习统计](#15-获取复习统计)
4.  **公共词典 (`/api/v1/words`)**
    *   [16. 查询单个单词释义](#16-查询单个单词释义)
    *   [17. 批量查询单词释义](#17-批量查询单词释义)
    *   [18. 获取相似单词](#18-获取相似单词)
    *   [19. 获取单词例句](#19-获取单词例句)

---

### **通用说明**

#### **基础 URL**

所有接口的基础 URL 为： `[你的服务器地址]`

#### **认证方式**

大部分需要用户权限的接口都采用 `Bearer Token` 认证。前端需要在请求头（Request Headers）中加入 `Authorization` 字段。

| 参数名        | 类型   | 描述                         |
| ------------- | ------ | ---------------------------- |
| `Authorization` | `string` | 用户认证 Token，格式为 `Bearer [token]` |

#### **通用响应格式**

所有接口都遵循统一的 JSON 响应格式：

```json
{
  "success": true,
  "message": "操作成功的提示信息",
  "data": {
    // 具体的响应数据
  }
}
```

*   **失败时 `data` 字段通常为 `null`**

```json
{
  "success": false,
  "message": "操作失败的错误信息",
  "data": null
}
```

---

### **生词本管理 (`/api/v1/vocabulary`)**

#### **1. 添加生词到生词本**

**功能描述:** 将一个新单词添加到当前用户的生词本中。

*   **请求地址:** `/api/v1/vocabulary`
*   **请求方法:** `POST`
*   **请求头 (Request Headers):**
    | 参数名        | 类型   | 是否必填 | 描述                                  |
    | ------------- | ------ | -------- | ------------------------------------- |
    | `Authorization` | `string` | 是       | 用户认证 Token，格式为 `Bearer [token]` |
*   **请求体 (Request Body):** `application/json`
    *   **字段说明:**
        | 字段名     | 类型           | 是否必填 | 描述                                       |
        | ---------- | -------------- | -------- | ------------------------------------------ |
        | `word`     | `string`       | 是       | 单词本身                                   |
        | `definition` | `string`       | 否       | 单词的释义                                 |
        | `example`  | `string`       | 否       | 例句                                       |
        | `tags`     | `Array<string>` | 否       | 标签列表，例如 `["核心词汇", "阅读"]`        |
        | `language` | `string`       | 否       | 语言，默认为 `en`                          |
        | `source`   | `string`       | 否       | 来源，例如书籍名称 `The Great Gatsby`      |
        | `sourcePage` | `integer`      | 否       | 在来源中的页码                             |
        | `notes`    | `string`       | 否       | 笔记或备注                                 |
*   **响应数据 (Response Body):**
    *   **成功 (201 Created):** `data` 字段为新创建的生词对象。
        | 字段名         | 类型           | 描述                                     |
        | -------------- | -------------- | ---------------------------------------- |
        | `id`           | `long`         | 生词在用户生词本中的唯一 ID (`user_vocab_id`) |
        | `word`         | `string`       | 单词                                     |
        | `language`     | `string`       | 语言                                     |
        | `definition`   | `string`       | 释义                                     |
        | `example`      | `string`       | 例句                                     |
        | `tags`         | `Array<string>` | 标签列表                                 |
        | `notes`        | `string`       | 笔记                                     |
        | `status`       | `string`       | 学习状态 (`new`, `learning`, `mastered`) |
        | `masteryLevel` | `integer`      | 掌握程度 (0-5)                           |
        | `reviewCount`  | `integer`      | 复习次数                                 |
        | `lastReviewedAt` | `string`       | 上次复习时间 (ISO 8601 格式)             |
        | `nextReviewAt` | `string`       | 下次复习时间 (ISO 8601 格式)             |
        | `source`       | `string`       | 来源                                     |
        | `sourcePage`   | `integer`      | 来源页码                                 |
        | `createdAt`    | `string`       | 创建时间 (ISO 8601 格式)                 |
        | `updatedAt`    | `string`       | 更新时间 (ISO 8601 格式)                 |
*   **状态码说明:**
    | Code                      | Description                  |
    | ------------------------- | ---------------------------- |
    | `201 Created`             | 添加成功                     |
    | `400 Bad Request`         | 请求参数错误（如单词为空）   |
    | `401 Unauthorized`        | 未登录或登录过期             |
    | `409 Conflict`            | 单词已存在于生词本中         |
    | `500 Internal Server Error` | 服务器内部错误               |
*   **示例:**
    *   **请求示例 (cURL):**
        ```bash
        curl -X POST 'http://localhost:8080/api/v1/vocabulary' \
        -H 'Authorization: Bearer YOUR_TOKEN' \
        -H 'Content-Type: application/json' \
        -d '{
            "word": "ubiquitous",
            "definition": "present, appearing, or found everywhere.",
            "example": "His ubiquitous influence was felt by all the family.",
            "tags": ["GRE", "C1"],
            "language": "en"
        }'
        ```
    *   **响应示例 (201 Created):**
        ```json
        {
            "success": true,
            "message": "单词已成功添加到生词本",
            "data": {
                "id": 101,
                "word": "ubiquitous",
                "language": "en",
                "definition": "present, appearing, or found everywhere.",
                "example": "His ubiquitous influence was felt by all the family.",
                "tags": ["GRE", "C1"],
                "notes": null,
                "status": "new",
                "masteryLevel": 0,
                "reviewCount": 0,
                "lastReviewedAt": null,
                "nextReviewAt": null,
                "source": null,
                "sourcePage": null,
                "createdAt": "2023-10-27T10:30:00.123456",
                "updatedAt": "2023-10-27T10:30:00.123456"
            }
        }
        ```

---

#### **2. 获取生词本列表**

**功能描述:** 分页、筛选、排序获取当前用户的生词列表。

*   **请求地址:** `/api/v1/vocabulary`
*   **请求方法:** `GET`
*   **请求头 (Request Headers):**
    | 参数名        | 类型   | 是否必填 | 描述                                  |
    | ------------- | ------ | -------- | ------------------------------------- |
    | `Authorization` | `string` | 是       | 用户认证 Token，格式为 `Bearer [token]` |
*   **查询参数 (Query Parameters):**
    | 参数名    | 类型           | 是否必填 | 默认值       | 描述                                                         |
    | --------- | -------------- | -------- | ------------ | ------------------------------------------------------------ |
    | `page`    | `integer`      | 否       | `1`          | 页码，从 1 开始                                              |
    | `pageSize` | `integer`      | 否       | `50`         | 每页数量，范围 1-200                                         |
    | `status`  | `string`       | 否       |              | 按学习状态筛选 (`new`, `learning`, `mastered`)               |
    | `tags`    | `Array<string>` | 否       |              | 按标签筛选 (例如 `tags=GRE&tags=IELTS`)                      |
    | `language` | `string`       | 否       |              | 按语言筛选                                                   |
    | `sortBy`  | `string`       | 否       | `created_at` | 排序字段 (`created_at`, `updated_at`, `word`, `status`, `mastery_level`) |
    | `sortOrder` | `string`       | 否       | `desc`       | 排序顺序 (`asc`, `desc`)                                     |
    | `search`  | `string`       | 否       |              | 模糊搜索关键字 (匹配 `word`, `definition`, `notes`)          |
*   **响应数据 (Response Body):**
    *   **成功 (200 OK):**
        | 字段名           | 类型                    | 描述         |
        | ---------------- | ----------------------- | ------------ |
        | `items`          | `Array<VocabularyItem>` | 生词列表     |
        | `pagination`     | `object`                | 分页信息     |
        | `pagination.page` | `integer`               | 当前页码     |
        | `pagination.pageSize` | `integer`               | 每页数量     |
        | `pagination.total` | `long`                  | 总记录数     |
        | `pagination.totalPages` | `integer`               | 总页数       |
        *`VocabularyItem` 结构同 [添加生词](#1-添加生词到生词本) 的响应 `data`*
*   **状态码说明:**
    | Code                      | Description    |
    | ------------------------- | -------------- |
    | `200 OK`                  | 获取成功       |
    | `401 Unauthorized`        | 未登录或登录过期 |
    | `500 Internal Server Error` | 服务器内部错误 |
*   **示例:**
    *   **请求示例 (cURL):**
        ```bash
        curl -X GET 'http://localhost:8080/api/v1/vocabulary?page=1&pageSize=2&status=learning' \
        -H 'Authorization: Bearer YOUR_TOKEN'
        ```
    *   **响应示例 (200 OK):**
        ```json
        {
            "success": true,
            "message": "获取生词本列表成功",
            "data": {
                "items": [
                    { "id": 101, "word": "ubiquitous", "status": "learning", "masteryLevel": 2, "...": "..." },
                    { "id": 98, "word": "ephemeral", "status": "learning", "masteryLevel": 1, "...": "..." }
                ],
                "pagination": {
                    "page": 1,
                    "pageSize": 2,
                    "total": 25,
                    "totalPages": 13
                }
            }
        }
        ```

---

#### **3. 搜索生词本**

**功能描述:** 功能与 `获取生词本列表` 高度相似，专用于搜索场景。

*   **请求地址:** `/api/v1/vocabulary/search`
*   **请求方法:** `GET`
*   **请求头 (Request Headers):**
    *   同 [获取生词本列表](#2-获取生词本列表)
*   **查询参数 (Query Parameters):**
    | 参数名    | 类型           | 是否必填 | 默认值       | 描述                                                                          |
    | --------- | -------------- | -------- | ------------ | ----------------------------------------------------------------------------- |
    | `query`   | `string`       | 否       |              | 模糊搜索关键字 (匹配 `word`, `definition`, `notes`)                           |
    | `page`    | `integer`      | 否       | `1`          | 页码                                                                          |
    | `pageSize` | `integer`      | 否       | `50`         | 每页数量                                                                      |
    | `status`  | `string`       | 否       |              | 按状态筛选                                                                    |
    | `language` | `string`       | 否       |              | 按语言筛选                                                                    |
    | `tags`    | `Array<string>` | 否       |              | 按标签筛选                                                                    |
    | `sortBy`  | `string`       | 否       | `created_at` | 排序字段 (`created_at`, `updated_at`, `word`, `status`, `mastery_level`, `review_count`) |
    | `sortOrder` | `string`       | 否       | `desc`       | 排序顺序                                                                      |
*   **响应数据 (Response Body):**
    *   **成功 (200 OK):**
        | 字段名   | 类型                    | 描述         |
        | -------- | ----------------------- | ------------ |
        | `items`  | `Array<VocabularyItem>` | 生词列表     |
        | `total`  | `integer`               | 总记录数     |
        | `page`   | `integer`               | 当前页码     |
        | `pageSize` | `integer`               | 每页数量     |
        | `totalPages` | `integer`               | 总页数       |
        *`VocabularyItem` 结构同 [添加生词](#1-添加生词到生词本) 的响应 `data`*
*   **状态码说明:**
    | Code                      | Description    |
    | ------------------------- | -------------- |
    | `200 OK`                  | 搜索成功       |
    | `401 Unauthorized`        | 未登录或登录过期 |
    | `500 Internal Server Error` | 服务器内部错误 |

---


#### **4. 获取单个生词详情**

**功能描述:** 获取生词本中一个单词的完整信息，包括用户学习数据和词典详细数据。

*   **请求地址:** `/api/v1/vocabulary/{userVocabId}`
*   **请求方法:** `GET`
*   **请求头 (Request Headers):**
    *   同 [获取生词本列表](#2-获取生词本列表)
*   **路径参数 (Path Parameters):**
    | 参数名         | 类型   | 描述                                  |
    | -------------- | ------ | ------------------------------------- |
    | `userVocabId`  | `long` | 生词在用户生词本中的唯一 ID           |
*   **响应数据 (Response Body):**
    *   **成功 (200 OK):** `data` 字段的结构扩展了 `VocabularyItemData`
        | 字段名           | 类型                     | 描述                                                              |
        | ---------------- | ------------------------ | ----------------------------------------------------------------- |
        | `id`, `word`, ... | `...`                    | 同 [添加生词](#1-添加生词到生词本) 响应中的字段                   |
        | `wordDetail`     | `object`                 | 从公共词典获取的详细信息，如果词典中不存在该词，则此字段为 `null` |
        | `wordDetail.phonetic` | `string`                 | 音标                                                              |
        | `wordDetail.definitions` | `Array<string>`          | 词典释义列表                                                      |
        | `wordDetail.examples` | `Array<string>`          | 词典例句列表                                                      |
        | `wordDetail.synonyms` | `Array<string>`          | 同义词列表                                                        |
        | `wordDetail.antonyms` | `Array<string>`          | 反义词列表                                                        |
        | `wordDetail.partOfSpeech` | `string`                 | 词性 (e.g., "noun", "verb")                                   |
        | `wordDetail.frequency` | `integer`                | 词频                                                              |
        | `wordDetail.difficulty` | `string`                 | 难度 (e.g., "B1", "C2")                                       |
        | `wordDetail.audioUrl` | `string`                 | 发音音频 URL                                                      |
*   **状态码说明:**
    | Code                      | Description            |
    | ------------------------- | ---------------------- |
    | `200 OK`                  | 获取成功               |
    | `401 Unauthorized`        | 未登录或登录过期         |
    | `404 Not Found`           | 生词不存在或无权访问     |
    | `500 Internal Server Error` | 服务器内部错误         |

---

#### **5. 更新单个生词信息**

**功能描述:** 更新生词本中一个单词的自定义信息，如释义、笔记、标签等。

*   **请求地址:** `/api/v1/vocabulary/{userVocabId}`
*   **请求方法:** `PUT`
*   **请求头 (Request Headers):**
    *   同 [获取生词本列表](#2-获取生词本列表)
*   **路径参数 (Path Parameters):**
    | 参数名         | 类型   | 描述                        |
    | -------------- | ------ | --------------------------- |
    | `userVocabId`  | `long` | 要更新的生词 ID             |
*   **请求体 (Request Body):** `application/json` (所有字段均为可选)
    | 字段名         | 类型           | 描述                                   |
    | -------------- | -------------- | -------------------------------------- |
    | `status`       | `string`       | 新的学习状态                           |
    | `masteryLevel` | `integer`      | 新的掌握程度                           |
    | `tags`         | `Array<string>` | **完整的**新标签列表（会覆盖旧标签） |
    | `notes`        | `string`       | 新的笔记                               |
    | `definition`   | `string`       | 新的自定义释义                         |
    | `example`      | `string`       | 新的自定义例句                         |
*   **响应数据 (Response Body):**
    *   **成功 (200 OK):** 返回更新后的完整生词对象，结构同 [添加生词](#1-添加生词到生词本) 的响应 `data`。
*   **状态码说明:**
    | Code                      | Description            |
    | ------------------------- | ---------------------- |
    | `200 OK`                  | 更新成功               |
    | `400 Bad Request`         | 未提供任何更新数据     |
    | `401 Unauthorized`        | 未登录或登录过期         |
    | `404 Not Found`           | 生词不存在或无权更新     |
    | `500 Internal Server Error` | 服务器内部错误         |
*   **示例:**
    *   **请求示例 (cURL):**
        ```bash
        curl -X PUT 'http://localhost:8080/api/v1/vocabulary/101' \
        -H 'Authorization: Bearer YOUR_TOKEN' \
        -H 'Content-Type: application/json' \
        -d '{
            "notes": "注意与\'ephemeral\'的区别",
            "tags": ["GRE", "C1", "易混淆"],
            "masteryLevel": 3
        }'
        ```

---

#### **6. 删除单个生词**

**功能描述:** 从生词本中永久删除一个单词。

*   **请求地址:** `/api/v1/vocabulary/{userVocabId}`
*   **请求方法:** `DELETE`
*   **请求头 (Request Headers):**
    *   同 [获取生词本列表](#2-获取生词本列表)
*   **路径参数 (Path Parameters):**
    | 参数名         | 类型   | 描述              |
    | -------------- | ------ | ----------------- |
    | `userVocabId`  | `long` | 要删除的生词 ID   |
*   **响应数据 (Response Body):**
    *   **成功 (200 OK):**
        | 字段名       | 类型     | 描述                       |
        | ------------ | -------- | -------------------------- |
        | `deletedId`  | `long`   | 已删除的生词 ID            |
        | `word`       | `string` | 已删除的单词               |
        | `deletedAt`  | `string` | 删除时间 (ISO 8601 格式)   |
*   **状态码说明:**
    | Code                      | Description            |
    | ------------------------- | ---------------------- |
    | `200 OK`                  | 删除成功               |
    | `401 Unauthorized`        | 未登录或登录过期         |
    | `404 Not Found`           | 生词不存在或无权删除     |
    | `500 Internal Server Error` | 服务器内部错误         |

---

#### **7. 标记单词为已掌握**

**功能描述:** 快速将一个单词的状态设置为 `mastered`，掌握程度设为 `5`。

*   **请求地址:** `/api/v1/vocabulary/{userVocabId}/mastered`
*   **请求方法:** `PUT`
*   **请求头 (Request Headers):**
    *   同 [获取生词本列表](#2-获取生词本列表)
*   **路径参数 (Path Parameters):**
    | 参数名         | 类型   | 描述                        |
    | -------------- | ------ | --------------------------- |
    | `userVocabId`  | `long` | 要标记的生词 ID             |
*   **响应数据 (Response Body):**
    *   **成功 (200 OK):** 返回更新后的部分生词信息。
        | 字段名         | 类型     | 描述                         |
        | -------------- | -------- | ---------------------------- |
        | `id`, `word`, `language` | `...`    | 基本信息                     |
        | `status`       | `string` | 新状态，应为 `mastered`        |
        | `masteryLevel` | `integer`| 新掌握程度，应为 `5`         |
        | `...`          | `...`    | 其他更新后的字段 (`updatedAt`等) |
*   **状态码说明:**
    | Code                      | Description            |
    | ------------------------- | ---------------------- |
    | `200 OK`                  | 标记成功               |
    | `401 Unauthorized`        | 未登录或登录过期         |
    | `404 Not Found`           | 生词不存在或无权操作     |
    | `500 Internal Server Error` | 服务器内部错误         |

---

#### **8. 重置单词学习状态**

**功能描述:** 将一个单词的学习进度重置，状态恢复为 `new`，掌握程度和复习次数清零。

*   **请求地址:** `/api/v1/vocabulary/{userVocabId}/reset`
*   **请求方法:** `PUT`
*   **请求头 (Request Headers):**
    *   同 [获取生词本列表](#2-获取生词本列表)
*   **路径参数 (Path Parameters):**
    | 参数名         | 类型   | 描述              |
    | -------------- | ------ | ----------------- |
    | `userVocabId`  | `long` | 要重置的生词 ID   |
*   **响应数据 (Response Body):**
    *   **成功 (200 OK):** 返回更新后的部分生词信息。
        | 字段名         | 类型     | 描述                         |
        | -------------- | -------- | ---------------------------- |
        | `id`, `word`, `language` | `...`    | 基本信息                     |
        | `status`       | `string` | 新状态，应为 `new`           |
        | `masteryLevel` | `integer`| 新掌握程度，应为 `0`         |
        | `reviewCount`  | `integer`| 新复习次数，应为 `0`         |
        | `...`          | `...`    | 其他更新后的字段 (`updatedAt`等) |
*   **状态码说明:**
    | Code                      | Description            |
    | ------------------------- | ---------------------- |
    | `200 OK`                  | 重置成功               |
    | `401 Unauthorized`        | 未登录或登录过期         |
    | `404 Not Found`           | 生词不存在或无权操作     |
    | `500 Internal Server Error` | 服务器内部错误         |

---

#### **9. 批量操作生词**

**功能描述:** 对多个生词执行相同的操作，如批量删除、批量标记为已掌握等。

*   **请求地址:** `/api/v1/vocabulary/batch`
*   **请求方法:** `POST`
*   **请求头 (Request Headers):**
    *   同 [获取生词本列表](#2-获取生词本列表)
*   **请求体 (Request Body):** `application/json`
    | 字段名          | 类型           | 是否必填 | 描述                                                                          |
    | --------------- | -------------- | -------- | ----------------------------------------------------------------------------- |
    | `action`        | `string`       | 是       | 操作类型，支持 `delete`, `mark_as_mastered`, `reset_learning`, `update_status`  |
    | `user_vocab_ids` | `Array<long>`  | 是       | 要操作的生词 ID 列表                                                          |
    | `data`          | `object`       | 否       | 附加数据，仅在某些 `action` 下需要。例如 `action` 为 `update_status` 时，需要提供 `{"status": "new_status"}` |
*   **响应数据 (Response Body):**
    *   **成功 (200 OK):**
        | 字段名             | 类型                 | 描述                 |
        | ------------------ | -------------------- | -------------------- |
        | `processedCount`   | `integer`            | 处理的总数           |
        | `successCount`     | `integer`            | 成功的数量           |
        | `failedCount`      | `integer`            | 失败的数量           |
        | `failedItems`      | `Array<FailedItem>`  | 失败项列表           |
        | `failedItems[].id` | `long`               | 失败的生词 ID        |
        | `failedItems[].reason` | `string`             | 失败原因             |
*   **状态码说明:**
    | Code                      | Description                |
    | ------------------------- | -------------------------- |
    | `200 OK`                  | 操作完成（可能部分失败）   |
    | `400 Bad Request`         | 请求参数错误 (如 `action` 为空) |
    | `401 Unauthorized`        | 未登录或登录过期           |
    | `500 Internal Server Error` | 服务器内部错误             |
*   **示例:**
    *   **请求示例 (批量删除):**
        ```bash
        curl -X POST 'http://localhost:8080/api/v1/vocabulary/batch' \
        -H 'Authorization: Bearer YOUR_TOKEN' \
        -H 'Content-Type: application/json' \
        -d '{
            "action": "delete",
            "user_vocab_ids": [101, 102, 105]
        }'
        ```

---

#### **10. 批量更新生词**

**功能描述:** 批量更新多个生词，每个生词可以有不同的更新内容。

*   **请求地址:** `/api/v1/vocabulary/batch`
*   **请求方法:** `PUT`
*   **请求头 (Request Headers):**
    *   同 [获取生词本列表](#2-获取生词本列表)
*   **请求体 (Request Body):** `application/json`
    | 字段名   | 类型                           | 是否必填 | 描述                                                                                                       |
    | -------- | ------------------------------ | -------- | ---------------------------------------------------------------------------------------------------------- |
    | `items`  | `Array<BatchUpdateItem>`       | 是       | 更新项列表，最多 100 项                                                                                    |
    | `items[].id` | `long`                         | 是       | 要更新的生词 ID                                                                                            |
    | `items[].status` | `string`                       | 否       | 新的学习状态                                                                                               |
    | `items[].masteryLevel` | `integer`                      | 否       | 新的掌握程度                                                                                               |
    | `items[].tags` | `Array<string>`                | 否       | **完整的**新标签列表（会覆盖旧标签）                                                                     |
    | `items[].notes` | `string`                       | 否       | 新的笔记                                                                                                   |
*   **响应数据 (Response Body):**
    *   **成功 (200 OK):**
        | 字段名           | 类型                     | 描述               |
        | ---------------- | ------------------------ | ------------------ |
        | `totalCount`     | `integer`                | 处理的总数         |
        | `successCount`   | `integer`                | 成功的数量         |
        | `failedCount`    | `integer`                | 失败的数量         |
        | `results`        | `Array<UpdateResult>`    | 各项处理结果列表   |
        | `results[].id`   | `long`                   | 生词 ID            |
        | `results[].success` | `boolean`                | 是否成功           |
        | `results[].message` | `string`                 | 结果消息           |
*   **状态码说明:**
    | Code                      | Description              |
    | ------------------------- | ------------------------ |
    | `200 OK`                  | 操作完成（可能部分失败） |
    | `400 Bad Request`         | 请求参数错误             |
    | `401 Unauthorized`        | 未登录或登录过期         |
    | `500 Internal Server Error` | 服务器内部错误           |

---

#### **11. 导出生词本**

**功能描述:** 将符合条件的生词导出为指定格式的文件内容。

*   **请求地址:** `/api/v1/vocabulary/export`
*   **请求方法:** `GET`
*   **请求头 (Request Headers):**
    *   同 [获取生词本列表](#2-获取生词本列表)
*   **查询参数 (Query Parameters):**
    | 参数名    | 类型           | 是否必填 | 默认值 | 描述                                                                                                                  |
    | --------- | -------------- | -------- | ------ | --------------------------------------------------------------------------------------------------------------------- |
    | `format`  | `string`       | 否       | `csv`  | 导出格式 (`csv`, `json`, `txt`, `xlsx`)                                                                               |
    | `fields`  | `Array<string>` | 否       | (所有字段) | 指定要导出的字段列表                                                                                                    |
    | `status`  | `string`       | 否       |        | 按状态筛选                                                                                                            |
    | `language` | `string`       | 否       |        | 按语言筛选                                                                                                            |
    | `tags`    | `Array<string>` | 否       |        | 按标签筛选                                                                                                            |
*   **响应数据 (Response Body):**
    *   **成功 (200 OK):**
        | 字段名        | 类型           | 描述                                                                 |
        | ------------- | -------------- | -------------------------------------------------------------------- |
        | `format`      | `string`       | 导出格式                                                             |
        | `content`     | `string`       | 文件内容。对于 `xlsx` 等二进制格式，可能为提示信息或 Base64 字符串。 |
        | `fileName`    | `string`       | 建议的文件名                                                         |
        | `fileSize`    | `string`       | 文件大小（例如 `1.2 KB`, `2.3 MB`）                                    |
        | `downloadUrl` | `string`       | （模拟的）下载链接                                                   |
        | `expiresAt`   | `string`       | （模拟的）链接过期时间                                               |
        | `fields`      | `Array<string>` | 实际导出的字段列表                                                   |
*   **状态码说明:**
    | Code                      | Description      |
    | ------------------------- | ---------------- |
    | `200 OK`                  | 导出成功         |
    | `400 Bad Request`         | 不支持的导出格式 |
    | `401 Unauthorized`        | 未登录或登录过期 |
    | `500 Internal Server Error` | 服务器内部错误   |

---

#### **12. 导入生词本**

**功能描述:** 从上传的文件中批量导入生词。

*   **请求地址:** `/api/v1/vocabulary/import`
*   **请求方法:** `POST`
*   **请求体 (Request Body):** `multipart/form-data`
    | 参数名   | 类型     | 是否必填 | 描述                                       |
    | -------- | -------- | -------- | ------------------------------------------ |
    | `file`   | `File`   | 是       | 要导入的生词文件（CSV, JSON, TXT）         |
    | `format` | `string` | 否       | 文件格式，默认为 `csv`。如果提供，会强制以此格式解析。 |
*   **响应数据 (Response Body):**
    *   **成功 (200 OK):**
        | 字段名                 | 类型                 | 描述               |
        | ---------------------- | -------------------- | ------------------ |
        | `totalProcessed`       | `integer`            | 处理的总行数       |
        | `successfullyImported` | `integer`            | 成功导入的数量     |
        | `skipped`              | `integer`            | 因已存在而跳过的数量 |
        | `failed`               | `integer`            | 失败的数量         |
        | `errors`               | `Array<ImportError>` | 错误详情列表       |
        | `errors[].lineNumber`  | `integer`            | 文件中的行号       |
        | `errors[].word`        | `string`             | 出错的单词         |
        | `errors[].errorMessage` | `string`             | 错误信息           |
        | `importDate`           | `string`             | 导入时间           |
*   **状态码说明:**
    | Code                      | Description          |
    | ------------------------- | -------------------- |
    | `200 OK`                  | 导入操作完成         |
    | `400 Bad Request`         | 文件为空或格式不支持 |
    | `401 Unauthorized`        | 未登录或登录过期     |
    | `500 Internal Server Error` | 服务器内部错误       |

---

### **统计信息 (`/api/v1/vocabulary`)**

#### **13. 获取生词统计概览**

**功能描述:** 获取生词本的整体统计数据。

*   **请求地址:** `/api/v1/vocabulary/stats`
*   **请求方法:** `GET`
*   **请求头 (Request Headers):**
    *   同 [获取生词本列表](#2-获取生词本列表)
*   **响应数据 (Response Body):**
    *   **成功 (200 OK):**
        | 字段名            | 类型                    | 描述                               |
        | ----------------- | ----------------------- | ---------------------------------- |
        | `totalWords`      | `integer`               | 总单词数                           |
        | `masteredWords`   | `integer`               | 已掌握单词数                       |
        | `learningWords`   | `integer`               | 学习中单词数                       |
        | `newWords`        | `integer`               | 新单词数                           |
        | `todayAdded`      | `integer`               | 今日添加数                         |
        | `todayReviewed`   | `integer`               | 今日复习数                         |
        | `weeklyProgress`  | `integer`               | 近 7 日新增单词数                  |
        | `monthlyProgress` | `integer`               | 近 30 日新增单词数                 |
        | `byLanguage`      | `object`                | 按语言统计，`{"en": 100, "fr": 50}` |
        | `byStatus`        | `object`                | 按状态统计，`{"new": 20, "learning": 80}` |
        | `streakDays`      | `integer`               | 连续学习天数（基于添加记录）       |
        | `dailyStats`      | `Array<DailyStat>`      | 近 7 日每日统计                    |
*   **状态码说明:**
    | Code                      | Description    |
    | ------------------------- | -------------- |
    | `200 OK`                  | 获取成功       |
    | `401 Unauthorized`        | 未登录或登录过期 |
    | `500 Internal Server Error` | 服务器内部错误 |

---

#### **14. 获取学习统计详情**

**功能描述:** 获取更详细的学习统计数据，是 `获取生词统计概览` 的增强版。

*   **请求地址:** `/api/v1/vocabulary/learning-stats`
*   **请求方法:** `GET`
*   **请求头 (Request Headers):**
    *   同 [获取生词本列表](#2-获取生词本列表)
*   **查询参数 (Query Parameters):**
    | 参数名    | 类型   | 是否必填 | 默认值 | 描述                                |
    | --------- | ------ | -------- | ------ | ----------------------------------- |
    | `period`  | `string` | 否       | `week` | 时间范围 (`day`, `week`, `month`, `year`) |
    | `language` | `string` | 否       |        | 按特定语言筛选统计数据            |
*   **响应数据 (Response Body):**
    *   **成功 (200 OK):** 包含 `获取生词统计概览` 的所有字段，并增加了以下字段：
        | 字段名                  | 类型     | 描述                                                           |
        | ----------------------- | -------- | -------------------------------------------------------------- |
        | `masteryDistribution`   | `object` | 掌握程度分布，`{"level_0": 10, "level_1": 25, ...}`              |
        | `reviewFrequency`       | `object` | 复习频率分布，`{"reviewed_0_times": 10, "reviewed_1_times": 15}` |
*   **状态码说明:**
    | Code                      | Description    |
    | ------------------------- | -------------- |
    | `200 OK`                  | 获取成功       |
    | `401 Unauthorized`        | 未登录或登录过期 |
    | `500 Internal Server Error` | 服务器内部错误 |

---

#### **15. 获取复习统计**

**功能描述:** 获取与复习相关的统计数据。

*   **请求地址:** `/api/v1/vocabulary/review-stats`
*   **请求方法:** `GET`
*   **请求头 (Request Headers):**
    *   同 [获取生词本列表](#2-获取生词本列表)
*   **响应数据 (Response Body):**
    *   **成功 (200 OK):**
        | 字段名                   | 类型                      | 描述                                                                          |
        | ------------------------ | ------------------------- | ----------------------------------------------------------------------------- |
        | `dueToday`               | `integer`                 | 今日到期复习数                                                                |
        | `dueTomorrow`            | `integer`                 | 明日到期复习数                                                                |
        | `dueThisWeek`            | `integer`                 | 本周（未来7天）到期复习数                                                     |
        | `totalDue`               | `integer`                 | 所有待复习总数（所有未掌握的）                                                |
        | `reviewAccuracy`         | `double`                  | 复习准确率（基于 `review_items` 表，百分比）                                  |
        | `averageMastery`         | `double`                  | 所有单词的平均掌握程度                                                        |
        | `lastReviewDate`         | `string`                  | 最后一次复习日期                                                              |
        | `reviewHistory`          | `Array<ReviewHistoryItem>` | 近 7 日复习历史                                                               |
        | `dailyReviewTrend`       | `object`                  | 近 30 日每日复习数量趋势，`{"2023-10-01": 15, "2023-10-02": 20}`                 |
        | `reviewPerformance`      | `object`                  | 复习表现分析（例如按掌握程度分组的平均复习次数）                              |
*   **状态码说明:**
    | Code                      | Description    |
    | ------------------------- | -------------- |
    | `200 OK`                  | 获取成功       |
    | `401 Unauthorized`        | 未登录或登录过期 |
    | `500 Internal Server Error` | 服务器内部错误 |

---

### **公共词典 (`/api/v1/words`)**

**注意:** 此部分接口为公共查询接口，**不需要** `Authorization` 请求头。

#### **16. 查询单个单词释义**

**功能描述:** 从公共词典中查询一个单词的详细信息。

*   **请求地址:** `/api/v1/words/lookup`
*   **请求方法:** `GET`
*   **查询参数 (Query Parameters):**
    | 参数名    | 类型   | 是否必填 | 默认值 | 描述     |
    | --------- | ------ | -------- | ------ | -------- |
    | `word`    | `string` | 是       |        | 要查询的单词 |
    | `language` | `string` | 否       | `en`   | 单词的语言 |
*   **响应数据 (Response Body):**
    *   **成功 (200 OK):** `data` 字段的结构同 [获取单个生词详情](#4-获取单个生词详情) 中的 `wordDetail` 部分，并额外包含以下元数据：
        | 字段名               | 类型     | 描述                         |
        | -------------------- | -------- | ---------------------------- |
        | `metadata`           | `object` | 元数据                       |
        | `metadata.word_id`   | `long`   | 单词在词典中的 ID            |
        | `metadata.created_at` | `string` | 单词入库时间                 |
        | `...`                | `...`    | 其他统计信息（释义数量等）   |
*   **状态码说明:**
    | Code                      | Description    |
    | ------------------------- | -------------- |
    | `200 OK`                  | 查询成功       |
    | `400 Bad Request`         | `word` 参数为空 |
    | `404 Not Found`           | 词典中未找到该单词 |
    | `500 Internal Server Error` | 服务器内部错误 |

---

#### **17. 批量查询单词释义**

**功能描述:** 一次性从公共词典中查询多个单词的信息。

*   **请求地址:** `/api/v1/words/batch-lookup`
*   **请求方法:** `POST`
*   **请求体 (Request Body):** `application/json`
    | 字段名    | 类型           | 是否必填 | 描述                                |
    | --------- | -------------- | -------- | ----------------------------------- |
    | `words`   | `Array<string>` | 是       | 要查询的单词列表，最多 50 个        |
    | `language` | `string`       | 否       | 语言，默认为 `en`                   |
*   **响应数据 (Response Body):**
    *   **成功 (200 OK):** `data` 字段是一个数组，数组中每个对象是的结构同 [查询单个单词释义](#16-查询单个单词释义) 的 `data` 字段。如果某个单词未找到，对应的对象中 `source` 会是 `not_found`，且其他字段为空。
*   **状态码说明:**
    | Code                      | Description      |
    | ------------------------- | ---------------- |
    | `200 OK`                  | 查询成功         |
    | `400 Bad Request`         | 单词列表为空或超限 |
    | `500 Internal Server Error` | 服务器内部错误   |

---

#### **18. 获取相似单词**

**功能描述:** 获取一个单词的同义词或相关词。

*   **请求地址:** `/api/v1/words/similar`
*   **请求方法:** `GET`
*   **查询参数 (Query Parameters):**
    | 参数名    | 类型   | 是否必填 | 默认值 | 描述     |
    | --------- | ------ | -------- | ------ | -------- |
    | `word`    | `string` | 是       |        | 要查询的单词 |
    | `language` | `string` | 否       | `en`   | 单词的语言 |
*   **响应数据 (Response Body):**
    *   **成功 (200 OK):**
        | 字段名                   | 类型                 | 描述                 |
        | ------------------------ | -------------------- | -------------------- |
        | `word`                   | `string`             | 源单词               |
        | `language`               | `string`             | 源单词语言           |
        | `similarWords`           | `Array<SimilarWord>` | 相似单词列表         |
        | `similarWords[].word`    | `string`             | 相似单词             |
        | `similarWords[].language` | `string`             | 相似单词语言         |
        | `similarWords[].relationType` | `string`             | 关系类型 (`synonym`, `related`) |
        | `similarWords[].definition` | `string`             | 相似单词的简要释义   |
*   **状态码说明:**
    | Code                      | Description    |
    | ------------------------- | -------------- |
    | `200 OK`                  | 获取成功       |
    | `404 Not Found`           | 源单词未找到   |
    | `500 Internal Server Error` | 服务器内部错误 |

---

#### **19. 获取单词例句**

**功能描述:** 获取一个单词的更多例句。

*   **请求地址:** `/api/v1/words/examples`
*   **请求方法:** `GET`
*   **查询参数 (Query Parameters):**
    | 参数名    | 类型     | 是否必填 | 默认值 | 描述         |
    | --------- | -------- | -------- | ------ | ------------ |
    | `word`    | `string` | 是       |        | 要查询的单词 |
    | `language` | `string` | 否       | `en`   | 单词的语言   |
    | `limit`   | `integer`| 否       | `10`   | 返回例句数量 |
*   **响应数据 (Response Body):**
    *   **成功 (200 OK):**
        | 字段名                  | 类型               | 描述           |
        | ----------------------- | ------------------ | -------------- |
        | `word`                  | `string`           | 源单词         |
        | `language`              | `string`           | 源单词语言     |
        | `examples`              | `Array<Example>`   | 例句列表       |
        | `examples[].exampleId`  | `long`             | 例句 ID        |
        | `examples[].example`    | `string`           | 例句原文       |
        | `examples[].translation` | `string`           | 例句翻译       |
        | `examples[].source`     | `string`           | 例句来源       |
*   **状态码说明:**
    | Code                      | Description    |
    | ------------------------- | -------------- |
    | `200 OK`                  | 获取成功       |
    | `404 Not Found`           | 源单词未找到   |
    | `500 Internal Server Error` | 服务器内部错误 |
    好的，我将根据你提供的 Java 文件，为你整理出一份详细的接口文档，供前端开发使用。

---

## API 文档

### 1. 添加标签到文档

*   **请求地址:** `/api/v1/documents/{documentId}/tags/{tagId}`
*   **请求方法:** `POST`
*   **描述:** 为指定的文档添加一个标签。
*   **路径参数:**
    *   `documentId` (String, 必需): 文档的唯一标识符。
    *   `tagId` (String, 必需): 标签的唯一标识符。
*   **请求体:** 无
*   **响应格式:**
    *   **成功 (200 OK):**
        ```json
        {
          "success": true,
          "message": "标签添加成功"
        }
        ```
    *   **文档不存在 (404 Not Found):**
        ```json
        {
          "success": false,
          "message": "文档不存在"
        }
        ```
    *   **标签不存在 (404 Not Found):**
        ```json
        {
          "success": false,
          "message": "标签不存在"
        }
        ```
    *   **标签已存在 (409 Conflict):**
        ```json
        {
          "success": false,
          "message": "该标签已经添加到文档"
        }
        ```
    *   **ID 格式错误 (400 Bad Request):**
        ```json
        {
          "success": false,
          "message": "ID格式错误"
        }
        ```
    *   **服务器内部错误 (500 Internal Server Error):**
        ```json
        {
          "success": false,
          "message": "服务器内部错误: [错误信息]"
        }
        ```
*   **示例请求:**
    ```http
    POST /api/v1/documents/123/tags/456
    ```
*   **示例响应 (成功):**
    ```json
    {
      "success": true,
      "message": "标签添加成功"
    }
    ```

---

### 2. 批量操作文档标签

*   **请求地址:** `/api/v1/tags/document/batch`
*   **请求方法:** `POST`
*   **描述:** 对一组文档标签执行批量操作（如删除、更新）。
*   **请求体:**
    ```json
    {
      "tagIds": ["tagId1", "tagId2", ...], // 标签ID列表
      "operation": "delete" | "update", // 操作类型："delete" (删除), "update" (更新)
      "data": { // 当 operation 为 "update" 时，包含更新数据
        "name": "新标签名",
        "color": "#FFFFFF",
        "description": "标签描述"
      }
    }
    ```
*   **请求参数:**
    *   `tagIds` (List<String>, 必需): 要操作的标签 ID 列表。
    *   `operation` (String, 必需): 操作类型，支持 "delete" 和 "update"。
    *   `data` (Map<String, Object>, 可选): 当 `operation` 为 "update" 时，包含标签更新的字段。
*   **响应格式:**
    *   **成功 (200 OK):**
        ```json
        {
          "success": true,
          "message": "批量操作完成，成功处理 [processedCount] 个标签，失败 [failedCount] 个",
          "processedCount": 0, // 成功处理的数量
          "failedCount": 0 // 失败的数量
        }
        ```
    *   **请求参数错误 (400 Bad Request):**
        ```json
        {
          "success": false,
          "message": "[错误信息]", // 例如："标签ID列表不能为空" 或 "操作类型不能为空"
          "processedCount": 0,
          "failedCount": 0
        }
        ```
    *   **服务器内部错误 (500 Internal Server Error):**
        ```json
        {
          "success": false,
          "message": "服务器内部错误: [错误信息]",
          "processedCount": 0,
          "failedCount": 0
        }
        ```
*   **示例请求 (删除标签):**
    ```http
    POST /api/v1/tags/document/batch
    Content-Type: application/json

    {
      "tagIds": ["1", "2", "3"],
      "operation": "delete"
    }
    ```
*   **示例请求 (更新标签):**
    ```http
    POST /api/v1/tags/document/batch
    Content-Type: application/json

    {
      "tagIds": ["1", "2"],
      "operation": "update",
      "data": {
        "name": "更新后的标签名",
        "color": "#ABCDEF",
        "description": "这是一个更新的描述"
      }
    }
    ```
*   **示例响应 (成功):**
    ```json
    {
      "success": true,
      "message": "批量操作完成，成功处理 2 个标签，失败 1 个",
      "processedCount": 2,
      "failedCount": 1
    }
    ```

---

### 3. 批量更新文档标签

*   **请求地址:** `/api/v1/documents/tags/batch`
*   **请求方法:** `POST`
*   **描述:** 对多个文档批量添加、移除或替换标签。
*   **请求体:**
    ```json
    {
      "documentIds": ["docId1", "docId2", ...], // 文档ID列表
      "tagIds": ["tagId1", "tagId2", ...], // 标签ID列表
      "operation": "add" | "remove" | "replace" // 操作类型
    }
    ```
*   **请求参数:**
    *   `documentIds` (List<String>, 必需): 要操作的文档 ID 列表。
    *   `tagIds` (List<String>, 必需): 要操作的标签 ID 列表。
    *   `operation` (String, 可选, 默认 "replace"): 操作类型，支持 "add" (添加), "remove" (移除), "replace" (替换)。
*   **响应格式:**
    *   **成功 (200 OK):**
        ```json
        {
          "success": true,
          "message": "批量操作完成，成功更新 [updatedCount] 个文档标签关系",
          "updatedCount": 0 // 成功更新的数量
        }
        ```
    *   **请求参数错误 (400 Bad Request):**
        ```json
        {
          "success": false,
          "message": "[错误信息]", // 例如："文档ID列表不能为空"
          "updatedCount": 0
        }
        ```
    *   **不支持的操作类型 (400 Bad Request):**
        ```json
        {
          "success": false,
          "message": "不支持的操作类型: [operation]",
          "updatedCount": 0
        }
        ```
    *   **服务器内部错误 (500 Internal Server Error):**
        ```json
        {
          "success": false,
          "message": "服务器内部错误: [错误信息]",
          "updatedCount": 0
        }
        ```
*   **示例请求 (添加标签):**
    ```http
    POST /api/v1/documents/tags/batch
    Content-Type: application/json

    {
      "documentIds": ["101", "102"],
      "tagIds": ["7", "8"],
      "operation": "add"
    }
    ```
*   **示例请求 (移除标签):**
    ```http
    POST /api/v1/documents/tags/batch
    Content-Type: application/json

    {
      "documentIds": ["101"],
      "tagIds": ["7"],
      "operation": "remove"
    }
    ```
*   **示例请求 (替换标签 - 默认操作):**
    ```http
    POST /api/v1/documents/tags/batch
    Content-Type: application/json

    {
      "documentIds": ["101"],
      "tagIds": ["9", "10"]
    }
    ```
*   **示例响应 (成功):**
    ```json
    {
      "success": true,
      "message": "批量操作完成，成功更新 5 个文档标签关系",
      "updatedCount": 5
    }
    ```

---

### 4. 批量操作生词标签

*   **请求地址:** `/api/v1/tags/vocabulary/batch`
*   **请求方法:** `POST`
*   **描述:** 对一组生词标签执行批量操作（如删除、更新）。
*   **请求体:**
    ```json
    {
      "tagIds": ["tagId1", "tagId2", ...], // 标签ID列表
      "operation": "delete" | "update", // 操作类型："delete" (删除), "update" (更新)
      "data": { // 当 operation 为 "update" 时，包含更新数据
        "name": "新标签名",
        "color": "#FFFFFF",
        "description": "标签描述"
      }
    }
    ```
*   **请求参数:**
    *   `tagIds` (List<String>, 必需): 要操作的标签 ID 列表。
    *   `operation` (String, 必需): 操作类型，支持 "delete" 和 "update"。
    *   `data` (Map<String, Object>, 可选): 当 `operation` 为 "update" 时，包含标签更新的字段。
*   **响应格式:**
    *   **成功 (200 OK):**
        ```json
        {
          "success": true,
          "message": "批量操作完成，成功处理 [processedCount] 个标签，失败 [failedCount] 个",
          "processedCount": 0, // 成功处理的数量
          "failedCount": 0 // 失败的数量
        }
        ```
    *   **请求参数错误 (400 Bad Request):**
        ```json
        {
          "success": false,
          "message": "[错误信息]", // 例如："标签ID列表不能为空" 或 "操作类型不能为空"
          "processedCount": 0,
          "failedCount": 0
        }
        ```
    *   **服务器内部错误 (500 Internal Server Error):**
        ```json
        {
          "success": false,
          "message": "服务器内部错误: [错误信息]",
          "processedCount": 0,
          "failedCount": 0
        }
        ```
*   **示例请求 (删除标签):**
    ```http
    POST /api/v1/tags/vocabulary/batch
    Content-Type: application/json

    {
      "tagIds": ["10", "11"],
      "operation": "delete"
    }
    ```
*   **示例请求 (更新标签):**
    ```http
    POST /api/v1/tags/vocabulary/batch
    Content-Type: application/json

    {
      "tagIds": ["10"],
      "operation": "update",
      "data": {
        "name": "更新后的词汇标签名",
        "color": "#EEEEEE"
      }
    }
    ```
*   **示例响应 (成功):**
    ```json
    {
      "success": true,
      "message": "批量操作完成，成功处理 1 个标签，失败 1 个",
      "processedCount": 1,
      "failedCount": 1
    }
    ```

---

### 5. 创建标签

*   **请求地址:** `/api/v1/tags`
*   **请求方法:** `POST`
*   **描述:** 创建一个新的标签（可以是文档标签或词汇标签）。
*   **请求体:**
    ```json
    {
      "name": "新标签名", // 必需
      "color": "#RRGGBB", // 可选
      "description": "标签的描述", // 可选
      "type": "document" | "vocabulary" // 必需, "document" (文档标签) 或 "vocabulary" (词汇标签)
    }
    ```
*   **请求参数:**
    *   `name` (String, 必需): 标签的名称。
    *   `color` (String, 可选): 标签的颜色，格式为 hex。
    *   `description` (String, 可选): 标签的描述。
    *   `type` (String, 必需): 标签的类型，只能是 "document" 或 "vocabulary"。
*   **响应格式:**
    *   **成功 (200 OK):**
        ```json
        {
          "success": true,
          "data": {
            "id": "新标签ID",
            "name": "标签名",
            "color": "#RRGGBB",
            "description": "标签描述",
            "type": "document" | "vocabulary",
            "documentCount": 0, // 初始为0
            "createdAt": "YYYY-MM-DD HH:MM:SS.ffffff",
            "updatedAt": "YYYY-MM-DD HH:MM:SS.ffffff"
          }
        }
        ```
    *   **请求参数错误 (400 Bad Request):**
        ```json
        {
          "success": false,
          "data": null
        }
        ```
    *   **标签名已存在 (409 Conflict):**
        ```json
        {
          "success": false,
          "data": null
        }
        ```
    *   **服务器内部错误 (500 Internal Server Error):**
        ```json
        {
          "success": false,
          "data": null
        }
        ```
*   **示例请求:**
    ```http
    POST /api/v1/tags
    Content-Type: application/json

    {
      "name": "Spring Boot",
      "color": "#00FF00",
      "description": "与Spring Boot相关的文档",
      "type": "document"
    }
    ```
*   **示例响应 (成功):**
    ```json
    {
      "success": true,
      "data": {
        "id": "50",
        "name": "Spring Boot",
        "color": "#00FF00",
        "description": "与Spring Boot相关的文档",
        "type": "document",
        "documentCount": 0,
        "createdAt": "2024-01-10 10:30:00.0",
        "updatedAt": "2024-01-10 10:30:00.0"
      }
    }
    ```

---

### 6. 创建文档标签

*   **请求地址:** `/api/v1/tags/document`
*   **请求方法:** `POST`
*   **描述:** 创建一个新的文档标签。
*   **请求体:**
    ```json
    {
      "name": "新标签名", // 必需
      "color": "#RRGGBB", // 可选
      "description": "标签的描述" // 可选
    }
    ```
*   **请求参数:**
    *   `name` (String, 必需): 标签的名称。
    *   `color` (String, 可选): 标签的颜色，格式为 hex。
    *   `description` (String, 可选): 标签的描述。
*   **响应格式:**
    *   **成功 (200 OK):**
        ```json
        {
          "success": true,
          "data": {
            "id": "新标签ID",
            "name": "标签名",
            "color": "#RRGGBB",
            "description": "标签描述",
            "type": "document",
            "documentCount": 0,
            "createdAt": "YYYY-MM-DD HH:MM:SS.ffffff"
          }
        }
        ```
    *   **请求参数错误 (400 Bad Request):**
        ```json
        {
          "success": false,
          "data": null
        }
        ```
    *   **标签名已存在 (409 Conflict):**
        ```json
        {
          "success": false,
          "data": null
        }
        ```
    *   **服务器内部错误 (500 Internal Server Error):**
        ```json
        {
          "success": false,
          "data": null
        }
        ```
*   **示例请求:**
    ```http
    POST /api/v1/tags/document
    Content-Type: application/json

    {
      "name": "Java EE",
      "color": "#0000FF",
      "description": "关于Java EE技术的标签"
    }
    ```
*   **示例响应 (成功):**
    ```json
    {
      "success": true,
      "data": {
        "id": "51",
        "name": "Java EE",
        "color": "#0000FF",
        "description": "关于Java EE技术的标签",
        "type": "document",
        "documentCount": 0,
        "createdAt": "2024-01-10 10:35:00.0"
      }
    }
    ```

---

### 7. 创建词汇标签

*   **请求地址:** `/api/v1/tags/vocabulary`
*   **请求方法:** `POST`
*   **描述:** 创建一个新的词汇标签。
*   **请求体:**
    ```json
    {
      "name": "新标签名", // 必需
      "color": "#RRGGBB", // 可选
      "description": "标签的描述" // 可选
    }
    ```
*   **请求参数:**
    *   `name` (String, 必需): 标签的名称。
    *   `color` (String, 可选): 标签的颜色，格式为 hex。
    *   `description` (String, 可选): 标签的描述。
*   **响应格式:**
    *   **成功 (200 OK):**
        ```json
        {
          "success": true,
          "data": {
            "id": "新标签ID",
            "name": "标签名",
            "color": "#RRGGBB",
            "description": "标签描述",
            "type": "vocabulary",
            "vocabularyCount": 0,
            "createdAt": "YYYY-MM-DD HH:MM:SS.ffffff"
          }
        }
        ```
    *   **请求参数错误 (400 Bad Request):**
        ```json
        {
          "success": false,
          "data": null
        }
        ```
    *   **标签名已存在 (409 Conflict):**
        ```json
        {
          "success": false,
          "data": null
        }
        ```
    *   **服务器内部错误 (500 Internal Server Error):**
        ```json
        {
          "success": false,
          "data": null
        }
        ```
*   **示例请求:**
    ```http
    POST /api/v1/tags/vocabulary
    Content-Type: application/json

    {
      "name": "常用动词",
      "color": "#FF0000",
      "description": "学习过程中遇到的常用动词"
    }
    ```
*   **示例响应 (成功):**
    ```json
    {
      "success": true,
      "data": {
        "id": "52",
        "name": "常用动词",
        "color": "#FF0000",
        "description": "学习过程中遇到的常用动词",
        "type": "vocabulary",
        "vocabularyCount": 0,
        "createdAt": "2024-01-10 10:40:00.0"
      }
    }
    ```

---

### 8. 删除标签

*   **请求地址:** `/api/v1/tags/{tagId}`
*   **请求方法:** `DELETE`
*   **描述:** 删除一个标签。如果标签正在被使用，需要设置 `force=true` 来强制删除。
*   **路径参数:**
    *   `tagId` (String, 必需): 要删除的标签的唯一标识符。
*   **查询参数:**
    *   `force` (Boolean, 可选, 默认 `false`): 是否强制删除。如果为 `true`，将级联删除关联关系。
*   **响应格式:**
    *   **成功 (200 OK):**
        ```json
        {
          "success": true,
          "message": "标签删除成功"
        }
        ```
    *   **标签不存在 (404 Not Found):**
        ```json
        {
          "success": false,
          "message": "标签不存在"
        }
        ```
    *   **标签正在使用 (409 Conflict):**
        ```json
        {
          "success": false,
          "message": "标签正在被使用，无法删除。请使用force=true强制删除"
        }
        ```
    *   **ID 格式错误 (400 Bad Request):**
        ```json
        {
          "success": false,
          "message": "标签ID格式错误"
        }
        ```
    *   **服务器内部错误 (500 Internal Server Error):**
        ```json
        {
          "success": false,
          "message": "服务器内部错误: [错误信息]"
        }
        ```
*   **示例请求 (普通删除):**
    ```http
    DELETE /api/v1/tags/70
    ```
*   **示例请求 (强制删除):**
    ```http
    DELETE /api/v1/tags/70?force=true
    ```
*   **示例响应 (成功):**
    ```json
    {
      "success": true,
      "message": "标签删除成功"
    }
    ```

---

### 9. 删除文档标签

*   **请求地址:** `/api/v1/tags/document/{tagId}`
*   **请求方法:** `DELETE`
*   **描述:** 删除一个文档标签。如果标签正在被使用，将无法删除。
*   **路径参数:**
    *   `tagId` (String, 必需): 要删除的文档标签的唯一标识符。
*   **响应格式:**
    *   **成功 (200 OK):**
        ```json
        {
          "success": true,
          "message": "文档标签删除成功"
        }
        ```
    *   **文档标签不存在 (404 Not Found):**
        ```json
        {
          "success": false,
          "message": "文档标签不存在"
        }
        ```
    *   **文档标签正在使用 (409 Conflict):**
        ```json
        {
          "success": false,
          "message": "文档标签正在被使用，无法删除"
        }
        ```
    *   **ID 格式错误 (400 Bad Request):**
        ```json
        {
          "success": false,
          "message": "标签ID格式错误"
        }
        ```
    *   **服务器内部错误 (500 Internal Server Error):**
        ```json
        {
          "success": false,
          "message": "服务器内部错误: [错误信息]"
        }
        ```
*   **示例请求:**
    ```http
    DELETE /api/v1/tags/document/50
    ```
*   **示例响应 (成功):**
    ```json
    {
      "success": true,
      "message": "文档标签删除成功"
    }
    ```

---

### 10. 删除词汇标签

*   **请求地址:** `/api/v1/tags/vocabulary/{tagId}`
*   **请求方法:** `DELETE`
*   **描述:** 删除一个词汇标签。如果标签正在被使用，将无法删除。
*   **路径参数:**
    *   `tagId` (String, 必需): 要删除的词汇标签的唯一标识符。
*   **响应格式:**
    *   **成功 (200 OK):**
        ```json
        {
          "success": true,
          "message": "生词标签删除成功"
        }
        ```
    *   **词汇标签不存在 (404 Not Found):**
        ```json
        {
          "success": false,
          "message": "生词标签不存在"
        }
        ```
    *   **词汇标签正在使用 (409 Conflict):**
        ```json
        {
          "success": false,
          "message": "生词标签正在被使用，无法删除"
        }
        ```
    *   **ID 格式错误 (400 Bad Request):**
        ```json
        {
          "success": false,
          "message": "标签ID格式错误"
        }
        ```
    *   **服务器内部错误 (500 Internal Server Error):**
        ```json
        {
          "success": false,
          "message": "服务器内部错误: [错误信息]"
        }
        ```
*   **示例请求:**
    ```http
    DELETE /api/v1/tags/vocabulary/52
    ```
*   **示例响应 (成功):**
    ```json
    {
      "success": true,
      "message": "生词标签删除成功"
    }
    ```

---

### 11. 获取所有标签

*   **请求地址:** `/api/v1/tags`
*   **请求方法:** `GET`
*   **描述:** 获取所有标签列表，支持分页、排序和类型过滤。
*   **查询参数:**
    *   `page` (Integer, 可选, 默认 `1`): 页码。
    *   `limit` (Integer, 可选, 默认 `20`): 每页显示数量，最大 100。
    *   `sort` (String, 可选, 默认 `"name"`): 排序字段，支持 `"name"`, `"createdAt"`, `"updatedAt"`。
    *   `order` (String, 可选, 默认 `"asc"`): 排序顺序，支持 `"asc"` (升序) 或 `"desc"` (降序)。
    *   `type` (String, 可选, 默认 `"all"`): 标签类型，支持 `"all"` (所有), `"document"` (文档标签), `"vocabulary"` (词汇标签)。
*   **响应格式:**
    *   **成功 (200 OK):**
        ```json
        {
          "success": true,
          "data": [
            {
              "id": "标签ID",
              "name": "标签名",
              "color": "#RRGGBB",
              "description": "标签描述",
              "type": "document" | "vocabulary",
              "documentCount": 0, // 仅对文档标签有效
              "createdAt": "YYYY-MM-DD HH:MM:SS.ffffff",
              "updatedAt": "YYYY-MM-DD HH:MM:SS.ffffff"
            },
            // ... 更多标签
          ],
          "pagination": {
            "page": 1, // 当前页码
            "limit": 20, // 每页数量
            "total": 100 // 总条数
          }
        }
        ```
    *   **服务器内部错误 (500 Internal Server Error):**
        ```json
        {
          "success": false,
          "data": null,
          "pagination": null
        }
        ```
*   **示例请求:**
    ```http
    GET /api/v1/tags?page=2&limit=10&sort=createdAt&order=desc&type=document
    ```
*   **示例响应 (成功):**
    ```json
    {
      "success": true,
      "data": [
        {
          "id": "48",
          "name": "API 文档",
          "color": "#FFA500",
          "description": "关于 API 文档的标签",
          "type": "document",
          "documentCount": 5,
          "createdAt": "2024-01-09 15:00:00.0",
          "updatedAt": "2024-01-09 15:00:00.0"
        },
        // ... 更多标签
      ],
      "pagination": {
        "page": 2,
        "limit": 10,
        "total": 55
      }
    }
    ```

---

### 12. 获取标签详情

*   **请求地址:** `/api/v1/tags/{tagId}`
*   **请求方法:** `GET`
*   **描述:** 获取指定标签的详细信息，包括关联的文档（如果适用）。
*   **路径参数:**
    *   `tagId` (String, 必需): 要获取详情的标签的唯一标识符。
*   **响应格式:**
    *   **成功 (200 OK):**
        ```json
        {
          "success": true,
          "data": {
            "id": "标签ID",
            "name": "标签名",
            "color": "#RRGGBB",
            "description": "标签描述",
            "type": "document" | "vocabulary",
            "documentCount": 0, // 文档标签有效
            "createdAt": "YYYY-MM-DD HH:MM:SS.ffffff",
            "updatedAt": "YYYY-MM-DD HH:MM:SS.ffffff",
            "documents": [ // 仅对文档标签有效，最多返回10个最近的文档
              {
                "id": "文档ID",
                "title": "文档标题",
                "createdAt": "YYYY-MM-DD HH:MM:SS.ffffff"
              },
              // ...
            ]
          }
        }
        ```
    *   **标签不存在 (404 Not Found):**
        ```json
        {
          "success": false,
          "data": null
        }
        ```
    *   **ID 格式错误 (400 Bad Request):**
        ```json
        {
          "success": false,
          "data": null
        }
        ```
    *   **服务器内部错误 (500 Internal Server Error):**
        ```json
        {
          "success": false,
          "data": null
        }
        ```
*   **示例请求:**
    ```http
    GET /api/v1/tags/48
    ```
*   **示例响应 (文档标签):**
    ```json
    {
      "success": true,
      "data": {
        "id": "48",
        "name": "API 文档",
        "color": "#FFA500",
        "description": "关于 API 文档的标签",
        "type": "document",
        "documentCount": 5,
        "createdAt": "2024-01-09 15:00:00.0",
        "updatedAt": "2024-01-09 15:00:00.0",
        "documents": [
          {
            "id": "123",
            "title": "RESTful API 设计指南",
            "createdAt": "2024-01-08 10:00:00.0"
          },
          // ...
        ]
      }
    }
    ```
*   **示例响应 (词汇标签):**
    ```json
    {
      "success": true,
      "data": {
        "id": "52",
        "name": "常用动词",
        "color": "#FF0000",
        "description": "学习过程中遇到的常用动词",
        "type": "vocabulary",
        "documentCount": 0, // 词汇标签此字段为0
        "createdAt": "2024-01-10 10:40:00.0",
        "updatedAt": "2024-01-10 10:40:00.0",
        "documents": [] // 词汇标签此字段为空数组
      }
    }
    ```

---

### 13. 获取文档标签详情

*   **请求地址:** `/api/v1/tags/document/{tagId}`
*   **请求方法:** `GET`
*   **描述:** 获取指定文档标签的详细信息，包括关联的文档。
*   **路径参数:**
    *   `tagId` (String, 必需): 要获取详情的文档标签的唯一标识符。
*   **响应格式:**
    *   **成功 (200 OK):**
        ```json
        {
          "success": true,
          "data": {
            "id": "标签ID",
            "name": "标签名",
            "color": "#RRGGBB",
            "description": "标签描述",
            "type": "document",
            "documentCount": 0, // 关联的文档数量
            "createdAt": "YYYY-MM-DD HH:MM:SS.ffffff",
            "updatedAt": "YYYY-MM-DD HH:MM:SS.ffffff",
            "documents": [ // 最多返回10个最近关联的文档
              {
                "id": "文档ID",
                "title": "文档标题",
                "createdAt": "YYYY-MM-DD HH:MM:SS.ffffff"
              },
              // ...
            ]
          }
        }
        ```
    *   **文档标签不存在 (404 Not Found):**
        ```json
        {
          "success": false,
          "data": null
        }
        ```
    *   **ID 格式错误 (400 Bad Request):**
        ```json
        {
          "success": false,
          "data": null
        }
        ```
    *   **服务器内部错误 (500 Internal Server Error):**
        ```json
        {
          "success": false,
          "data": null
        }
        ```
*   **示例请求:**
    ```http
    GET /api/v1/tags/document/48
    ```
*   **示例响应 (成功):**
    ```json
    {
      "success": true,
      "data": {
        "id": "48",
        "name": "API 文档",
        "color": "#FFA500",
        "description": "关于 API 文档的标签",
        "type": "document",
        "documentCount": 5,
        "createdAt": "2024-01-09 15:00:00.0",
        "updatedAt": "2024-01-09 15:00:00.0",
        "documents": [
          {
            "id": "123",
            "title": "RESTful API 设计指南",
            "createdAt": "2024-01-08 10:00:00.0"
          },
          // ...
        ]
      }
    }
    ```

---

### 14. 获取文档标签列表

*   **请求地址:** `/api/v1/documents/{documentId}/tags`
*   **请求方法:** `GET`
*   **描述:** 获取指定文档关联的所有文档标签。
*   **路径参数:**
    *   `documentId` (String, 必需): 文档的唯一标识符。
*   **响应格式:**
    *   **成功 (200 OK):**
        ```json
        {
          "success": true,
          "data": [
            {
              "id": "标签ID",
              "name": "标签名",
              "color": "#RRGGBB",
              "description": "标签描述",
              "type": "document",
              "createdAt": "YYYY-MM-DD HH:MM:SS.ffffff"
            },
            // ... 更多标签
          ]
        }
        ```
    *   **文档不存在 (404 Not Found):**
        ```json
        {
          "success": false,
          "data": null
        }
        ```
    *   **ID 格式错误 (400 Bad Request):**
        ```json
        {
          "success": false,
          "data": null
        }
        ```
    *   **服务器内部错误 (500 Internal Server Error):**
        ```json
        {
          "success": false,
          "data": null
        }
        ```
*   **示例请求:**
    ```http
    GET /api/v1/documents/123/tags
    ```
*   **示例响应 (成功):**
    ```json
    {
      "success": true,
      "data": [
        {
          "id": "48",
          "name": "API 文档",
          "color": "#FFA500",
          "description": "关于 API 文档的标签",
          "type": "document",
          "createdAt": "2024-01-09 15:00:00.0"
        },
        {
          "id": "49",
          "name": "RESTful",
          "color": "#FFD700",
          "description": "RESTful API 相关",
          "type": "document",
          "createdAt": "2024-01-09 15:05:00.0"
        }
        // ...
      ]
    }
    ```

---

### 15. 获取热门标签

*   **请求地址:** `/api/v1/tags/popular`
*   **请求方法:** `GET`
*   **描述:** 获取最热门的标签，根据使用次数排序。
*   **查询参数:**
    *   `limit` (Integer, 可选, 默认 `10`): 返回标签的数量。
    *   `timeRange` (String, 可选, 默认 `"month"`): 时间范围，支持 `"day"`, `"week"`, `"month"`, `"year"`。
*   **响应格式:**
    *   **成功 (200 OK):**
        ```json
        {
          "success": true,
          "data": [
            {
              "id": "标签ID",
              "name": "标签名",
              "color": "#RRGGBB",
              "type": "document" | "vocabulary",
              "documentCount": 0, // 文档标签有效，词汇标签为0
              "usageCount": 0 // 使用次数
            },
            // ... 更多标签
          ]
        }
        ```
    *   **服务器内部错误 (500 Internal Server Error):**
        ```json
        {
          "success": false,
          "data": []
        }
        ```
*   **示例请求:**
    ```http
    GET /api/v1/tags/popular?limit=5&timeRange=week
    ```
*   **示例响应 (成功):**
    ```json
    {
      "success": true,
      "data": [
        {
          "id": "48",
          "name": "API 文档",
          "color": "#FFA500",
          "type": "document",
          "documentCount": 5,
          "usageCount": 150
        },
        {
          "id": "52",
          "name": "常用动词",
          "color": "#FF0000",
          "type": "vocabulary",
          "documentCount": 0,
          "usageCount": 120
        },
        // ...
      ]
    }
    ```

---

### 16. 获取标签统计信息

*   **请求地址:** `/api/v1/tags/statistics`
*   **请求方法:** `GET`
*   **描述:** 获取标签系统的统计数据，包括总数、各类标签数量、最常用标签和标签分布。
*   **查询参数:**
    *   `type` (String, 可选, 默认 `"all"`): 统计类型，支持 `"all"` (所有), `"document"` (文档标签), `"vocabulary"` (词汇标签)。 **注意：当前实现只统计总数，未根据此参数过滤。**
    *   `timeRange` (String, 可选, 默认 `"month"`): 时间范围。 **注意：当前实现未根据此参数过滤。**
*   **响应格式:**
    *   **成功 (200 OK):**
        ```json
        {
          "success": true,
          "data": {
            "totalTags": 0, // 总标签数
            "documentTags": 0, // 文档标签数
            "vocabularyTags": 0, // 词汇标签数
            "mostUsedTag": {
              "id": "标签ID",
              "name": "标签名",
              "usageCount": 0 // 使用次数
            },
            "tagDistribution": {
              "document": 0, // 文档标签数量
              "vocabulary": 0 // 词汇标签数量
            }
          }
        }
        ```
    *   **服务器内部错误 (500 Internal Server Error):**
        ```json
        {
          "success": false,
          "data": null
        }
        ```
*   **示例请求:**
    ```http
    GET /api/v1/tags/statistics
    ```
*   **示例响应 (成功):**
    ```json
    {
      "success": true,
      "data": {
        "totalTags": 102,
        "documentTags": 51,
        "vocabularyTags": 51,
        "mostUsedTag": {
          "id": "48",
          "name": "API 文档",
          "usageCount": 150
        },
        "tagDistribution": {
          "document": 51,
          "vocabulary": 51
        }
      }
    }
    ```

---

### 17. 获取词汇标签详情

*   **请求地址:** `/api/v1/tags/vocabulary/{tagId}`
*   **请求方法:** `GET`
*   **描述:** 获取指定词汇标签的详细信息，包括关联的词汇。
*   **路径参数:**
    *   `tagId` (String, 必需): 要获取详情的词汇标签的唯一标识符。
*   **响应格式:**
    *   **成功 (200 OK):**
        ```json
        {
          "success": true,
          "data": {
            "id": "标签ID",
            "name": "标签名",
            "color": "#RRGGBB",
            "description": "标签描述",
            "type": "vocabulary",
            "vocabularyCount": 0, // 关联的词汇数量
            "createdAt": "YYYY-MM-DD HH:MM:SS.ffffff",
            "updatedAt": "YYYY-MM-DD HH:MM:SS.ffffff",
            "vocabularies": [ // 最多返回10个最近关联的词汇
              {
                "id": "用户词汇ID",
                "word": "词汇",
                "createdAt": "YYYY-MM-DD HH:MM:SS.ffffff"
              },
              // ...
            ]
          }
        }
        ```
    *   **词汇标签不存在 (404 Not Found):**
        ```json
        {
          "success": false,
          "data": null
        }
        ```
    *   **ID 格式错误 (400 Bad Request):**
        ```json
        {
          "success": false,
          "data": null
        }
        ```
    *   **服务器内部错误 (500 Internal Server Error):**
        ```json
        {
          "success": false,
          "data": null
        }
        ```
*   **示例请求:**
    ```http
    GET /api/v1/tags/vocabulary/52
    ```
*   **示例响应 (成功):**
    ```json
    {
      "success": true,
      "data": {
        "id": "52",
        "name": "常用动词",
        "color": "#FF0000",
        "description": "学习过程中遇到的常用动词",
        "type": "vocabulary",
        "vocabularyCount": 8,
        "createdAt": "2024-01-10 10:40:00.0",
        "updatedAt": "2024-01-10 10:40:00.0",
        "vocabularies": [
          {
            "id": "1001",
            "word": "run",
            "createdAt": "2024-01-09 11:00:00.0"
          },
          // ...
        ]
      }
    }
    ```

---

### 18. 获取词汇标签列表

*   **请求地址:** `/api/v1/tags/vocabulary`
*   **请求方法:** `GET`
*   **描述:** 获取所有词汇标签列表，支持分页和排序。
*   **查询参数:**
    *   `page` (Integer, 可选, 默认 `1`): 页码。
    *   `limit` (Integer, 可选, 默认 `20`): 每页显示数量，最大 100。
    *   `sort` (String, 可选, 默认 `"name"`): 排序字段，支持 `"name"`, `"createdAt"`。
    *   `order` (String, 可选, 默认 `"asc"`): 排序顺序，支持 `"asc"` (升序) 或 `"desc"` (降序)。
*   **响应格式:**
    *   **成功 (200 OK):**
        ```json
        {
          "success": true,
          "data": [
            {
              "id": "标签ID",
              "name": "标签名",
              "color": "#RRGGBB",
              "description": "标签描述",
              "type": "vocabulary",
              "vocabularyCount": 0, // 关联的词汇数量
              "createdAt": "YYYY-MM-DD HH:MM:SS.ffffff"
            },
            // ... 更多标签
          ],
          "pagination": {
            "page": 1, // 当前页码
            "limit": 20, // 每页数量
            "total": 50 // 总条数
          }
        }
        ```
    *   **服务器内部错误 (500 Internal Server Error):**
        ```json
        {
          "success": false,
          "data": null,
          "pagination": null
        }
        ```
*   **示例请求:**
    ```http
    GET /api/v1/tags/vocabulary?page=1&limit=15&sort=createdAt&order=asc
    ```
*   **示例响应 (成功):**
    ```json
    {
      "success": true,
      "data": [
        {
          "id": "51",
          "name": "Java EE",
          "color": "#0000FF",
          "description": "关于Java EE技术的标签",
          "type": "vocabulary",
          "vocabularyCount": 5,
          "createdAt": "2024-01-10 10:35:00.0"
        },
        // ... 更多标签
      ],
      "pagination": {
        "page": 1,
        "limit": 15,
        "total": 51
      }
    }
    ```

---

### 19. 合并标签

*   **请求地址:** `/api/v1/tags/merge`
*   **请求方法:** `POST`
*   **描述:** 将一个源标签合并到目标标签。源标签将被删除。
*   **请求体:**
    ```json
    {
      "sourceTagId": "源标签ID", // 必需
      "targetTagId": "目标标签ID" // 必需
    }
    ```
*   **请求参数:**
    *   `sourceTagId` (String, 必需): 要合并的源标签的 ID。
    *   `targetTagId` (String, 必需): 要合并到的目标标签的 ID。
*   **响应格式:**
    *   **成功 (200 OK):**
        ```json
        {
          "success": true,
          "message": "标签合并成功",
          "data": {
            "sourceTagId": "源标签ID",
            "targetTagId": "目标标签ID",
            "mergedCount": 0 // 转移的关联关系数量
          }
        }
        ```
    *   **请求参数错误 (400 Bad Request):**
        ```json
        {
          "success": false,
          "message": "[错误信息]", // 例如："源标签ID不能为空" 或 "源标签和目标标签不能相同"
          "data": null
        }
        ```
    *   **标签不存在 (404 Not Found):**
        ```json
        {
          "success": false,
          "message": "源标签不存在" // 或 "目标标签不存在"
          "data": null
        }
        ```
    *   **标签类型不同 (400 Bad Request):**
        ```json
        {
          "success": false,
          "message": "标签类型不同，无法合并",
          "data": null
        }
        ```
    *   **服务器内部错误 (500 Internal Server Error):**
        ```json
        {
          "success": false,
          "message": "服务器内部错误: [错误信息]",
          "data": null
        }
        ```
*   **示例请求:**
    ```http
    POST /api/v1/tags/merge
    Content-Type: application/json

    {
      "sourceTagId": "60",
      "targetTagId": "50"
    }
    ```
*   **示例响应 (成功):**
    ```json
    {
      "success": true,
      "message": "标签合并成功",
      "data": {
        "sourceTagId": "60",
        "targetTagId": "50",
        "mergedCount": 15 // 假设有15个关联关系被转移
      }
    }
    ```

---

### 20. 从文档移除标签

*   **请求地址:** `/api/v1/documents/{documentId}/tags/{tagId}`
*   **请求方法:** `DELETE`
*   **描述:** 从指定的文档中移除一个标签。
*   **路径参数:**
    *   `documentId` (String, 必需): 文档的唯一标识符。
    *   `tagId` (String, 必需): 标签的唯一标识符。
*   **请求体:** 无
*   **响应格式:**
    *   **成功 (200 OK):**
        ```json
        {
          "success": true,
          "message": "标签移除成功"
        }
        ```
    *   **文档不存在 (404 Not Found):**
        ```json
        {
          "success": false,
          "message": "文档不存在"
        }
        ```
    *   **标签不存在 (404 Not Found):**
        ```json
        {
          "success": false,
          "message": "标签不存在"
        }
        ```
    *   **标签未添加到文档 (404 Not Found):**
        ```json
        {
          "success": false,
          "message": "该标签未添加到文档"
        }
        ```
    *   **ID 格式错误 (400 Bad Request):**
        ```json
        {
          "success": false,
          "message": "ID格式错误"
        }
        ```
    *   **服务器内部错误 (500 Internal Server Error):**
        ```json
        {
          "success": false,
          "message": "服务器内部错误: [错误信息]"
        }
        ```
*   **示例请求:**
    ```http
    DELETE /api/v1/documents/123/tags/456
    ```
*   **示例响应 (成功):**
    ```json
    {
      "success": true,
      "message": "标签移除成功"
    }
    ```

---

### 21. 搜索标签

*   **请求地址:** `/api/v1/tags/search`
*   **请求方法:** `GET`
*   **描述:** 根据关键词搜索标签。
*   **查询参数:**
    *   `query` (String, 必需): 搜索关键词。
    *   `type` (String, 可选, 默认 `"all"`): 标签类型，支持 `"all"` (所有), `"document"` (文档标签), `"vocabulary"` (词汇标签)。
*   **响应格式:**
    *   **成功 (200 OK):**
        ```json
        {
          "success": true,
          "data": [
            {
              "id": "标签ID",
              "name": "标签名",
              "color": "#RRGGBB",
              "description": "标签描述",
              "type": "document" | "vocabulary",
              "documentCount": 0, // 文档标签有效
              "relevanceScore": 0.0 // 相关性得分 (越高越相关)
            },
            // ... 更多标签
          ]
        }
        ```
    *   **请求参数错误 (400 Bad Request):**
        ```json
        {
          "success": false,
          "data": []
        }
        ```
    *   **服务器内部错误 (500 Internal Server Error):**
        ```json
        {
          "success": false,
          "data": []
        }
        ```
*   **示例请求:**
    ```http
    GET /api/v1/tags/search?query=api&type=document
    ```
*   **示例响应 (成功):**
    ```json
    {
      "success": true,
      "data": [
        {
          "id": "48",
          "name": "API 文档",
          "color": "#FFA500",
          "description": "关于 API 文档的标签",
          "type": "document",
          "documentCount": 5,
          "relevanceScore": 1.0
        },
        {
          "id": "49",
          "name": "RESTful",
          "color": "#FFD700",
          "description": "RESTful API 相关",
          "type": "document",
          "documentCount": 3,
          "relevanceScore": 0.8
        }
        // ...
      ]
    }
    ```

---

### 22. 更新标签

*   **请求地址:** `/api/v1/tags/{tagId}`
*   **请求方法:** `PUT`
*   **描述:** 更新一个标签（文档标签或词汇标签）的信息。
*   **路径参数:**
    *   `tagId` (String, 必需): 要更新的标签的唯一标识符。
*   **请求体:**
    ```json
    {
      "name": "新标签名", // 必需
      "color": "#RRGGBB", // 可选
      "description": "标签的描述" // 可选
    }
    ```
*   **请求参数:**
    *   `name` (String, 必需): 标签的新名称。
    *   `color` (String, 可选): 标签的新颜色。
    *   `description` (String, 可选): 标签的新描述。
*   **响应格式:**
    *   **成功 (200 OK):**
        ```json
        {
          "success": true,
          "data": {
            "id": "标签ID",
            "name": "新标签名",
            "color": "#RRGGBB",
            "description": "新标签描述",
            "type": "document" | "vocabulary",
            "documentCount": 0, // 文档标签有效
            "createdAt": "YYYY-MM-DD HH:MM:SS.ffffff",
            "updatedAt": "YYYY-MM-DD HH:MM:SS.ffffff"
          }
        }
        ```
    *   **请求参数错误 (400 Bad Request):**
        ```json
        {
          "success": false,
          "data": null
        }
        ```
    *   **标签不存在 (404 Not Found):**
        ```json
        {
          "success": false,
          "data": null
        }
        ```
    *   **标签名称冲突 (409 Conflict):**
        ```json
        {
          "success": false,
          "data": null
        }
        ```
    *   **服务器内部错误 (500 Internal Server Error):**
        ```json
        {
          "success": false,
          "data": null
        }
        ```
*   **示例请求:**
    ```http
    PUT /api/v1/tags/50
    Content-Type: application/json

    {
      "name": "Spring Boot Framework",
      "color": "#00FF00",
      "description": "关于Spring Boot框架的详细信息"
    }
    ```
*   **示例响应 (成功):**
    ```json
    {
      "success": true,
      "data": {
        "id": "50",
        "name": "Spring Boot Framework",
        "color": "#00FF00",
        "description": "关于Spring Boot框架的详细信息",
        "type": "document",
        "documentCount": 3,
        "createdAt": "2024-01-10 10:30:00.0",
        "updatedAt": "2024-01-10 11:00:00.0"
      }
    }
    ```

---

### 23. 更新文档标签

*   **请求地址:** `/api/v1/tags/document/{tagId}`
*   **请求方法:** `PUT`
*   **描述:** 更新一个文档标签的信息。
*   **路径参数:**
    *   `tagId` (String, 必需): 要更新的文档标签的唯一标识符。
*   **请求体:**
    ```json
    {
      "name": "新标签名", // 必需
      "color": "#RRGGBB", // 可选
      "description": "标签的描述" // 可选
    }
    ```
*   **请求参数:**
    *   `name` (String, 必需): 标签的新名称。
    *   `color` (String, 可选): 标签的新颜色。
    *   `description` (String, 可选): 标签的新描述。
*   **响应格式:**
    *   **成功 (200 OK):**
        ```json
        {
          "success": true,
          "data": {
            "id": "标签ID",
            "name": "新标签名",
            "color": "#RRGGBB",
            "description": "新标签描述",
            "type": "document",
            "documentCount": 0, // 关联的文档数量
            "updatedAt": "YYYY-MM-DD HH:MM:SS.ffffff"
          }
        }
        ```
    *   **请求参数错误 (400 Bad Request):**
        ```json
        {
          "success": false,
          "data": null
        }
        ```
    *   **标签不存在 (404 Not Found):**
        ```json
        {
          "success": false,
          "data": null
        }
        ```
    *   **标签名称冲突 (409 Conflict):**
        ```json
        {
          "success": false,
          "data": null
        }
        ```
    *   **服务器内部错误 (500 Internal Server Error):**
        ```json
        {
          "success": false,
          "data": null
        }
        ```
*   **示例请求:**
    ```http
    PUT /api/v1/tags/document/48
    Content-Type: application/json

    {
      "name": "API Endpoint",
      "color": "#FF8C00",
      "description": "关于API接口端点的标签"
    }
    ```
*   **示例响应 (成功):**
    ```json
    {
      "success": true,
      "data": {
        "id": "48",
        "name": "API Endpoint",
        "color": "#FF8C00",
        "description": "关于API接口端点的标签",
        "type": "document",
        "documentCount": 5,
        "updatedAt": "2024-01-10 11:05:00.0"
      }
    }
    ```

---

### 24. 更新词汇标签

*   **请求地址:** `/api/v1/tags/vocabulary/{tagId}`
*   **请求方法:** `PUT`
*   **描述:** 更新一个词汇标签的信息。
*   **路径参数:**
    *   `tagId` (String, 必需): 要更新的词汇标签的唯一标识符。
*   **请求体:**
    ```json
    {
      "name": "新标签名", // 必需
      "color": "#RRGGBB", // 可选
      "description": "标签的描述" // 可选
    }
    ```
*   **请求参数:**
    *   `name` (String, 必需): 标签的新名称。
    *   `color` (String, 可选): 标签的新颜色。
    *   `description` (String, 可选): 标签的新描述。
*   **响应格式:**
    *   **成功 (200 OK):**
        ```json
        {
          "success": true,
          "data": {
            "id": "标签ID",
            "name": "新标签名",
            "color": "#RRGGBB",
            "description": "新标签描述",
            "type": "vocabulary",
            "vocabularyCount": 0, // 关联的词汇数量
            "updatedAt": "YYYY-MM-DD HH:MM:SS.ffffff"
          }
        }
        ```
    *   **请求参数错误 (400 Bad Request):**
        ```json
        {
          "success": false,
          "data": null
        }
        ```
    *   **标签不存在 (404 Not Found):**
        ```json
        {
          "success": false,
          "data": null
        }
        ```
    *   **标签名称冲突 (409 Conflict):**
        ```json
        {
          "success": false,
          "data": null
        }
        ```
    *   **服务器内部错误 (500 Internal Server Error):**
        ```json
        {
          "success": false,
          "data": null
        }
        ```
*   **示例请求:**
    ```http
    PUT /api/v1/tags/vocabulary/52
    Content-Type: application/json

    {
      "name": "常用动词短语",
      "color": "#FF4500",
      "description": "学习过程中遇到的常用动词及短语"
    }
    ```
*   **示例响应 (成功):**
    ```json
    {
      "success": true,
      "data": {
        "id": "52",
        "name": "常用动词短语",
        "color": "#FF4500",
        "description": "学习过程中遇到的常用动词及短语",
        "type": "vocabulary",
        "vocabularyCount": 8,
        "updatedAt": "2024-01-10 11:10:00.0"
      }
    }
    ```

# 接口文档

## 接口：用户登出

### 基本信息
- **接口地址**：`/api/v1/auth/logout`
- **请求方法**：`POST`
- **认证方式**：Bearer Token

### 请求头
| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| `Authorization` | `string` | 是 | Bearer Token，格式：`Bearer {token}` |

### 请求体
无

### 响应体
#### 成功响应 (200)
```json
{
  "success": true,
  "message": "登出成功"
}
```

| 字段名 | 类型 | 描述 |
|--------|------|------|
| `success` | `boolean` | 请求是否成功 |
| `message` | `string` | 操作结果消息 |

#### 错误响应
**400 Bad Request**
```json
{
  "success": false,
  "message": "未提供有效的认证令牌"
}
```

**500 Internal Server Error**
```json
{
  "success": false,
  "message": "服务器内部错误"
}
```

### 状态码说明
| 状态码 | 说明 |
|--------|------|
| 200 | 登出成功 |
| 400 | 请求参数错误 |
| 500 | 服务器内部错误 |

### 业务说明
1. 会话删除：删除用户的当前会话
2. 安全设计：即使会话不存在也返回成功，防止信息泄露

---

## 接口：刷新令牌

### 基本信息
- **接口地址**：`/api/v1/auth/refresh-token`
- **请求方法**：`POST`
- **认证方式**：无需认证

### 请求头
| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| `Content-Type` | `string` | 是 | 固定值：`application/json` |

### 请求体
```json
{
  "refresh_token": "refresh_xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
}
```

| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| `refresh_token` | `string` | 是 | 刷新令牌 |

### 响应体
#### 成功响应 (200)
```json
{
  "success": true,
  "message": "令牌刷新成功",
  "data": {
    "access_token": "access_xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",
    "refresh_token": "refresh_xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",
    "expires_in": 3600
  }
}
```

| 字段名 | 类型 | 描述 |
|--------|------|------|
| `success` | `boolean` | 请求是否成功 |
| `message` | `string` | 操作结果消息 |
| `data` | `object` | 令牌数据 |

**data 对象字段：**
| 字段名 | 类型 | 描述 |
|--------|------|------|
| `access_token` | `string` | 新的访问令牌 |
| `refresh_token` | `string` | 新的刷新令牌 |
| `expires_in` | `integer` | 访问令牌过期时间（秒） |

#### 错误响应
**400 Bad Request**
```json
{
  "success": false,
  "message": "刷新令牌不能为空",
  "data": null
}
```

**401 Unauthorized**
```json
{
  "success": false,
  "message": "刷新令牌无效",
  "data": null
}
```
或
```json
{
  "success": false,
  "message": "刷新令牌已过期",
  "data": null
}
```

**500 Internal Server Error**
```json
{
  "success": false,
  "message": "服务器内部错误",
  "data": null
}
```

### 状态码说明
| 状态码 | 说明 |
|--------|------|
| 200 | 令牌刷新成功 |
| 400 | 请求参数错误 |
| 401 | 刷新令牌无效或过期 |
| 500 | 服务器内部错误 |

### 业务说明
1. 令牌轮换：同时生成新的access_token和refresh_token
2. 过期检查：验证refresh_token是否过期
3. 会话更新：更新现有会话的令牌信息

---

## 接口：用户注册

### 基本信息
- **接口地址**：`/api/v1/auth/register`
- **请求方法**：`POST`
- **认证方式**：无需认证

### 请求头
| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| `Content-Type` | `string` | 是 | 固定值：`application/json` |

### 请求体
```json
{
  "email": "user@example.com",
  "password": "password123",
  "username": "testuser",
  "nickname": "测试用户"
}
```

| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| `email` | `string` | 是 | 用户邮箱 |
| `password` | `string` | 是 | 用户密码，长度≥6 |
| `username` | `string` | 是 | 用户名 |
| `nickname` | `string` | 否 | 昵称，不传则使用用户名 |

### 响应体
#### 成功响应 (201)
```json
{
  "success": true,
  "message": "注册成功",
  "data": {
    "user": {
      "id": 1,
      "username": "testuser",
      "email": "test@example.com",
      "nickname": "测试用户",
      "avatarUrl": "",
      "role": "user",
      "isVerified": false,
      "createdAt": "2023-01-01T00:00:00",
      "lastLoginAt": "2023-01-01T00:00:00"
    }
  }
}
```

| 字段名 | 类型 | 描述 |
|--------|------|------|
| `success` | `boolean` | 请求是否成功 |
| `message` | `string` | 操作结果消息 |
| `data` | `object` | 用户数据 |

**data.user 对象字段：**
| 字段名 | 类型 | 描述 |
|--------|------|------|
| `id` | `integer` | 用户ID |
| `username` | `string` | 用户名 |
| `email` | `string` | 邮箱 |
| `nickname` | `string` | 昵称 |
| `avatarUrl` | `string` | 头像URL |
| `role` | `string` | 用户角色 |
| `isVerified` | `boolean` | 是否已验证 |
| `createdAt` | `string` | 创建时间 |
| `lastLoginAt` | `string` | 最后登录时间 |

#### 错误响应
**400 Bad Request**
```json
{
  "success": false,
  "message": "邮箱不能为空",
  "data": null
}
```
或
```json
{
  "success": false,
  "message": "密码不能为空",
  "data": null
}
```
或
```json
{
  "success": false,
  "message": "用户名不能为空",
  "data": null
}
```
或
```json
{
  "success": false,
  "message": "邮箱格式不正确",
  "data": null
}
```
或
```json
{
  "success": false,
  "message": "密码长度不能少于6位",
  "data": null
}
```
或
```json
{
  "success": false,
  "message": "该邮箱已被注册",
  "data": null
}
```
或
```json
{
  "success": false,
  "message": "该用户名已被使用",
  "data": null
}
```

**500 Internal Server Error**
```json
{
  "success": false,
  "message": "服务器内部错误",
  "data": null
}
```

### 状态码说明
| 状态码 | 说明 |
|--------|------|
| 201 | 注册成功 |
| 400 | 请求参数错误 |
| 500 | 服务器内部错误 |

### 业务说明
1. 自动登录：注册成功后自动创建会话并返回令牌
2. 唯一性验证：检查邮箱和用户名是否已存在
3. 默认值设置：未提供昵称时使用用户名，角色默认为"user"

---

## 接口：重置密码

### 基本信息
- **接口地址**：`/api/v1/auth/reset-password`
- **请求方法**：`POST`
- **认证方式**：无需认证

### 请求头
| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| `Content-Type` | `string` | 是 | 固定值：`application/json` |

### 请求体
```json
{
  "token": "reset_xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",
  "email": "user@example.com",
  "password": "newpassword123",
  "password_confirmation": "newpassword123"
}
```

| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| `token` | `string` | 是 | 重置令牌 |
| `email` | `string` | 是 | 用户邮箱 |
| `password` | `string` | 是 | 新密码，长度≥6 |
| `password_confirmation` | `string` | 是 | 确认密码 |

### 响应体
#### 成功响应 (200)
```json
{
  "success": true,
  "message": "密码重置成功，请使用新密码登录"
}
```

| 字段名 | 类型 | 描述 |
|--------|------|------|
| `success` | `boolean` | 请求是否成功 |
| `message` | `string` | 操作结果消息 |

#### 错误响应
**400 Bad Request**
```json
{
  "success": false,
  "message": "重置令牌不能为空"
}
```
或
```json
{
  "success": false,
  "message": "邮箱不能为空"
}
```
或
```json
{
  "success": false,
  "message": "新密码不能为空"
}
```
或
```json
{
  "success": false,
  "message": "确认密码不能为空"
}
```
或
```json
{
  "success": false,
  "message": "两次输入的密码不一致"
}
```
或
```json
{
  "success": false,
  "message": "密码长度不能少于6位"
}
```
或
```json
{
  "success": false,
  "message": "邮箱不存在"
}
```
或
```json
{
  "success": false,
  "message": "重置令牌无效"
}
```
或
```json
{
  "success": false,
  "message": "重置令牌已过期"
}
```

**500 Internal Server Error**
```json
{
  "success": false,
  "message": "服务器内部错误"
}
```

### 状态码说明
| 状态码 | 说明 |
|--------|------|
| 200 | 密码重置成功 |
| 400 | 请求参数错误 |
| 500 | 服务器内部错误 |

### 业务说明
1. 令牌验证：验证重置令牌是否有效且未过期
2. 密码一致性：验证新密码和确认密码是否一致
3. 安全措施：重置密码后删除所有用户会话，强制重新登录

---

## 接口：更新密码

### 基本信息
- **接口地址**：`/api/v1/auth/password`
- **请求方法**：`PUT`
- **认证方式**：Bearer Token

### 请求头
| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| `Authorization` | `string` | 是 | Bearer Token，格式：`Bearer {token}` |
| `Content-Type` | `string` | 是 | 固定值：`application/json` |

### 请求体
```json
{
  "current_password": "oldpassword123",
  "new_password": "newpassword123",
  "new_password_confirmation": "newpassword123"
}
```

| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| `current_password` | `string` | 是 | 当前密码 |
| `new_password` | `string` | 是 | 新密码，长度≥6 |
| `new_password_confirmation` | `string` | 是 | 确认新密码 |

### 响应体
#### 成功响应 (200)
```json
{
  "success": true,
  "message": "密码更新成功，请重新登录"
}
```

| 字段名 | 类型 | 描述 |
|--------|------|------|
| `success` | `boolean` | 请求是否成功 |
| `message` | `string` | 操作结果消息 |

#### 错误响应
**400 Bad Request**
```json
{
  "success": false,
  "message": "当前密码不能为空"
}
```
或
```json
{
  "success": false,
  "message": "新密码不能为空"
}
```
或
```json
{
  "success": false,
  "message": "确认密码不能为空"
}
```
或
```json
{
  "success": false,
  "message": "两次输入的新密码不一致"
}
```
或
```json
{
  "success": false,
  "message": "新密码长度不能少于6位"
}
```
或
```json
{
  "success": false,
  "message": "新密码不能与当前密码相同"
}
```
或
```json
{
  "success": false,
  "message": "当前密码错误"
}
```

**401 Unauthorized**
```json
{
  "success": false,
  "message": "未提供有效的认证令牌"
}
```
或
```json
{
  "success": false,
  "message": "令牌无效或已过期"
}
```

**500 Internal Server Error**
```json
{
  "success": false,
  "message": "服务器内部错误"
}
```

### 状态码说明
| 状态码 | 说明 |
|--------|------|
| 200 | 密码更新成功 |
| 400 | 请求参数错误 |
| 401 | 未授权或Token无效 |
| 500 | 服务器内部错误 |

### 业务说明
1. 密码验证：验证当前密码是否正确
2. 密码规则：新密码不能与当前密码相同，长度≥6
3. 安全措施：更新密码后删除所有用户会话，强制重新登录

---

## 接口：验证邮箱

### 基本信息
- **接口地址**：`/api/v1/auth/verify-email`
- **请求方法**：`POST`
- **认证方式**：无需认证

### 请求头
| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| `Content-Type` | `string` | 是 | 固定值：`application/json` |

### 请求体
```json
{
  "token": "verify_xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",
  "email": "user@example.com"
}
```

| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| `token` | `string` | 是 | 验证令牌 |
| `email` | `string` | 是 | 用户邮箱 |

### 响应体
#### 成功响应 (200)
```json
{
  "success": true,
  "message": "邮箱验证成功"
}
```

| 字段名 | 类型 | 描述 |
|--------|------|------|
| `success` | `boolean` | 请求是否成功 |
| `message` | `string` | 操作结果消息 |

#### 错误响应
**400 Bad Request**
```json
{
  "success": false,
  "message": "验证令牌不能为空"
}
```
或
```json
{
  "success": false,
  "message": "邮箱不能为空"
}
```
或
```json
{
  "success": false,
  "message": "邮箱格式不正确"
}
```
或
```json
{
  "success": false,
  "message": "邮箱不存在"
}
```
或
```json
{
  "success": false,
  "message": "邮箱已经验证过了"
}
```

**500 Internal Server Error**
```json
{
  "success": false,
  "message": "服务器内部错误"
}
```

### 状态码说明
| 状态码 | 说明 |
|--------|------|
| 200 | 邮箱验证成功 |
| 400 | 请求参数错误 |
| 500 | 服务器内部错误 |

### 业务说明
1. 状态检查：验证邮箱是否已存在且未验证
2. 令牌验证：验证邮箱验证令牌（课设中简化处理）
3. 状态更新：将用户is_verified字段更新为true

---

## 接口：发送邮箱验证邮件

### 基本信息
- **接口地址**：`/api/v1/auth/send-verification-email`
- **请求方法**：`POST`
- **认证方式**：Bearer Token

### 请求头
| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| `Authorization` | `string` | 是 | Bearer Token，格式：`Bearer {token}` |

### 请求体
无

### 响应体
#### 成功响应 (200)
```json
{
  "success": true,
  "message": "验证邮件已发送，请查收您的邮箱"
}
```

| 字段名 | 类型 | 描述 |
|--------|------|------|
| `success` | `boolean` | 请求是否成功 |
| `message` | `string` | 操作结果消息 |

#### 错误响应
**400 Bad Request**
```json
{
  "success": false,
  "message": "邮箱已经验证过了"
}
```

**401 Unauthorized**
```json
{
  "success": false,
  "message": "未提供有效的认证令牌"
}
```
或
```json
{
  "success": false,
  "message": "令牌无效或已过期"
}
```

**500 Internal Server Error**
```json
{
  "success": false,
  "message": "服务器内部错误"
}
```

### 状态码说明
| 状态码 | 说明 |
|--------|------|
| 200 | 验证邮件发送成功 |
| 400 | 邮箱已验证 |
| 401 | 未授权或Token无效 |
| 500 | 服务器内部错误 |

### 业务说明
1. 状态检查：验证用户邮箱是否已验证
2. 令牌生成：生成24小时有效的邮箱验证令牌
3. 邮件发送：实际应发送包含验证链接的邮件（课设中仅打印日志）

---

## 接口：验证令牌

### 基本信息
- **接口地址**：`/api/v1/auth/verify-token`
- **请求方法**：`POST`
- **认证方式**：无需认证

### 请求头
| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| `Content-Type` | `string` | 是 | 固定值：`application/json` |

### 请求体
```json
{
  "token": "access_xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
}
```

| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| `token` | `string` | 是 | 访问令牌 |

### 响应体
#### 成功响应 (200)
```json
{
  "success": true,
  "message": "令牌有效",
  "data": {
    "userId": 1,
    "username": "testuser",
    "email": "test@example.com",
    "role": "user",
    "isValid": true
  }
}
```

| 字段名 | 类型 | 描述 |
|--------|------|------|
| `success` | `boolean` | 请求是否成功 |
| `message` | `string` | 操作结果消息 |
| `data` | `object` | 用户信息 |

**data 对象字段：**
| 字段名 | 类型 | 描述 |
|--------|------|------|
| `userId` | `integer` | 用户ID |
| `username` | `string` | 用户名 |
| `email` | `string` | 邮箱 |
| `role` | `string` | 用户角色 |
| `isValid` | `boolean` | 令牌是否有效 |

#### 错误响应
**400 Bad Request**
```json
{
  "success": false,
  "message": "令牌不能为空",
  "data": null
}
```

**200（令牌无效）**
```json
{
  "success": false,
  "message": "令牌无效",
  "data": {
    "userId": null,
    "username": null,
    "email": null,
    "role": null,
    "isValid": false
  }
}
```
或
```json
{
  "success": false,
  "message": "令牌已过期",
  "data": {
    "userId": null,
    "username": null,
    "email": null,
    "role": null,
    "isValid": false
  }
}
```

**500 Internal Server Error**
```json
{
  "success": false,
  "message": "服务器内部错误",
  "data": null
}
```

### 状态码说明
| 状态码 | 说明 |
|--------|------|
| 200 | 验证完成（无论令牌是否有效） |
| 400 | 请求参数错误 |
| 500 | 服务器内部错误 |

### 业务说明
1. 令牌验证：验证访问令牌是否存在且未过期
2. 用户信息：返回令牌对应的用户基本信息
3. 过期处理：删除过期的会话记录

---

## 接口：通过请求头验证令牌

### 基本信息
- **接口地址**：`/api/v1/auth/verify-token-header`
- **请求方法**：`GET`
- **认证方式**：Bearer Token（通过Authorization头）

### 请求头
| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| `Authorization` | `string` | 是 | Bearer Token，格式：`Bearer {token}` |

### 请求体
无

### 响应体
与"验证令牌"接口相同

### 状态码说明
与"验证令牌"接口相同

### 业务说明
1. 便捷验证：通过请求头直接验证令牌，无需传递请求体
2. 功能相同：与POST方式的验证令牌接口功能一致
